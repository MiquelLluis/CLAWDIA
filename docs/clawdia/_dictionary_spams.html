<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>clawdia._dictionary_spams API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../clawdia.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;clawdia</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DictionarySpams">DictionarySpams</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DictionarySpams.__init__">DictionarySpams</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.dict_init">dict_init</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.components">components</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.a_length">a_length</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.d_size">d_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.lambda1">lambda1</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.batch_size">batch_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.n_iter">n_iter</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.t_train">t_train</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.trained">trained</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.n_train">n_train</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.mode_traindl">mode_traindl</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.modeD_traindl">modeD_traindl</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.mode_lasso">mode_lasso</a>
                        </li>
                        <li>
                                <a class="variable" href="#DictionarySpams.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reconstruct">reconstruct</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reconstruct_batch">reconstruct_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reconstruct_minibatch">reconstruct_minibatch</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reconstruct_auto">reconstruct_auto</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reconstruct_iterative_minibatch">reconstruct_iterative_minibatch</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.optimum_reconstruct">optimum_reconstruct</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#DictionarySpams.reset">reset</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../clawdia.html">clawdia</a><wbr>._dictionary_spams    </h1>

                
                        <input id="mod-_dictionary_spams-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-_dictionary_spams-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">scipy.optimize</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">spams</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">estimators</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">lib</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># Remove warning from OpenMP, present in older versions of python-spams.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;__version__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">spams</span><span class="p">)</span> <span class="ow">or</span> <span class="n">spams</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;=</span> <span class="s1">&#39;2.6.5.4&#39;</span><span class="p">:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;KMP_WARNINGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FALSE&#39;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">DictionarySpams</span><span class="p">:</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sparse Dictionary Learning (SDL) model for waveform denoising via SPAMS.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    This class provides an object-oriented implementation of a Sparse</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    Dictionary Learning model, designed for the denoising and reconstruction</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    of waveforms. At its core, it utilizes the `trainDL` function for</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    dictionary learning and the `lasso` function for sparse coding from the</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    SPAMS-python library [1].</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    It extends these core functionalities to arbitrarily long signals and</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    minibatch processing for large datasets. Additionally, the class includes</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    various utilities for signal preprocessing, composite models of denoising</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    (such as iterative reconstruction), and the ability to easily save and</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    load the dictionary&#39;s state.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    Attributes</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    ----------</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    dict_init : ndarray</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        Atoms of the initial dictionary. Remains unaltered after training.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    components : ndarray</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        Atoms of the current (trained) dictionary.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    model : tuple</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        SPAMS&#39; trainDL model components in the form (A, B, iter).</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    d_size : int</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        Number of atoms in the dictionary (dictionary size).</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    a_length : int</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        Length of each atom in the dictionary (patch size).</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    lambda1 : float</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        Regularization parameter for training the dictionary.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    batch_size : int</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        Batch size used in mini-batch training.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    n_iter : int</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        Number of iterations performed during training.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    t_train : float</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        Total training time in seconds.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    trained : bool</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Indicates whether the dictionary has been trained.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    n_train : int</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Number of patches used during training.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    mode_traindl : int</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Training mode for SPAMS&#39; `trainDL` function.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    modeD_traindl : int</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        Dictionary mode for SPAMS&#39; `trainDL` function.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    mode_lasso : int</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Mode for SPAMS&#39; `lasso` function.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    identifier : str</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        Optional identifier or note for distinguishing the dictionary.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    References</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    ----------</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    [1] SPAMS (for python),</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        (http://spams-devel.gforge.inria.fr/).</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        Last accessed in October 2018.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    </span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>             <span class="n">dict_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>             <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>             <span class="n">signal_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>             <span class="n">patch_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_allzeros</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>             <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>             <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>             <span class="n">trained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeD_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode_lasso</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>             <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the dictionary.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        There are two ways to initialize the dictionary:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        </span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        1. By directly providing the initial dictionary with `dict_init`.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        2. By providing a collection of signals (`signal_pool`) from which atoms</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        are randomly extracted to form the initial dictionary.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        If the second option is used, `a_length` and `d_size` must be explicitly</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        specified to define the size of the dictionary. Additional optional</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        parameters provide more control over this process.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Note</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        ----</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        This method initializes the dictionary but does not train it. Use the</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        `train` method for training.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        Parameters</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        ----------</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        dict_init : ndarray of shape (d_size, a_length), optional</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            Atoms of the initial dictionary. If None, `signal_pool` must be provided.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        model : dict, optional</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            SPAMS&#39; `trainDL` model components as a dictionary with elements</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">            {A, B, iter}. Must be provided if continuing training from a previous state.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        signal_pool : ndarray of shape (n_signals, n_samples), optional</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">            A collection of signals from which atoms are extracted to form the</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">            initial dictionary. Ignored if `dict_init` is provided.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        a_length : int, optional</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            Length of each atom in the dictionary (patch size). Required if</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">            `signal_pool` is provided.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        d_size : int, optional</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">            Number of atoms in the dictionary. Required if `signal_pool` is provided.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        wave_pos : array-like of shape (n_signals, 2), optional</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">            Positions of waveforms within `signal_pool` to extract atoms from. If</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">            None, the entire array is used.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        patch_min : int, default=1</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">            Minimum number of samples for each extracted patch. Ignored if</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">            `wave_pos` is None.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        l2_normed : bool, default=True</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">            If True, normalize extracted atoms to their L2 norm.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        allow_allzeros : bool, default=True</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">            If False, random atoms with all zeros are not included in the initial</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            dictionary.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        random_state : int, optional</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            Seed for random sampling from `signal_pool`.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        ignore_completeness : bool, optional</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">            If False, the dictionary must be overcomplete (`d_size &gt; a_length`).</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">            Defaults to False.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">            Regularization parameter for training.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        batch_size : int, default=64</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">            Batch size used during training.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">            Total number of iterations for training. If None, this must be set when</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            calling the `train` method.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        n_train : int, optional</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            Number of patches used for training. Informational only.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        trained : bool, default=False</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            Indicates whether the dictionary is already trained.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        mode_traindl : int, default=0</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">            Training mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        modeD_traindl : int, default=0</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">            Dictionary mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        mode_lasso : int, default=2</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">            Mode for SPAMS&#39; `lasso` function. See SPAMS documentation.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        identifier : str, optional</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">            A note or label for identifying the dictionary.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        See Also</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        --------</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        train : Method to train the dictionary.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        reconstruct : Method to reconstruct signals using the dictionary.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        References</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        ----------</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        [1] SPAMS (for python), (http://spams-devel.gforge.inria.fr/).</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            Last accessed in October 2018.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="n">a_length</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span> <span class="o">=</span> <span class="n">d_size</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span> <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="n">trained</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">n_train</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span> <span class="o">=</span> <span class="n">mode_traindl</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span> <span class="o">=</span> <span class="n">modeD_traindl</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span> <span class="o">=</span> <span class="n">mode_lasso</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_initial_parameters</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="c1"># Explicit initial dictionary (trained or not).</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># Get the initial atoms from a set of signals.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="n">signal_pool</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="n">limits</span><span class="o">=</span><span class="n">wave_pos</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                <span class="n">n_patches</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>                <span class="n">l2_normed</span><span class="o">=</span><span class="n">l2_normed</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                <span class="n">allow_allzeros</span><span class="o">=</span><span class="n">allow_allzeros</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>                <span class="n">patch_min</span><span class="o">=</span><span class="n">patch_min</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Train the dictionary.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Train the dictionary with the given patches.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        This also allows a warm start using the previous components as initial</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        dictionary, but only if the lambda1 parameter is the same. It can be</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        thought of as adding more iterations to the training. Hence, providing</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        different patches is discouraged and untested.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        Parameters</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        ----------</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        patches : 2d-array(signals, samples)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">            Training patches.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            Regularization parameter of the learning algorithm.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">            It is not needed if already specified at initialization.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">            Total number of iterations to perform.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            If a negative number is provided it will perform the computation</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            during the corresponding number of seconds.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">            For instance `n_iter = -5` trains the dictionary during 5 seconds.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        warm_start : bool</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            If True, use the previous components as initial dictionary.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">            It can be thought of as adding more iterations to the training.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">            Providing different patches is discouraged and untested.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            If True print the iterations (might not be shown in real time).</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        threads : int, optional</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">            Number of threads to use during training, see [1].</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        **kwargs</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">            Passed directly to &#39;spams.trainDL&#39;, see [1].</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        Additional parameters will be passed to the SPAMS training function.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary has already been trained&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lambda1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the &#39;lambda1&#39; parameter must be the same &quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                                 <span class="s2">&quot;as the one used at the previous training&quot;</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the length of &#39;patches&#39; must be the same as the&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                             <span class="s2">&quot; atoms of the dictionary&quot;</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;n_iter&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="n">n_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;lambda1&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">lambda1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">components</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">trainDL</span><span class="p">(</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">batchsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">K</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>  <span class="c1"># In SPAMS argo, the dictionary size is the number of atoms.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="nb">iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">modeD</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">numThreads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">return_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">tac</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">n_iter</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="c1"># TODO: Add kwarg option to disable the patch normalization.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="c1"># This might be usefull for tasks such detection or when a heavy</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="c1"># discrimination is needed.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">patches</span><span class="p">,</span> <span class="n">norms</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>            <span class="n">signal</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="n">return_norm_coefs</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">code</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">lasso</span><span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span><span class="p">,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">code</span><span class="p">)</span> <span class="o">*</span> <span class="n">norms</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="n">signal_rec</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">reconstruct_from_patches_1d</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct a signal as a sparse combination of dictionary atoms.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        Parameters</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        ----------</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        signal : ndarray</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">            Sample to be reconstructed.</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        sc_lambda : float</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">            Regularization parameter of the sparse coding transformation.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        step : int, 1 by default</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">            Sample interval between each patch extracted from signal.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            Determines the number of patches to be extracted. 1 by default.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">        normed : boolean, True by default</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">            Normalize the result to the maximum absolute value.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">        with_code : boolean, False by default.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">            If True, also returns the coefficients array.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        **kwargs</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">            Passed directly to the external learning function.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        Returns</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        -------</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        signal_rec : array</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            Reconstructed signal.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        code : array(a_length, d_size), optional</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">            Transformed data, encoded as a sparse combination of atoms.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">            Returned when &#39;with_code&#39; is True.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;signal&#39; must be a numpy array&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">signal_rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_rec</span><span class="p">))</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">signal_rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_code</span> <span class="k">else</span> <span class="n">signal_rec</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strains</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">ns</span> <span class="o">=</span> <span class="n">strains</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">patches</span><span class="p">,</span> <span class="n">norms</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="n">strains</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">l2_normed</span><span class="o">=</span><span class="n">normed_windows</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="n">return_norm_coefs</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">codes</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">lasso</span><span class="p">(</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">codes</span><span class="p">)</span> <span class="o">*</span> <span class="n">norms</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">lp</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">np_</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">ns</span>  <span class="c1"># Number of patches per strain</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">np_</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">reconstructions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">strains</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="n">reconstructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">reconstruct_from_patches_1d</span><span class="p">(</span><span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="k">return</span> <span class="n">reconstructions</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="k">def</span> <span class="nf">reconstruct_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                          <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        dictionary atoms.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        WARNING: Only viable for small &#39;signals&#39; set, it is really memory</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        expensive (all patches are stored in a single array in memory).</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        WARNING: &#39;out&#39; deprecated, left for backwards compatibility but will</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        be ignored if given.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">reconstruct_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                              <span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        dictionary atoms. Minibatch version.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">n_minibatch</span> <span class="o">=</span> <span class="n">n_signals</span> <span class="o">//</span> <span class="n">batchsize</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_minibatch</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">for</span> <span class="n">ibatch</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">ibatch</span> <span class="o">*</span> <span class="n">batchsize</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">batchsize</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed_windows</span><span class="o">=</span><span class="n">normed_windows</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="k">if</span> <span class="n">n_minibatch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="c1"># In case there was no point in using a minibatch:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="c1"># If &#39;n_signals&#39; was not divisible by &#39;batchsize&#39; reconstruct the</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="c1"># remaining signals:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">n_signals</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">i1</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>    <span class="k">def</span> <span class="nf">reconstruct_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">zero_marg</span><span class="p">,</span> <span class="n">lambda_lims</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>                         <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kwargs_bisect</span><span class="o">=</span><span class="p">{},</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        Reconstrueix un nic senyal buscant per bisecci la lambda que</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        minimitza el senyal reconstruit al marge esquerre del senyal, la mida</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">        dels quals ve determinada per &#39;zero_marg&#39;.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="c1"># Margins of the signals to be zeroed</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">margin</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[:</span><span class="n">zero_marg</span><span class="p">]</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="c1"># Function to be bisected.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">sc_lambda</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>                <span class="c1"># Ignore specific warning from extract_patches since here we do</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>                <span class="c1"># not care about reconstructing the entire strain (margin).</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;&#39;signals&#39; cannot be fully divided into patches.*&quot;</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">semibool_bisect</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">*</span><span class="n">lambda_lims</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_bisect</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">except</span> <span class="n">lib</span><span class="o">.</span><span class="n">BoundaryError</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lambda_lims</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;converged&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;niters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;funcalls&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>                <span class="n">rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>                <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">rec</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="k">def</span> <span class="nf">reconstruct_iterative_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                                        <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                                        <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct multiple signals using iterative residual subtraction.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        This method reconstructs each signal by iteratively updating and</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        accumulating reconstructions. In the first iteration, the original </span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        input signal is reconstructed and then subtracted from itself to </span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        obtain the initial residual. In each subsequent iteration, a new </span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        reconstruction is generated from the current residual and subtracted </span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">        from it, producing an updated residual for the next iteration, while </span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        also being added to the cumulative reconstruction. The process </span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">        repeats until the Euclidean norm of the difference between consecutive </span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">        residuals falls below a specified threshold, which sets the convergence </span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        criterion.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        NOTE: In contrast with the usual procedure, the windows into which each</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        signal is split are not normalized. This is needed to enhance the</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        dictionary discrimination. Otherwise, the residuals are amplified at</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        each iteration, the algorithm takes longer to converge, and some</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        ad-hoc tests showed it also messes up with the resulting shape.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        Parameters</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        ----------</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        signals : ndarray</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">            Input signals to be reconstructed, with each signal along the first dimension.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        sc_lambda : float, optional</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">            Sparsity control parameter for reconstruction.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">        step : int, optional</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">            Step size for the reconstruction.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        batchsize : int, optional</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">            Number of signals processed in each minibatch.</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">            Maximum number of iterations before stopping.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">        threshold : float, optional</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">            Convergence threshold based on the relative change in residuals.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        normed : bool, optional</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">            If True, the reconstructed signals are normalized after convergence.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">        full_output : bool, optional</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">            If True, returns additional output values (residuals and iteration counts).</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">            If True, prints progress information at each iteration.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">        kwargs_lasso : dict, optional</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">            Additional arguments for the Lasso reconstruction method.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Returns</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        -------</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        ndarray or tuple</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">            The final reconstructed signals. If `full_output` is True, also returns the residuals</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">            and the number of iterations per signal.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="c1"># First iteration outside:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration 0&quot;</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="n">n_signals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="n">final_reconstructions</span> <span class="o">=</span> <span class="n">step_reconstructions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="n">residuals</span> <span class="o">=</span> <span class="n">signals</span> <span class="o">-</span> <span class="n">step_reconstructions</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="c1"># Stop conditions</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_signals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="n">finished</span> <span class="o">=</span> <span class="o">~</span><span class="n">step_reconstructions</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># In case any reconstructions are 0 already.</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="ow">and</span> <span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration </span><span class="si">{</span><span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="p">(</span><span class="o">~</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">^13d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>                <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>            <span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>            <span class="n">final_reconstructions</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_reconstructions</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>            <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_reconstructions</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="c1"># Stop conditions</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>            <span class="n">iters</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="n">residual_decrease</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-</span> <span class="n">residuals_old</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>            <span class="n">finished</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual_decrease</span> <span class="o">&lt;</span> <span class="n">threshold</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>            <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>                    <span class="s2">&quot;CURRENT RESIDUAL DECREASE:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>                    <span class="sa">f</span><span class="s2">&quot;Max: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                    <span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                    <span class="sa">f</span><span class="s2">&quot;Min: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                <span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">):</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: reached max_iter before finishing all the reconstructions&quot;</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>                <span class="n">final_reconstructions</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">final_reconstructions</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>    <span class="k">def</span> <span class="nf">optimum_reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strain</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">kwargs_minimize</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="p">,</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the best reconstruction of a signal w.r.t. a reference.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        Find the lambda which produces a reconstruction of the</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        input &#39;strain&#39; closest to the given &#39;reference&#39;, comparing them with</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">        the SSIM estimator. The search is performed by the SciPy&#39;s function</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        &#39;minimize_scalar&#39; with bounds.</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        PARAMETERS</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">        ----------</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">        strain: ndarray</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">            Input strain to be reconstructed (and optimized).</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        reference: ndarray</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">            Reference strain which to compare the reconstruction to.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        kwargs_minimize: dict</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">            Passed to SciPy&#39;s `minimize_scalar(**kwargs_minimize)`.</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">        kwargs_lasso: dict</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">            Passed to Python-Spams&#39; `lasso(**kwargs_lasso)`.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">        step: int, optional</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">            Separation in samples between each window into which the input</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">            strain is split up to be reconstructed by the dictionary. Defaults</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">            to 1.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">        limits: array-like, optional</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">            Indices of limits to where compute the loss between the</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">            reconstruction and the reference strain.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">        normed: bool, optional</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">            If True, returns the signal normed to its maximum absolute amplitude.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">        verbose: bool, optional</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">            Print info about the minimization results. False by default.</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">        RETURNS</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">        -------</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">        rec: ndarray</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">            Optimum reconstruction found.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">        l_opt: float</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">            Optimum value for lambda.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="sd">        loss: float</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">            ISSIM (1 - SSIM) between the optimized reconstruction and the</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">            reference.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="n">aa</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># max(issim) x bb as the minimu value for the auxiliar line function.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>        <span class="n">rec</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">limits</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="n">reference_</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">l_rec_log</span><span class="p">):</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Function to be minimized.&quot;&quot;&quot;</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="k">nonlocal</span> <span class="n">rec</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>            <span class="n">l_rec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">l_rec_log</span>  <span class="c1"># Opitimizes lambda in log. space!</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">l_rec</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">estimators</span><span class="o">.</span><span class="n">issim</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">sl</span><span class="p">],</span> <span class="n">reference_</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">aa</span> <span class="o">*</span> <span class="n">l_rec</span> <span class="o">+</span> <span class="n">bb</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_minimize</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="n">l_opt</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>                <span class="s2">&quot;Optimization results:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Minimization success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>            <span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>                    <span class="s2">&quot;  Reason</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>                    <span class="s2">&quot;  ------</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>                    <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>                    <span class="s2">&quot;  ------&quot;</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>                <span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Lambda optimized: </span><span class="si">{</span><span class="n">l_opt</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Iterations performed: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;nit&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Final loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>            <span class="p">)</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>        <span class="k">return</span> <span class="n">rec</span><span class="p">,</span> <span class="n">l_opt</span><span class="p">,</span> <span class="n">loss</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>        <span class="n">vars_</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>            <span class="c1"># To avoid silent bugs in the future</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>            <span class="n">to_remove</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lambda1&#39;</span><span class="p">,</span> <span class="s1">&#39;n_train&#39;</span><span class="p">,</span> <span class="s1">&#39;t_train&#39;</span><span class="p">]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>            <span class="n">vars_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">vars_</span><span class="p">)</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the dictionary.</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">        Returns a new instance of the same dictionary with the same values</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">        and state.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">        Returns</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a><span class="sd">        -------</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a><span class="sd">        dico_copy : DictionarySpams</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a><span class="sd">            A copy of the current dictionary.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a><span class="sd">        </span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>        <span class="n">dico_copy</span> <span class="o">=</span> <span class="n">DictionarySpams</span><span class="p">(</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="n">dict_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>            <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>            <span class="n">n_train</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_train</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>            <span class="n">trained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>            <span class="n">mode_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="n">modeD_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">mode_lasso</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>            <span class="c1"># Retain the initial components of the dictionary.</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>            <span class="n">dico_copy</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>        <span class="k">return</span> <span class="n">dico_copy</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>    
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the dictionary to its initial (untrained) state.&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>    <span class="k">def</span> <span class="nf">_check_initial_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_pool</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="p">):</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>        <span class="c1"># Explicit initial dictionary.</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not a valid &#39;dict_init&#39;&quot;</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>                <span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>            
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dict_init&#39; must be a C-contiguous array&quot;</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>            
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_completeness</span><span class="p">):</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary must be overcomplete (d_size &gt; a_length)&quot;</span><span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>        <span class="c1"># Signal pool from where to extract the initial dictionary.</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>        <span class="k">elif</span> <span class="n">signal_pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not a valid &#39;signal_pool&#39;&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>                <span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>            
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">signal_pool</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;signal_pool&#39; must be a C-contiguous array&quot;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>            
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">):</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;a_length&#39; and &#39;d_size&#39; must be explicitly provided along &#39;signal_pool&#39;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>                <span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>            
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_completeness</span><span class="p">:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary must be overcomplete (d_size &gt; a_length)&quot;</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>        
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;either &#39;dict_init&#39; or &#39;signal_pool&#39; must be provided&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="DictionarySpams">
                            <input id="DictionarySpams-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DictionarySpams</span>:

                <label class="view-source-button" for="DictionarySpams-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams-20"><a href="#DictionarySpams-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">DictionarySpams</span><span class="p">:</span>
</span><span id="DictionarySpams-21"><a href="#DictionarySpams-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sparse Dictionary Learning (SDL) model for waveform denoising via SPAMS.</span>
</span><span id="DictionarySpams-22"><a href="#DictionarySpams-22"><span class="linenos"> 22</span></a>
</span><span id="DictionarySpams-23"><a href="#DictionarySpams-23"><span class="linenos"> 23</span></a><span class="sd">    This class provides an object-oriented implementation of a Sparse</span>
</span><span id="DictionarySpams-24"><a href="#DictionarySpams-24"><span class="linenos"> 24</span></a><span class="sd">    Dictionary Learning model, designed for the denoising and reconstruction</span>
</span><span id="DictionarySpams-25"><a href="#DictionarySpams-25"><span class="linenos"> 25</span></a><span class="sd">    of waveforms. At its core, it utilizes the `trainDL` function for</span>
</span><span id="DictionarySpams-26"><a href="#DictionarySpams-26"><span class="linenos"> 26</span></a><span class="sd">    dictionary learning and the `lasso` function for sparse coding from the</span>
</span><span id="DictionarySpams-27"><a href="#DictionarySpams-27"><span class="linenos"> 27</span></a><span class="sd">    SPAMS-python library [1].</span>
</span><span id="DictionarySpams-28"><a href="#DictionarySpams-28"><span class="linenos"> 28</span></a>
</span><span id="DictionarySpams-29"><a href="#DictionarySpams-29"><span class="linenos"> 29</span></a><span class="sd">    It extends these core functionalities to arbitrarily long signals and</span>
</span><span id="DictionarySpams-30"><a href="#DictionarySpams-30"><span class="linenos"> 30</span></a><span class="sd">    minibatch processing for large datasets. Additionally, the class includes</span>
</span><span id="DictionarySpams-31"><a href="#DictionarySpams-31"><span class="linenos"> 31</span></a><span class="sd">    various utilities for signal preprocessing, composite models of denoising</span>
</span><span id="DictionarySpams-32"><a href="#DictionarySpams-32"><span class="linenos"> 32</span></a><span class="sd">    (such as iterative reconstruction), and the ability to easily save and</span>
</span><span id="DictionarySpams-33"><a href="#DictionarySpams-33"><span class="linenos"> 33</span></a><span class="sd">    load the dictionary&#39;s state.</span>
</span><span id="DictionarySpams-34"><a href="#DictionarySpams-34"><span class="linenos"> 34</span></a>
</span><span id="DictionarySpams-35"><a href="#DictionarySpams-35"><span class="linenos"> 35</span></a><span class="sd">    Attributes</span>
</span><span id="DictionarySpams-36"><a href="#DictionarySpams-36"><span class="linenos"> 36</span></a><span class="sd">    ----------</span>
</span><span id="DictionarySpams-37"><a href="#DictionarySpams-37"><span class="linenos"> 37</span></a><span class="sd">    dict_init : ndarray</span>
</span><span id="DictionarySpams-38"><a href="#DictionarySpams-38"><span class="linenos"> 38</span></a><span class="sd">        Atoms of the initial dictionary. Remains unaltered after training.</span>
</span><span id="DictionarySpams-39"><a href="#DictionarySpams-39"><span class="linenos"> 39</span></a><span class="sd">    components : ndarray</span>
</span><span id="DictionarySpams-40"><a href="#DictionarySpams-40"><span class="linenos"> 40</span></a><span class="sd">        Atoms of the current (trained) dictionary.</span>
</span><span id="DictionarySpams-41"><a href="#DictionarySpams-41"><span class="linenos"> 41</span></a><span class="sd">    model : tuple</span>
</span><span id="DictionarySpams-42"><a href="#DictionarySpams-42"><span class="linenos"> 42</span></a><span class="sd">        SPAMS&#39; trainDL model components in the form (A, B, iter).</span>
</span><span id="DictionarySpams-43"><a href="#DictionarySpams-43"><span class="linenos"> 43</span></a><span class="sd">    d_size : int</span>
</span><span id="DictionarySpams-44"><a href="#DictionarySpams-44"><span class="linenos"> 44</span></a><span class="sd">        Number of atoms in the dictionary (dictionary size).</span>
</span><span id="DictionarySpams-45"><a href="#DictionarySpams-45"><span class="linenos"> 45</span></a><span class="sd">    a_length : int</span>
</span><span id="DictionarySpams-46"><a href="#DictionarySpams-46"><span class="linenos"> 46</span></a><span class="sd">        Length of each atom in the dictionary (patch size).</span>
</span><span id="DictionarySpams-47"><a href="#DictionarySpams-47"><span class="linenos"> 47</span></a><span class="sd">    lambda1 : float</span>
</span><span id="DictionarySpams-48"><a href="#DictionarySpams-48"><span class="linenos"> 48</span></a><span class="sd">        Regularization parameter for training the dictionary.</span>
</span><span id="DictionarySpams-49"><a href="#DictionarySpams-49"><span class="linenos"> 49</span></a><span class="sd">    batch_size : int</span>
</span><span id="DictionarySpams-50"><a href="#DictionarySpams-50"><span class="linenos"> 50</span></a><span class="sd">        Batch size used in mini-batch training.</span>
</span><span id="DictionarySpams-51"><a href="#DictionarySpams-51"><span class="linenos"> 51</span></a><span class="sd">    n_iter : int</span>
</span><span id="DictionarySpams-52"><a href="#DictionarySpams-52"><span class="linenos"> 52</span></a><span class="sd">        Number of iterations performed during training.</span>
</span><span id="DictionarySpams-53"><a href="#DictionarySpams-53"><span class="linenos"> 53</span></a><span class="sd">    t_train : float</span>
</span><span id="DictionarySpams-54"><a href="#DictionarySpams-54"><span class="linenos"> 54</span></a><span class="sd">        Total training time in seconds.</span>
</span><span id="DictionarySpams-55"><a href="#DictionarySpams-55"><span class="linenos"> 55</span></a><span class="sd">    trained : bool</span>
</span><span id="DictionarySpams-56"><a href="#DictionarySpams-56"><span class="linenos"> 56</span></a><span class="sd">        Indicates whether the dictionary has been trained.</span>
</span><span id="DictionarySpams-57"><a href="#DictionarySpams-57"><span class="linenos"> 57</span></a><span class="sd">    n_train : int</span>
</span><span id="DictionarySpams-58"><a href="#DictionarySpams-58"><span class="linenos"> 58</span></a><span class="sd">        Number of patches used during training.</span>
</span><span id="DictionarySpams-59"><a href="#DictionarySpams-59"><span class="linenos"> 59</span></a><span class="sd">    mode_traindl : int</span>
</span><span id="DictionarySpams-60"><a href="#DictionarySpams-60"><span class="linenos"> 60</span></a><span class="sd">        Training mode for SPAMS&#39; `trainDL` function.</span>
</span><span id="DictionarySpams-61"><a href="#DictionarySpams-61"><span class="linenos"> 61</span></a><span class="sd">    modeD_traindl : int</span>
</span><span id="DictionarySpams-62"><a href="#DictionarySpams-62"><span class="linenos"> 62</span></a><span class="sd">        Dictionary mode for SPAMS&#39; `trainDL` function.</span>
</span><span id="DictionarySpams-63"><a href="#DictionarySpams-63"><span class="linenos"> 63</span></a><span class="sd">    mode_lasso : int</span>
</span><span id="DictionarySpams-64"><a href="#DictionarySpams-64"><span class="linenos"> 64</span></a><span class="sd">        Mode for SPAMS&#39; `lasso` function.</span>
</span><span id="DictionarySpams-65"><a href="#DictionarySpams-65"><span class="linenos"> 65</span></a><span class="sd">    identifier : str</span>
</span><span id="DictionarySpams-66"><a href="#DictionarySpams-66"><span class="linenos"> 66</span></a><span class="sd">        Optional identifier or note for distinguishing the dictionary.</span>
</span><span id="DictionarySpams-67"><a href="#DictionarySpams-67"><span class="linenos"> 67</span></a>
</span><span id="DictionarySpams-68"><a href="#DictionarySpams-68"><span class="linenos"> 68</span></a><span class="sd">    References</span>
</span><span id="DictionarySpams-69"><a href="#DictionarySpams-69"><span class="linenos"> 69</span></a><span class="sd">    ----------</span>
</span><span id="DictionarySpams-70"><a href="#DictionarySpams-70"><span class="linenos"> 70</span></a><span class="sd">    [1] SPAMS (for python),</span>
</span><span id="DictionarySpams-71"><a href="#DictionarySpams-71"><span class="linenos"> 71</span></a><span class="sd">        (http://spams-devel.gforge.inria.fr/).</span>
</span><span id="DictionarySpams-72"><a href="#DictionarySpams-72"><span class="linenos"> 72</span></a><span class="sd">        Last accessed in October 2018.</span>
</span><span id="DictionarySpams-73"><a href="#DictionarySpams-73"><span class="linenos"> 73</span></a><span class="sd">    </span>
</span><span id="DictionarySpams-74"><a href="#DictionarySpams-74"><span class="linenos"> 74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-75"><a href="#DictionarySpams-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="DictionarySpams-76"><a href="#DictionarySpams-76"><span class="linenos"> 76</span></a>             <span class="n">dict_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams-77"><a href="#DictionarySpams-77"><span class="linenos"> 77</span></a>             <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams-78"><a href="#DictionarySpams-78"><span class="linenos"> 78</span></a>             <span class="n">signal_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams-79"><a href="#DictionarySpams-79"><span class="linenos"> 79</span></a>             <span class="n">patch_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_allzeros</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-80"><a href="#DictionarySpams-80"><span class="linenos"> 80</span></a>             <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DictionarySpams-81"><a href="#DictionarySpams-81"><span class="linenos"> 81</span></a>             <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams-82"><a href="#DictionarySpams-82"><span class="linenos"> 82</span></a>             <span class="n">trained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeD_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode_lasso</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="DictionarySpams-83"><a href="#DictionarySpams-83"><span class="linenos"> 83</span></a>             <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams-84"><a href="#DictionarySpams-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the dictionary.</span>
</span><span id="DictionarySpams-85"><a href="#DictionarySpams-85"><span class="linenos"> 85</span></a>
</span><span id="DictionarySpams-86"><a href="#DictionarySpams-86"><span class="linenos"> 86</span></a><span class="sd">        There are two ways to initialize the dictionary:</span>
</span><span id="DictionarySpams-87"><a href="#DictionarySpams-87"><span class="linenos"> 87</span></a><span class="sd">        </span>
</span><span id="DictionarySpams-88"><a href="#DictionarySpams-88"><span class="linenos"> 88</span></a><span class="sd">        1. By directly providing the initial dictionary with `dict_init`.</span>
</span><span id="DictionarySpams-89"><a href="#DictionarySpams-89"><span class="linenos"> 89</span></a><span class="sd">        2. By providing a collection of signals (`signal_pool`) from which atoms</span>
</span><span id="DictionarySpams-90"><a href="#DictionarySpams-90"><span class="linenos"> 90</span></a><span class="sd">        are randomly extracted to form the initial dictionary.</span>
</span><span id="DictionarySpams-91"><a href="#DictionarySpams-91"><span class="linenos"> 91</span></a>
</span><span id="DictionarySpams-92"><a href="#DictionarySpams-92"><span class="linenos"> 92</span></a><span class="sd">        If the second option is used, `a_length` and `d_size` must be explicitly</span>
</span><span id="DictionarySpams-93"><a href="#DictionarySpams-93"><span class="linenos"> 93</span></a><span class="sd">        specified to define the size of the dictionary. Additional optional</span>
</span><span id="DictionarySpams-94"><a href="#DictionarySpams-94"><span class="linenos"> 94</span></a><span class="sd">        parameters provide more control over this process.</span>
</span><span id="DictionarySpams-95"><a href="#DictionarySpams-95"><span class="linenos"> 95</span></a>
</span><span id="DictionarySpams-96"><a href="#DictionarySpams-96"><span class="linenos"> 96</span></a><span class="sd">        Note</span>
</span><span id="DictionarySpams-97"><a href="#DictionarySpams-97"><span class="linenos"> 97</span></a><span class="sd">        ----</span>
</span><span id="DictionarySpams-98"><a href="#DictionarySpams-98"><span class="linenos"> 98</span></a><span class="sd">        This method initializes the dictionary but does not train it. Use the</span>
</span><span id="DictionarySpams-99"><a href="#DictionarySpams-99"><span class="linenos"> 99</span></a><span class="sd">        `train` method for training.</span>
</span><span id="DictionarySpams-100"><a href="#DictionarySpams-100"><span class="linenos">100</span></a>
</span><span id="DictionarySpams-101"><a href="#DictionarySpams-101"><span class="linenos">101</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams-102"><a href="#DictionarySpams-102"><span class="linenos">102</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-103"><a href="#DictionarySpams-103"><span class="linenos">103</span></a><span class="sd">        dict_init : ndarray of shape (d_size, a_length), optional</span>
</span><span id="DictionarySpams-104"><a href="#DictionarySpams-104"><span class="linenos">104</span></a><span class="sd">            Atoms of the initial dictionary. If None, `signal_pool` must be provided.</span>
</span><span id="DictionarySpams-105"><a href="#DictionarySpams-105"><span class="linenos">105</span></a><span class="sd">        model : dict, optional</span>
</span><span id="DictionarySpams-106"><a href="#DictionarySpams-106"><span class="linenos">106</span></a><span class="sd">            SPAMS&#39; `trainDL` model components as a dictionary with elements</span>
</span><span id="DictionarySpams-107"><a href="#DictionarySpams-107"><span class="linenos">107</span></a><span class="sd">            {A, B, iter}. Must be provided if continuing training from a previous state.</span>
</span><span id="DictionarySpams-108"><a href="#DictionarySpams-108"><span class="linenos">108</span></a><span class="sd">        signal_pool : ndarray of shape (n_signals, n_samples), optional</span>
</span><span id="DictionarySpams-109"><a href="#DictionarySpams-109"><span class="linenos">109</span></a><span class="sd">            A collection of signals from which atoms are extracted to form the</span>
</span><span id="DictionarySpams-110"><a href="#DictionarySpams-110"><span class="linenos">110</span></a><span class="sd">            initial dictionary. Ignored if `dict_init` is provided.</span>
</span><span id="DictionarySpams-111"><a href="#DictionarySpams-111"><span class="linenos">111</span></a><span class="sd">        a_length : int, optional</span>
</span><span id="DictionarySpams-112"><a href="#DictionarySpams-112"><span class="linenos">112</span></a><span class="sd">            Length of each atom in the dictionary (patch size). Required if</span>
</span><span id="DictionarySpams-113"><a href="#DictionarySpams-113"><span class="linenos">113</span></a><span class="sd">            `signal_pool` is provided.</span>
</span><span id="DictionarySpams-114"><a href="#DictionarySpams-114"><span class="linenos">114</span></a><span class="sd">        d_size : int, optional</span>
</span><span id="DictionarySpams-115"><a href="#DictionarySpams-115"><span class="linenos">115</span></a><span class="sd">            Number of atoms in the dictionary. Required if `signal_pool` is provided.</span>
</span><span id="DictionarySpams-116"><a href="#DictionarySpams-116"><span class="linenos">116</span></a><span class="sd">        wave_pos : array-like of shape (n_signals, 2), optional</span>
</span><span id="DictionarySpams-117"><a href="#DictionarySpams-117"><span class="linenos">117</span></a><span class="sd">            Positions of waveforms within `signal_pool` to extract atoms from. If</span>
</span><span id="DictionarySpams-118"><a href="#DictionarySpams-118"><span class="linenos">118</span></a><span class="sd">            None, the entire array is used.</span>
</span><span id="DictionarySpams-119"><a href="#DictionarySpams-119"><span class="linenos">119</span></a><span class="sd">        patch_min : int, default=1</span>
</span><span id="DictionarySpams-120"><a href="#DictionarySpams-120"><span class="linenos">120</span></a><span class="sd">            Minimum number of samples for each extracted patch. Ignored if</span>
</span><span id="DictionarySpams-121"><a href="#DictionarySpams-121"><span class="linenos">121</span></a><span class="sd">            `wave_pos` is None.</span>
</span><span id="DictionarySpams-122"><a href="#DictionarySpams-122"><span class="linenos">122</span></a><span class="sd">        l2_normed : bool, default=True</span>
</span><span id="DictionarySpams-123"><a href="#DictionarySpams-123"><span class="linenos">123</span></a><span class="sd">            If True, normalize extracted atoms to their L2 norm.</span>
</span><span id="DictionarySpams-124"><a href="#DictionarySpams-124"><span class="linenos">124</span></a><span class="sd">        allow_allzeros : bool, default=True</span>
</span><span id="DictionarySpams-125"><a href="#DictionarySpams-125"><span class="linenos">125</span></a><span class="sd">            If False, random atoms with all zeros are not included in the initial</span>
</span><span id="DictionarySpams-126"><a href="#DictionarySpams-126"><span class="linenos">126</span></a><span class="sd">            dictionary.</span>
</span><span id="DictionarySpams-127"><a href="#DictionarySpams-127"><span class="linenos">127</span></a><span class="sd">        random_state : int, optional</span>
</span><span id="DictionarySpams-128"><a href="#DictionarySpams-128"><span class="linenos">128</span></a><span class="sd">            Seed for random sampling from `signal_pool`.</span>
</span><span id="DictionarySpams-129"><a href="#DictionarySpams-129"><span class="linenos">129</span></a><span class="sd">        ignore_completeness : bool, optional</span>
</span><span id="DictionarySpams-130"><a href="#DictionarySpams-130"><span class="linenos">130</span></a><span class="sd">            If False, the dictionary must be overcomplete (`d_size &gt; a_length`).</span>
</span><span id="DictionarySpams-131"><a href="#DictionarySpams-131"><span class="linenos">131</span></a><span class="sd">            Defaults to False.</span>
</span><span id="DictionarySpams-132"><a href="#DictionarySpams-132"><span class="linenos">132</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="DictionarySpams-133"><a href="#DictionarySpams-133"><span class="linenos">133</span></a><span class="sd">            Regularization parameter for training.</span>
</span><span id="DictionarySpams-134"><a href="#DictionarySpams-134"><span class="linenos">134</span></a><span class="sd">        batch_size : int, default=64</span>
</span><span id="DictionarySpams-135"><a href="#DictionarySpams-135"><span class="linenos">135</span></a><span class="sd">            Batch size used during training.</span>
</span><span id="DictionarySpams-136"><a href="#DictionarySpams-136"><span class="linenos">136</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="DictionarySpams-137"><a href="#DictionarySpams-137"><span class="linenos">137</span></a><span class="sd">            Total number of iterations for training. If None, this must be set when</span>
</span><span id="DictionarySpams-138"><a href="#DictionarySpams-138"><span class="linenos">138</span></a><span class="sd">            calling the `train` method.</span>
</span><span id="DictionarySpams-139"><a href="#DictionarySpams-139"><span class="linenos">139</span></a><span class="sd">        n_train : int, optional</span>
</span><span id="DictionarySpams-140"><a href="#DictionarySpams-140"><span class="linenos">140</span></a><span class="sd">            Number of patches used for training. Informational only.</span>
</span><span id="DictionarySpams-141"><a href="#DictionarySpams-141"><span class="linenos">141</span></a><span class="sd">        trained : bool, default=False</span>
</span><span id="DictionarySpams-142"><a href="#DictionarySpams-142"><span class="linenos">142</span></a><span class="sd">            Indicates whether the dictionary is already trained.</span>
</span><span id="DictionarySpams-143"><a href="#DictionarySpams-143"><span class="linenos">143</span></a><span class="sd">        mode_traindl : int, default=0</span>
</span><span id="DictionarySpams-144"><a href="#DictionarySpams-144"><span class="linenos">144</span></a><span class="sd">            Training mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams-145"><a href="#DictionarySpams-145"><span class="linenos">145</span></a><span class="sd">        modeD_traindl : int, default=0</span>
</span><span id="DictionarySpams-146"><a href="#DictionarySpams-146"><span class="linenos">146</span></a><span class="sd">            Dictionary mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams-147"><a href="#DictionarySpams-147"><span class="linenos">147</span></a><span class="sd">        mode_lasso : int, default=2</span>
</span><span id="DictionarySpams-148"><a href="#DictionarySpams-148"><span class="linenos">148</span></a><span class="sd">            Mode for SPAMS&#39; `lasso` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams-149"><a href="#DictionarySpams-149"><span class="linenos">149</span></a><span class="sd">        identifier : str, optional</span>
</span><span id="DictionarySpams-150"><a href="#DictionarySpams-150"><span class="linenos">150</span></a><span class="sd">            A note or label for identifying the dictionary.</span>
</span><span id="DictionarySpams-151"><a href="#DictionarySpams-151"><span class="linenos">151</span></a>
</span><span id="DictionarySpams-152"><a href="#DictionarySpams-152"><span class="linenos">152</span></a><span class="sd">        See Also</span>
</span><span id="DictionarySpams-153"><a href="#DictionarySpams-153"><span class="linenos">153</span></a><span class="sd">        --------</span>
</span><span id="DictionarySpams-154"><a href="#DictionarySpams-154"><span class="linenos">154</span></a><span class="sd">        train : Method to train the dictionary.</span>
</span><span id="DictionarySpams-155"><a href="#DictionarySpams-155"><span class="linenos">155</span></a><span class="sd">        reconstruct : Method to reconstruct signals using the dictionary.</span>
</span><span id="DictionarySpams-156"><a href="#DictionarySpams-156"><span class="linenos">156</span></a>
</span><span id="DictionarySpams-157"><a href="#DictionarySpams-157"><span class="linenos">157</span></a><span class="sd">        References</span>
</span><span id="DictionarySpams-158"><a href="#DictionarySpams-158"><span class="linenos">158</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-159"><a href="#DictionarySpams-159"><span class="linenos">159</span></a><span class="sd">        [1] SPAMS (for python), (http://spams-devel.gforge.inria.fr/).</span>
</span><span id="DictionarySpams-160"><a href="#DictionarySpams-160"><span class="linenos">160</span></a><span class="sd">            Last accessed in October 2018.</span>
</span><span id="DictionarySpams-161"><a href="#DictionarySpams-161"><span class="linenos">161</span></a>
</span><span id="DictionarySpams-162"><a href="#DictionarySpams-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-163"><a href="#DictionarySpams-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="DictionarySpams-164"><a href="#DictionarySpams-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="DictionarySpams-165"><a href="#DictionarySpams-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="DictionarySpams-166"><a href="#DictionarySpams-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="n">a_length</span>
</span><span id="DictionarySpams-167"><a href="#DictionarySpams-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span> <span class="o">=</span> <span class="n">d_size</span>
</span><span id="DictionarySpams-168"><a href="#DictionarySpams-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="DictionarySpams-169"><a href="#DictionarySpams-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="DictionarySpams-170"><a href="#DictionarySpams-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams-171"><a href="#DictionarySpams-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span> <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DictionarySpams-172"><a href="#DictionarySpams-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="n">trained</span>
</span><span id="DictionarySpams-173"><a href="#DictionarySpams-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">n_train</span>
</span><span id="DictionarySpams-174"><a href="#DictionarySpams-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span> <span class="o">=</span> <span class="n">mode_traindl</span>
</span><span id="DictionarySpams-175"><a href="#DictionarySpams-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span> <span class="o">=</span> <span class="n">modeD_traindl</span>
</span><span id="DictionarySpams-176"><a href="#DictionarySpams-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span> <span class="o">=</span> <span class="n">mode_lasso</span>
</span><span id="DictionarySpams-177"><a href="#DictionarySpams-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
</span><span id="DictionarySpams-178"><a href="#DictionarySpams-178"><span class="linenos">178</span></a>
</span><span id="DictionarySpams-179"><a href="#DictionarySpams-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_initial_parameters</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="p">)</span>
</span><span id="DictionarySpams-180"><a href="#DictionarySpams-180"><span class="linenos">180</span></a>
</span><span id="DictionarySpams-181"><a href="#DictionarySpams-181"><span class="linenos">181</span></a>        <span class="c1"># Explicit initial dictionary (trained or not).</span>
</span><span id="DictionarySpams-182"><a href="#DictionarySpams-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-183"><a href="#DictionarySpams-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span>
</span><span id="DictionarySpams-184"><a href="#DictionarySpams-184"><span class="linenos">184</span></a>
</span><span id="DictionarySpams-185"><a href="#DictionarySpams-185"><span class="linenos">185</span></a>        <span class="c1"># Get the initial atoms from a set of signals.</span>
</span><span id="DictionarySpams-186"><a href="#DictionarySpams-186"><span class="linenos">186</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-187"><a href="#DictionarySpams-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="DictionarySpams-188"><a href="#DictionarySpams-188"><span class="linenos">188</span></a>                <span class="n">signal_pool</span><span class="p">,</span>
</span><span id="DictionarySpams-189"><a href="#DictionarySpams-189"><span class="linenos">189</span></a>                <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span>
</span><span id="DictionarySpams-190"><a href="#DictionarySpams-190"><span class="linenos">190</span></a>                <span class="n">limits</span><span class="o">=</span><span class="n">wave_pos</span><span class="p">,</span>
</span><span id="DictionarySpams-191"><a href="#DictionarySpams-191"><span class="linenos">191</span></a>                <span class="n">n_patches</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>
</span><span id="DictionarySpams-192"><a href="#DictionarySpams-192"><span class="linenos">192</span></a>                <span class="n">l2_normed</span><span class="o">=</span><span class="n">l2_normed</span><span class="p">,</span>
</span><span id="DictionarySpams-193"><a href="#DictionarySpams-193"><span class="linenos">193</span></a>                <span class="n">allow_allzeros</span><span class="o">=</span><span class="n">allow_allzeros</span><span class="p">,</span>
</span><span id="DictionarySpams-194"><a href="#DictionarySpams-194"><span class="linenos">194</span></a>                <span class="n">patch_min</span><span class="o">=</span><span class="n">patch_min</span><span class="p">,</span>
</span><span id="DictionarySpams-195"><a href="#DictionarySpams-195"><span class="linenos">195</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="DictionarySpams-196"><a href="#DictionarySpams-196"><span class="linenos">196</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-197"><a href="#DictionarySpams-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="DictionarySpams-198"><a href="#DictionarySpams-198"><span class="linenos">198</span></a>
</span><span id="DictionarySpams-199"><a href="#DictionarySpams-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DictionarySpams-200"><a href="#DictionarySpams-200"><span class="linenos">200</span></a>              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams-201"><a href="#DictionarySpams-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Train the dictionary.</span>
</span><span id="DictionarySpams-202"><a href="#DictionarySpams-202"><span class="linenos">202</span></a>
</span><span id="DictionarySpams-203"><a href="#DictionarySpams-203"><span class="linenos">203</span></a><span class="sd">        Train the dictionary with the given patches.</span>
</span><span id="DictionarySpams-204"><a href="#DictionarySpams-204"><span class="linenos">204</span></a>
</span><span id="DictionarySpams-205"><a href="#DictionarySpams-205"><span class="linenos">205</span></a><span class="sd">        This also allows a warm start using the previous components as initial</span>
</span><span id="DictionarySpams-206"><a href="#DictionarySpams-206"><span class="linenos">206</span></a><span class="sd">        dictionary, but only if the lambda1 parameter is the same. It can be</span>
</span><span id="DictionarySpams-207"><a href="#DictionarySpams-207"><span class="linenos">207</span></a><span class="sd">        thought of as adding more iterations to the training. Hence, providing</span>
</span><span id="DictionarySpams-208"><a href="#DictionarySpams-208"><span class="linenos">208</span></a><span class="sd">        different patches is discouraged and untested.</span>
</span><span id="DictionarySpams-209"><a href="#DictionarySpams-209"><span class="linenos">209</span></a>
</span><span id="DictionarySpams-210"><a href="#DictionarySpams-210"><span class="linenos">210</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams-211"><a href="#DictionarySpams-211"><span class="linenos">211</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-212"><a href="#DictionarySpams-212"><span class="linenos">212</span></a><span class="sd">        patches : 2d-array(signals, samples)</span>
</span><span id="DictionarySpams-213"><a href="#DictionarySpams-213"><span class="linenos">213</span></a><span class="sd">            Training patches.</span>
</span><span id="DictionarySpams-214"><a href="#DictionarySpams-214"><span class="linenos">214</span></a>
</span><span id="DictionarySpams-215"><a href="#DictionarySpams-215"><span class="linenos">215</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="DictionarySpams-216"><a href="#DictionarySpams-216"><span class="linenos">216</span></a><span class="sd">            Regularization parameter of the learning algorithm.</span>
</span><span id="DictionarySpams-217"><a href="#DictionarySpams-217"><span class="linenos">217</span></a><span class="sd">            It is not needed if already specified at initialization.</span>
</span><span id="DictionarySpams-218"><a href="#DictionarySpams-218"><span class="linenos">218</span></a>
</span><span id="DictionarySpams-219"><a href="#DictionarySpams-219"><span class="linenos">219</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="DictionarySpams-220"><a href="#DictionarySpams-220"><span class="linenos">220</span></a><span class="sd">            Total number of iterations to perform.</span>
</span><span id="DictionarySpams-221"><a href="#DictionarySpams-221"><span class="linenos">221</span></a><span class="sd">            If a negative number is provided it will perform the computation</span>
</span><span id="DictionarySpams-222"><a href="#DictionarySpams-222"><span class="linenos">222</span></a><span class="sd">            during the corresponding number of seconds.</span>
</span><span id="DictionarySpams-223"><a href="#DictionarySpams-223"><span class="linenos">223</span></a><span class="sd">            For instance `n_iter = -5` trains the dictionary during 5 seconds.</span>
</span><span id="DictionarySpams-224"><a href="#DictionarySpams-224"><span class="linenos">224</span></a>
</span><span id="DictionarySpams-225"><a href="#DictionarySpams-225"><span class="linenos">225</span></a><span class="sd">        warm_start : bool</span>
</span><span id="DictionarySpams-226"><a href="#DictionarySpams-226"><span class="linenos">226</span></a><span class="sd">            If True, use the previous components as initial dictionary.</span>
</span><span id="DictionarySpams-227"><a href="#DictionarySpams-227"><span class="linenos">227</span></a><span class="sd">            It can be thought of as adding more iterations to the training.</span>
</span><span id="DictionarySpams-228"><a href="#DictionarySpams-228"><span class="linenos">228</span></a><span class="sd">            Providing different patches is discouraged and untested.</span>
</span><span id="DictionarySpams-229"><a href="#DictionarySpams-229"><span class="linenos">229</span></a>
</span><span id="DictionarySpams-230"><a href="#DictionarySpams-230"><span class="linenos">230</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="DictionarySpams-231"><a href="#DictionarySpams-231"><span class="linenos">231</span></a><span class="sd">            If True print the iterations (might not be shown in real time).</span>
</span><span id="DictionarySpams-232"><a href="#DictionarySpams-232"><span class="linenos">232</span></a>
</span><span id="DictionarySpams-233"><a href="#DictionarySpams-233"><span class="linenos">233</span></a><span class="sd">        threads : int, optional</span>
</span><span id="DictionarySpams-234"><a href="#DictionarySpams-234"><span class="linenos">234</span></a><span class="sd">            Number of threads to use during training, see [1].</span>
</span><span id="DictionarySpams-235"><a href="#DictionarySpams-235"><span class="linenos">235</span></a>
</span><span id="DictionarySpams-236"><a href="#DictionarySpams-236"><span class="linenos">236</span></a><span class="sd">        **kwargs</span>
</span><span id="DictionarySpams-237"><a href="#DictionarySpams-237"><span class="linenos">237</span></a><span class="sd">            Passed directly to &#39;spams.trainDL&#39;, see [1].</span>
</span><span id="DictionarySpams-238"><a href="#DictionarySpams-238"><span class="linenos">238</span></a>
</span><span id="DictionarySpams-239"><a href="#DictionarySpams-239"><span class="linenos">239</span></a><span class="sd">        Additional parameters will be passed to the SPAMS training function.</span>
</span><span id="DictionarySpams-240"><a href="#DictionarySpams-240"><span class="linenos">240</span></a>
</span><span id="DictionarySpams-241"><a href="#DictionarySpams-241"><span class="linenos">241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-242"><a href="#DictionarySpams-242"><span class="linenos">242</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams-243"><a href="#DictionarySpams-243"><span class="linenos">243</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="DictionarySpams-244"><a href="#DictionarySpams-244"><span class="linenos">244</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary has already been trained&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-245"><a href="#DictionarySpams-245"><span class="linenos">245</span></a>            <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lambda1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">:</span>
</span><span id="DictionarySpams-246"><a href="#DictionarySpams-246"><span class="linenos">246</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the &#39;lambda1&#39; parameter must be the same &quot;</span>
</span><span id="DictionarySpams-247"><a href="#DictionarySpams-247"><span class="linenos">247</span></a>                                 <span class="s2">&quot;as the one used at the previous training&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-248"><a href="#DictionarySpams-248"><span class="linenos">248</span></a>
</span><span id="DictionarySpams-249"><a href="#DictionarySpams-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">:</span>
</span><span id="DictionarySpams-250"><a href="#DictionarySpams-250"><span class="linenos">250</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the length of &#39;patches&#39; must be the same as the&quot;</span>
</span><span id="DictionarySpams-251"><a href="#DictionarySpams-251"><span class="linenos">251</span></a>                             <span class="s2">&quot; atoms of the dictionary&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-252"><a href="#DictionarySpams-252"><span class="linenos">252</span></a>        
</span><span id="DictionarySpams-253"><a href="#DictionarySpams-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-254"><a href="#DictionarySpams-254"><span class="linenos">254</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-255"><a href="#DictionarySpams-255"><span class="linenos">255</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;n_iter&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-256"><a href="#DictionarySpams-256"><span class="linenos">256</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-257"><a href="#DictionarySpams-257"><span class="linenos">257</span></a>                <span class="n">n_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span>
</span><span id="DictionarySpams-258"><a href="#DictionarySpams-258"><span class="linenos">258</span></a>            
</span><span id="DictionarySpams-259"><a href="#DictionarySpams-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-260"><a href="#DictionarySpams-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-261"><a href="#DictionarySpams-261"><span class="linenos">261</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;lambda1&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-262"><a href="#DictionarySpams-262"><span class="linenos">262</span></a>            
</span><span id="DictionarySpams-263"><a href="#DictionarySpams-263"><span class="linenos">263</span></a>            <span class="n">lambda1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span>
</span><span id="DictionarySpams-264"><a href="#DictionarySpams-264"><span class="linenos">264</span></a>
</span><span id="DictionarySpams-265"><a href="#DictionarySpams-265"><span class="linenos">265</span></a>        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DictionarySpams-266"><a href="#DictionarySpams-266"><span class="linenos">266</span></a>        <span class="n">components</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">trainDL</span><span class="p">(</span>
</span><span id="DictionarySpams-267"><a href="#DictionarySpams-267"><span class="linenos">267</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="DictionarySpams-268"><a href="#DictionarySpams-268"><span class="linenos">268</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="DictionarySpams-269"><a href="#DictionarySpams-269"><span class="linenos">269</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="DictionarySpams-270"><a href="#DictionarySpams-270"><span class="linenos">270</span></a>            <span class="n">batchsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DictionarySpams-271"><a href="#DictionarySpams-271"><span class="linenos">271</span></a>            <span class="n">K</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>  <span class="c1"># In SPAMS argo, the dictionary size is the number of atoms.</span>
</span><span id="DictionarySpams-272"><a href="#DictionarySpams-272"><span class="linenos">272</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="DictionarySpams-273"><a href="#DictionarySpams-273"><span class="linenos">273</span></a>            <span class="nb">iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="DictionarySpams-274"><a href="#DictionarySpams-274"><span class="linenos">274</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams-275"><a href="#DictionarySpams-275"><span class="linenos">275</span></a>            <span class="n">modeD</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams-276"><a href="#DictionarySpams-276"><span class="linenos">276</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="DictionarySpams-277"><a href="#DictionarySpams-277"><span class="linenos">277</span></a>            <span class="n">numThreads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="DictionarySpams-278"><a href="#DictionarySpams-278"><span class="linenos">278</span></a>            <span class="n">return_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-279"><a href="#DictionarySpams-279"><span class="linenos">279</span></a>            <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams-280"><a href="#DictionarySpams-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-281"><a href="#DictionarySpams-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">T</span>
</span><span id="DictionarySpams-282"><a href="#DictionarySpams-282"><span class="linenos">282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="DictionarySpams-283"><a href="#DictionarySpams-283"><span class="linenos">283</span></a>        <span class="n">tac</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DictionarySpams-284"><a href="#DictionarySpams-284"><span class="linenos">284</span></a>
</span><span id="DictionarySpams-285"><a href="#DictionarySpams-285"><span class="linenos">285</span></a>        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="DictionarySpams-286"><a href="#DictionarySpams-286"><span class="linenos">286</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams-287"><a href="#DictionarySpams-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-288"><a href="#DictionarySpams-288"><span class="linenos">288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="DictionarySpams-289"><a href="#DictionarySpams-289"><span class="linenos">289</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-290"><a href="#DictionarySpams-290"><span class="linenos">290</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams-291"><a href="#DictionarySpams-291"><span class="linenos">291</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="DictionarySpams-292"><a href="#DictionarySpams-292"><span class="linenos">292</span></a>
</span><span id="DictionarySpams-293"><a href="#DictionarySpams-293"><span class="linenos">293</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-294"><a href="#DictionarySpams-294"><span class="linenos">294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DictionarySpams-295"><a href="#DictionarySpams-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="DictionarySpams-296"><a href="#DictionarySpams-296"><span class="linenos">296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams-297"><a href="#DictionarySpams-297"><span class="linenos">297</span></a>
</span><span id="DictionarySpams-298"><a href="#DictionarySpams-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams-299"><a href="#DictionarySpams-299"><span class="linenos">299</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-300"><a href="#DictionarySpams-300"><span class="linenos">300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="DictionarySpams-301"><a href="#DictionarySpams-301"><span class="linenos">301</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-302"><a href="#DictionarySpams-302"><span class="linenos">302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams-303"><a href="#DictionarySpams-303"><span class="linenos">303</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="DictionarySpams-304"><a href="#DictionarySpams-304"><span class="linenos">304</span></a>
</span><span id="DictionarySpams-305"><a href="#DictionarySpams-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">):</span>
</span><span id="DictionarySpams-306"><a href="#DictionarySpams-306"><span class="linenos">306</span></a>        <span class="c1"># TODO: Add kwarg option to disable the patch normalization.</span>
</span><span id="DictionarySpams-307"><a href="#DictionarySpams-307"><span class="linenos">307</span></a>        <span class="c1"># This might be usefull for tasks such detection or when a heavy</span>
</span><span id="DictionarySpams-308"><a href="#DictionarySpams-308"><span class="linenos">308</span></a>        <span class="c1"># discrimination is needed.</span>
</span><span id="DictionarySpams-309"><a href="#DictionarySpams-309"><span class="linenos">309</span></a>        <span class="n">patches</span><span class="p">,</span> <span class="n">norms</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="DictionarySpams-310"><a href="#DictionarySpams-310"><span class="linenos">310</span></a>            <span class="n">signal</span><span class="p">,</span>
</span><span id="DictionarySpams-311"><a href="#DictionarySpams-311"><span class="linenos">311</span></a>            <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span>
</span><span id="DictionarySpams-312"><a href="#DictionarySpams-312"><span class="linenos">312</span></a>            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="DictionarySpams-313"><a href="#DictionarySpams-313"><span class="linenos">313</span></a>            <span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-314"><a href="#DictionarySpams-314"><span class="linenos">314</span></a>            <span class="n">return_norm_coefs</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DictionarySpams-315"><a href="#DictionarySpams-315"><span class="linenos">315</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-316"><a href="#DictionarySpams-316"><span class="linenos">316</span></a>        <span class="n">code</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">lasso</span><span class="p">(</span>
</span><span id="DictionarySpams-317"><a href="#DictionarySpams-317"><span class="linenos">317</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="DictionarySpams-318"><a href="#DictionarySpams-318"><span class="linenos">318</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="DictionarySpams-319"><a href="#DictionarySpams-319"><span class="linenos">319</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="DictionarySpams-320"><a href="#DictionarySpams-320"><span class="linenos">320</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span><span class="p">,</span>
</span><span id="DictionarySpams-321"><a href="#DictionarySpams-321"><span class="linenos">321</span></a>            <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="DictionarySpams-322"><a href="#DictionarySpams-322"><span class="linenos">322</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-323"><a href="#DictionarySpams-323"><span class="linenos">323</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">code</span><span class="p">)</span> <span class="o">*</span> <span class="n">norms</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="DictionarySpams-324"><a href="#DictionarySpams-324"><span class="linenos">324</span></a>
</span><span id="DictionarySpams-325"><a href="#DictionarySpams-325"><span class="linenos">325</span></a>        <span class="n">signal_rec</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">reconstruct_from_patches_1d</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><span id="DictionarySpams-326"><a href="#DictionarySpams-326"><span class="linenos">326</span></a>
</span><span id="DictionarySpams-327"><a href="#DictionarySpams-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span>
</span><span id="DictionarySpams-328"><a href="#DictionarySpams-328"><span class="linenos">328</span></a>
</span><span id="DictionarySpams-329"><a href="#DictionarySpams-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams-330"><a href="#DictionarySpams-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct a signal as a sparse combination of dictionary atoms.</span>
</span><span id="DictionarySpams-331"><a href="#DictionarySpams-331"><span class="linenos">331</span></a>
</span><span id="DictionarySpams-332"><a href="#DictionarySpams-332"><span class="linenos">332</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams-333"><a href="#DictionarySpams-333"><span class="linenos">333</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-334"><a href="#DictionarySpams-334"><span class="linenos">334</span></a><span class="sd">        signal : ndarray</span>
</span><span id="DictionarySpams-335"><a href="#DictionarySpams-335"><span class="linenos">335</span></a><span class="sd">            Sample to be reconstructed.</span>
</span><span id="DictionarySpams-336"><a href="#DictionarySpams-336"><span class="linenos">336</span></a>
</span><span id="DictionarySpams-337"><a href="#DictionarySpams-337"><span class="linenos">337</span></a><span class="sd">        sc_lambda : float</span>
</span><span id="DictionarySpams-338"><a href="#DictionarySpams-338"><span class="linenos">338</span></a><span class="sd">            Regularization parameter of the sparse coding transformation.</span>
</span><span id="DictionarySpams-339"><a href="#DictionarySpams-339"><span class="linenos">339</span></a>
</span><span id="DictionarySpams-340"><a href="#DictionarySpams-340"><span class="linenos">340</span></a><span class="sd">        step : int, 1 by default</span>
</span><span id="DictionarySpams-341"><a href="#DictionarySpams-341"><span class="linenos">341</span></a><span class="sd">            Sample interval between each patch extracted from signal.</span>
</span><span id="DictionarySpams-342"><a href="#DictionarySpams-342"><span class="linenos">342</span></a><span class="sd">            Determines the number of patches to be extracted. 1 by default.</span>
</span><span id="DictionarySpams-343"><a href="#DictionarySpams-343"><span class="linenos">343</span></a>
</span><span id="DictionarySpams-344"><a href="#DictionarySpams-344"><span class="linenos">344</span></a><span class="sd">        normed : boolean, True by default</span>
</span><span id="DictionarySpams-345"><a href="#DictionarySpams-345"><span class="linenos">345</span></a><span class="sd">            Normalize the result to the maximum absolute value.</span>
</span><span id="DictionarySpams-346"><a href="#DictionarySpams-346"><span class="linenos">346</span></a>
</span><span id="DictionarySpams-347"><a href="#DictionarySpams-347"><span class="linenos">347</span></a><span class="sd">        with_code : boolean, False by default.</span>
</span><span id="DictionarySpams-348"><a href="#DictionarySpams-348"><span class="linenos">348</span></a><span class="sd">            If True, also returns the coefficients array.</span>
</span><span id="DictionarySpams-349"><a href="#DictionarySpams-349"><span class="linenos">349</span></a>
</span><span id="DictionarySpams-350"><a href="#DictionarySpams-350"><span class="linenos">350</span></a><span class="sd">        **kwargs</span>
</span><span id="DictionarySpams-351"><a href="#DictionarySpams-351"><span class="linenos">351</span></a><span class="sd">            Passed directly to the external learning function.</span>
</span><span id="DictionarySpams-352"><a href="#DictionarySpams-352"><span class="linenos">352</span></a>
</span><span id="DictionarySpams-353"><a href="#DictionarySpams-353"><span class="linenos">353</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams-354"><a href="#DictionarySpams-354"><span class="linenos">354</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams-355"><a href="#DictionarySpams-355"><span class="linenos">355</span></a><span class="sd">        signal_rec : array</span>
</span><span id="DictionarySpams-356"><a href="#DictionarySpams-356"><span class="linenos">356</span></a><span class="sd">            Reconstructed signal.</span>
</span><span id="DictionarySpams-357"><a href="#DictionarySpams-357"><span class="linenos">357</span></a>
</span><span id="DictionarySpams-358"><a href="#DictionarySpams-358"><span class="linenos">358</span></a><span class="sd">        code : array(a_length, d_size), optional</span>
</span><span id="DictionarySpams-359"><a href="#DictionarySpams-359"><span class="linenos">359</span></a><span class="sd">            Transformed data, encoded as a sparse combination of atoms.</span>
</span><span id="DictionarySpams-360"><a href="#DictionarySpams-360"><span class="linenos">360</span></a><span class="sd">            Returned when &#39;with_code&#39; is True.</span>
</span><span id="DictionarySpams-361"><a href="#DictionarySpams-361"><span class="linenos">361</span></a>
</span><span id="DictionarySpams-362"><a href="#DictionarySpams-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-363"><a href="#DictionarySpams-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="DictionarySpams-364"><a href="#DictionarySpams-364"><span class="linenos">364</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;signal&#39; must be a numpy array&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-365"><a href="#DictionarySpams-365"><span class="linenos">365</span></a>
</span><span id="DictionarySpams-366"><a href="#DictionarySpams-366"><span class="linenos">366</span></a>        <span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DictionarySpams-367"><a href="#DictionarySpams-367"><span class="linenos">367</span></a>
</span><span id="DictionarySpams-368"><a href="#DictionarySpams-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">signal_rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams-369"><a href="#DictionarySpams-369"><span class="linenos">369</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_rec</span><span class="p">))</span>
</span><span id="DictionarySpams-370"><a href="#DictionarySpams-370"><span class="linenos">370</span></a>            <span class="n">signal_rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams-371"><a href="#DictionarySpams-371"><span class="linenos">371</span></a>            <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams-372"><a href="#DictionarySpams-372"><span class="linenos">372</span></a>
</span><span id="DictionarySpams-373"><a href="#DictionarySpams-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_code</span> <span class="k">else</span> <span class="n">signal_rec</span>
</span><span id="DictionarySpams-374"><a href="#DictionarySpams-374"><span class="linenos">374</span></a>
</span><span id="DictionarySpams-375"><a href="#DictionarySpams-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strains</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams-376"><a href="#DictionarySpams-376"><span class="linenos">376</span></a>        <span class="n">ns</span> <span class="o">=</span> <span class="n">strains</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams-377"><a href="#DictionarySpams-377"><span class="linenos">377</span></a>
</span><span id="DictionarySpams-378"><a href="#DictionarySpams-378"><span class="linenos">378</span></a>        <span class="n">patches</span><span class="p">,</span> <span class="n">norms</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="DictionarySpams-379"><a href="#DictionarySpams-379"><span class="linenos">379</span></a>            <span class="n">strains</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">l2_normed</span><span class="o">=</span><span class="n">normed_windows</span><span class="p">,</span>
</span><span id="DictionarySpams-380"><a href="#DictionarySpams-380"><span class="linenos">380</span></a>            <span class="n">return_norm_coefs</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DictionarySpams-381"><a href="#DictionarySpams-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-382"><a href="#DictionarySpams-382"><span class="linenos">382</span></a>        <span class="n">codes</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">lasso</span><span class="p">(</span>
</span><span id="DictionarySpams-383"><a href="#DictionarySpams-383"><span class="linenos">383</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="DictionarySpams-384"><a href="#DictionarySpams-384"><span class="linenos">384</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="DictionarySpams-385"><a href="#DictionarySpams-385"><span class="linenos">385</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="DictionarySpams-386"><a href="#DictionarySpams-386"><span class="linenos">386</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span><span class="p">,</span>
</span><span id="DictionarySpams-387"><a href="#DictionarySpams-387"><span class="linenos">387</span></a>            <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams-388"><a href="#DictionarySpams-388"><span class="linenos">388</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-389"><a href="#DictionarySpams-389"><span class="linenos">389</span></a>        
</span><span id="DictionarySpams-390"><a href="#DictionarySpams-390"><span class="linenos">390</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">codes</span><span class="p">)</span> <span class="o">*</span> <span class="n">norms</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="DictionarySpams-391"><a href="#DictionarySpams-391"><span class="linenos">391</span></a>        <span class="n">lp</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DictionarySpams-392"><a href="#DictionarySpams-392"><span class="linenos">392</span></a>        <span class="n">np_</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">ns</span>  <span class="c1"># Number of patches per strain</span>
</span><span id="DictionarySpams-393"><a href="#DictionarySpams-393"><span class="linenos">393</span></a>        <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">np_</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
</span><span id="DictionarySpams-394"><a href="#DictionarySpams-394"><span class="linenos">394</span></a>
</span><span id="DictionarySpams-395"><a href="#DictionarySpams-395"><span class="linenos">395</span></a>        <span class="n">reconstructions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">strains</span><span class="p">)</span>
</span><span id="DictionarySpams-396"><a href="#DictionarySpams-396"><span class="linenos">396</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
</span><span id="DictionarySpams-397"><a href="#DictionarySpams-397"><span class="linenos">397</span></a>            <span class="n">reconstructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">reconstruct_from_patches_1d</span><span class="p">(</span><span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
</span><span id="DictionarySpams-398"><a href="#DictionarySpams-398"><span class="linenos">398</span></a>
</span><span id="DictionarySpams-399"><a href="#DictionarySpams-399"><span class="linenos">399</span></a>        <span class="k">return</span> <span class="n">reconstructions</span>
</span><span id="DictionarySpams-400"><a href="#DictionarySpams-400"><span class="linenos">400</span></a>
</span><span id="DictionarySpams-401"><a href="#DictionarySpams-401"><span class="linenos">401</span></a>    <span class="k">def</span> <span class="nf">reconstruct_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-402"><a href="#DictionarySpams-402"><span class="linenos">402</span></a>                          <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams-403"><a href="#DictionarySpams-403"><span class="linenos">403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams-404"><a href="#DictionarySpams-404"><span class="linenos">404</span></a>
</span><span id="DictionarySpams-405"><a href="#DictionarySpams-405"><span class="linenos">405</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="DictionarySpams-406"><a href="#DictionarySpams-406"><span class="linenos">406</span></a><span class="sd">        dictionary atoms.</span>
</span><span id="DictionarySpams-407"><a href="#DictionarySpams-407"><span class="linenos">407</span></a>
</span><span id="DictionarySpams-408"><a href="#DictionarySpams-408"><span class="linenos">408</span></a><span class="sd">        WARNING: Only viable for small &#39;signals&#39; set, it is really memory</span>
</span><span id="DictionarySpams-409"><a href="#DictionarySpams-409"><span class="linenos">409</span></a><span class="sd">        expensive (all patches are stored in a single array in memory).</span>
</span><span id="DictionarySpams-410"><a href="#DictionarySpams-410"><span class="linenos">410</span></a>
</span><span id="DictionarySpams-411"><a href="#DictionarySpams-411"><span class="linenos">411</span></a><span class="sd">        WARNING: &#39;out&#39; deprecated, left for backwards compatibility but will</span>
</span><span id="DictionarySpams-412"><a href="#DictionarySpams-412"><span class="linenos">412</span></a><span class="sd">        be ignored if given.</span>
</span><span id="DictionarySpams-413"><a href="#DictionarySpams-413"><span class="linenos">413</span></a>
</span><span id="DictionarySpams-414"><a href="#DictionarySpams-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-415"><a href="#DictionarySpams-415"><span class="linenos">415</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DictionarySpams-416"><a href="#DictionarySpams-416"><span class="linenos">416</span></a>
</span><span id="DictionarySpams-417"><a href="#DictionarySpams-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams-418"><a href="#DictionarySpams-418"><span class="linenos">418</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams-419"><a href="#DictionarySpams-419"><span class="linenos">419</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams-420"><a href="#DictionarySpams-420"><span class="linenos">420</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams-421"><a href="#DictionarySpams-421"><span class="linenos">421</span></a>
</span><span id="DictionarySpams-422"><a href="#DictionarySpams-422"><span class="linenos">422</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="DictionarySpams-423"><a href="#DictionarySpams-423"><span class="linenos">423</span></a>
</span><span id="DictionarySpams-424"><a href="#DictionarySpams-424"><span class="linenos">424</span></a>    <span class="k">def</span> <span class="nf">reconstruct_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-425"><a href="#DictionarySpams-425"><span class="linenos">425</span></a>                              <span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams-426"><a href="#DictionarySpams-426"><span class="linenos">426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams-427"><a href="#DictionarySpams-427"><span class="linenos">427</span></a>
</span><span id="DictionarySpams-428"><a href="#DictionarySpams-428"><span class="linenos">428</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="DictionarySpams-429"><a href="#DictionarySpams-429"><span class="linenos">429</span></a><span class="sd">        dictionary atoms. Minibatch version.</span>
</span><span id="DictionarySpams-430"><a href="#DictionarySpams-430"><span class="linenos">430</span></a>
</span><span id="DictionarySpams-431"><a href="#DictionarySpams-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-432"><a href="#DictionarySpams-432"><span class="linenos">432</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams-433"><a href="#DictionarySpams-433"><span class="linenos">433</span></a>        <span class="n">n_minibatch</span> <span class="o">=</span> <span class="n">n_signals</span> <span class="o">//</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams-434"><a href="#DictionarySpams-434"><span class="linenos">434</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>
</span><span id="DictionarySpams-435"><a href="#DictionarySpams-435"><span class="linenos">435</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_minibatch</span><span class="p">)</span>
</span><span id="DictionarySpams-436"><a href="#DictionarySpams-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams-437"><a href="#DictionarySpams-437"><span class="linenos">437</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
</span><span id="DictionarySpams-438"><a href="#DictionarySpams-438"><span class="linenos">438</span></a>        
</span><span id="DictionarySpams-439"><a href="#DictionarySpams-439"><span class="linenos">439</span></a>        <span class="k">for</span> <span class="n">ibatch</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="DictionarySpams-440"><a href="#DictionarySpams-440"><span class="linenos">440</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">ibatch</span> <span class="o">*</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams-441"><a href="#DictionarySpams-441"><span class="linenos">441</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams-442"><a href="#DictionarySpams-442"><span class="linenos">442</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span>
</span><span id="DictionarySpams-443"><a href="#DictionarySpams-443"><span class="linenos">443</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="DictionarySpams-444"><a href="#DictionarySpams-444"><span class="linenos">444</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed_windows</span><span class="o">=</span><span class="n">normed_windows</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams-445"><a href="#DictionarySpams-445"><span class="linenos">445</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-446"><a href="#DictionarySpams-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="n">n_minibatch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams-447"><a href="#DictionarySpams-447"><span class="linenos">447</span></a>            <span class="c1"># In case there was no point in using a minibatch:</span>
</span><span id="DictionarySpams-448"><a href="#DictionarySpams-448"><span class="linenos">448</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DictionarySpams-449"><a href="#DictionarySpams-449"><span class="linenos">449</span></a>
</span><span id="DictionarySpams-450"><a href="#DictionarySpams-450"><span class="linenos">450</span></a>        <span class="c1"># If &#39;n_signals&#39; was not divisible by &#39;batchsize&#39; reconstruct the</span>
</span><span id="DictionarySpams-451"><a href="#DictionarySpams-451"><span class="linenos">451</span></a>        <span class="c1"># remaining signals:</span>
</span><span id="DictionarySpams-452"><a href="#DictionarySpams-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">n_signals</span><span class="p">:</span>
</span><span id="DictionarySpams-453"><a href="#DictionarySpams-453"><span class="linenos">453</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">i1</span>
</span><span id="DictionarySpams-454"><a href="#DictionarySpams-454"><span class="linenos">454</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span>
</span><span id="DictionarySpams-455"><a href="#DictionarySpams-455"><span class="linenos">455</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="DictionarySpams-456"><a href="#DictionarySpams-456"><span class="linenos">456</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams-457"><a href="#DictionarySpams-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-458"><a href="#DictionarySpams-458"><span class="linenos">458</span></a>
</span><span id="DictionarySpams-459"><a href="#DictionarySpams-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams-460"><a href="#DictionarySpams-460"><span class="linenos">460</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams-461"><a href="#DictionarySpams-461"><span class="linenos">461</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams-462"><a href="#DictionarySpams-462"><span class="linenos">462</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams-463"><a href="#DictionarySpams-463"><span class="linenos">463</span></a>
</span><span id="DictionarySpams-464"><a href="#DictionarySpams-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="DictionarySpams-465"><a href="#DictionarySpams-465"><span class="linenos">465</span></a>
</span><span id="DictionarySpams-466"><a href="#DictionarySpams-466"><span class="linenos">466</span></a>    <span class="k">def</span> <span class="nf">reconstruct_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">zero_marg</span><span class="p">,</span> <span class="n">lambda_lims</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-467"><a href="#DictionarySpams-467"><span class="linenos">467</span></a>                         <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kwargs_bisect</span><span class="o">=</span><span class="p">{},</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DictionarySpams-468"><a href="#DictionarySpams-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams-469"><a href="#DictionarySpams-469"><span class="linenos">469</span></a>
</span><span id="DictionarySpams-470"><a href="#DictionarySpams-470"><span class="linenos">470</span></a><span class="sd">        Reconstrueix un nic senyal buscant per bisecci la lambda que</span>
</span><span id="DictionarySpams-471"><a href="#DictionarySpams-471"><span class="linenos">471</span></a><span class="sd">        minimitza el senyal reconstruit al marge esquerre del senyal, la mida</span>
</span><span id="DictionarySpams-472"><a href="#DictionarySpams-472"><span class="linenos">472</span></a><span class="sd">        dels quals ve determinada per &#39;zero_marg&#39;.</span>
</span><span id="DictionarySpams-473"><a href="#DictionarySpams-473"><span class="linenos">473</span></a>
</span><span id="DictionarySpams-474"><a href="#DictionarySpams-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-475"><a href="#DictionarySpams-475"><span class="linenos">475</span></a>        <span class="c1"># Margins of the signals to be zeroed</span>
</span><span id="DictionarySpams-476"><a href="#DictionarySpams-476"><span class="linenos">476</span></a>        <span class="n">margin</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[:</span><span class="n">zero_marg</span><span class="p">]</span>
</span><span id="DictionarySpams-477"><a href="#DictionarySpams-477"><span class="linenos">477</span></a>        <span class="c1"># Function to be bisected.</span>
</span><span id="DictionarySpams-478"><a href="#DictionarySpams-478"><span class="linenos">478</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">sc_lambda</span><span class="p">):</span>
</span><span id="DictionarySpams-479"><a href="#DictionarySpams-479"><span class="linenos">479</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams-480"><a href="#DictionarySpams-480"><span class="linenos">480</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="DictionarySpams-481"><a href="#DictionarySpams-481"><span class="linenos">481</span></a>
</span><span id="DictionarySpams-482"><a href="#DictionarySpams-482"><span class="linenos">482</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DictionarySpams-483"><a href="#DictionarySpams-483"><span class="linenos">483</span></a>            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="DictionarySpams-484"><a href="#DictionarySpams-484"><span class="linenos">484</span></a>                <span class="c1"># Ignore specific warning from extract_patches since here we do</span>
</span><span id="DictionarySpams-485"><a href="#DictionarySpams-485"><span class="linenos">485</span></a>                <span class="c1"># not care about reconstructing the entire strain (margin).</span>
</span><span id="DictionarySpams-486"><a href="#DictionarySpams-486"><span class="linenos">486</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;&#39;signals&#39; cannot be fully divided into patches.*&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-487"><a href="#DictionarySpams-487"><span class="linenos">487</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">semibool_bisect</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">*</span><span class="n">lambda_lims</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_bisect</span><span class="p">)</span>
</span><span id="DictionarySpams-488"><a href="#DictionarySpams-488"><span class="linenos">488</span></a>        
</span><span id="DictionarySpams-489"><a href="#DictionarySpams-489"><span class="linenos">489</span></a>        <span class="k">except</span> <span class="n">lib</span><span class="o">.</span><span class="n">BoundaryError</span><span class="p">:</span>
</span><span id="DictionarySpams-490"><a href="#DictionarySpams-490"><span class="linenos">490</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
</span><span id="DictionarySpams-491"><a href="#DictionarySpams-491"><span class="linenos">491</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams-492"><a href="#DictionarySpams-492"><span class="linenos">492</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lambda_lims</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;converged&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;niters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;funcalls&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span><span id="DictionarySpams-493"><a href="#DictionarySpams-493"><span class="linenos">493</span></a>        
</span><span id="DictionarySpams-494"><a href="#DictionarySpams-494"><span class="linenos">494</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-495"><a href="#DictionarySpams-495"><span class="linenos">495</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams-496"><a href="#DictionarySpams-496"><span class="linenos">496</span></a>            <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams-497"><a href="#DictionarySpams-497"><span class="linenos">497</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="DictionarySpams-498"><a href="#DictionarySpams-498"><span class="linenos">498</span></a>                <span class="n">rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams-499"><a href="#DictionarySpams-499"><span class="linenos">499</span></a>                <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams-500"><a href="#DictionarySpams-500"><span class="linenos">500</span></a>
</span><span id="DictionarySpams-501"><a href="#DictionarySpams-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">rec</span>
</span><span id="DictionarySpams-502"><a href="#DictionarySpams-502"><span class="linenos">502</span></a>
</span><span id="DictionarySpams-503"><a href="#DictionarySpams-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">reconstruct_iterative_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
</span><span id="DictionarySpams-504"><a href="#DictionarySpams-504"><span class="linenos">504</span></a>                                        <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams-505"><a href="#DictionarySpams-505"><span class="linenos">505</span></a>                                        <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DictionarySpams-506"><a href="#DictionarySpams-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct multiple signals using iterative residual subtraction.</span>
</span><span id="DictionarySpams-507"><a href="#DictionarySpams-507"><span class="linenos">507</span></a>
</span><span id="DictionarySpams-508"><a href="#DictionarySpams-508"><span class="linenos">508</span></a><span class="sd">        This method reconstructs each signal by iteratively updating and</span>
</span><span id="DictionarySpams-509"><a href="#DictionarySpams-509"><span class="linenos">509</span></a><span class="sd">        accumulating reconstructions. In the first iteration, the original </span>
</span><span id="DictionarySpams-510"><a href="#DictionarySpams-510"><span class="linenos">510</span></a><span class="sd">        input signal is reconstructed and then subtracted from itself to </span>
</span><span id="DictionarySpams-511"><a href="#DictionarySpams-511"><span class="linenos">511</span></a><span class="sd">        obtain the initial residual. In each subsequent iteration, a new </span>
</span><span id="DictionarySpams-512"><a href="#DictionarySpams-512"><span class="linenos">512</span></a><span class="sd">        reconstruction is generated from the current residual and subtracted </span>
</span><span id="DictionarySpams-513"><a href="#DictionarySpams-513"><span class="linenos">513</span></a><span class="sd">        from it, producing an updated residual for the next iteration, while </span>
</span><span id="DictionarySpams-514"><a href="#DictionarySpams-514"><span class="linenos">514</span></a><span class="sd">        also being added to the cumulative reconstruction. The process </span>
</span><span id="DictionarySpams-515"><a href="#DictionarySpams-515"><span class="linenos">515</span></a><span class="sd">        repeats until the Euclidean norm of the difference between consecutive </span>
</span><span id="DictionarySpams-516"><a href="#DictionarySpams-516"><span class="linenos">516</span></a><span class="sd">        residuals falls below a specified threshold, which sets the convergence </span>
</span><span id="DictionarySpams-517"><a href="#DictionarySpams-517"><span class="linenos">517</span></a><span class="sd">        criterion.</span>
</span><span id="DictionarySpams-518"><a href="#DictionarySpams-518"><span class="linenos">518</span></a>
</span><span id="DictionarySpams-519"><a href="#DictionarySpams-519"><span class="linenos">519</span></a><span class="sd">        NOTE: In contrast with the usual procedure, the windows into which each</span>
</span><span id="DictionarySpams-520"><a href="#DictionarySpams-520"><span class="linenos">520</span></a><span class="sd">        signal is split are not normalized. This is needed to enhance the</span>
</span><span id="DictionarySpams-521"><a href="#DictionarySpams-521"><span class="linenos">521</span></a><span class="sd">        dictionary discrimination. Otherwise, the residuals are amplified at</span>
</span><span id="DictionarySpams-522"><a href="#DictionarySpams-522"><span class="linenos">522</span></a><span class="sd">        each iteration, the algorithm takes longer to converge, and some</span>
</span><span id="DictionarySpams-523"><a href="#DictionarySpams-523"><span class="linenos">523</span></a><span class="sd">        ad-hoc tests showed it also messes up with the resulting shape.</span>
</span><span id="DictionarySpams-524"><a href="#DictionarySpams-524"><span class="linenos">524</span></a>
</span><span id="DictionarySpams-525"><a href="#DictionarySpams-525"><span class="linenos">525</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams-526"><a href="#DictionarySpams-526"><span class="linenos">526</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-527"><a href="#DictionarySpams-527"><span class="linenos">527</span></a><span class="sd">        signals : ndarray</span>
</span><span id="DictionarySpams-528"><a href="#DictionarySpams-528"><span class="linenos">528</span></a><span class="sd">            Input signals to be reconstructed, with each signal along the first dimension.</span>
</span><span id="DictionarySpams-529"><a href="#DictionarySpams-529"><span class="linenos">529</span></a><span class="sd">        sc_lambda : float, optional</span>
</span><span id="DictionarySpams-530"><a href="#DictionarySpams-530"><span class="linenos">530</span></a><span class="sd">            Sparsity control parameter for reconstruction.</span>
</span><span id="DictionarySpams-531"><a href="#DictionarySpams-531"><span class="linenos">531</span></a><span class="sd">        step : int, optional</span>
</span><span id="DictionarySpams-532"><a href="#DictionarySpams-532"><span class="linenos">532</span></a><span class="sd">            Step size for the reconstruction.</span>
</span><span id="DictionarySpams-533"><a href="#DictionarySpams-533"><span class="linenos">533</span></a><span class="sd">        batchsize : int, optional</span>
</span><span id="DictionarySpams-534"><a href="#DictionarySpams-534"><span class="linenos">534</span></a><span class="sd">            Number of signals processed in each minibatch.</span>
</span><span id="DictionarySpams-535"><a href="#DictionarySpams-535"><span class="linenos">535</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="DictionarySpams-536"><a href="#DictionarySpams-536"><span class="linenos">536</span></a><span class="sd">            Maximum number of iterations before stopping.</span>
</span><span id="DictionarySpams-537"><a href="#DictionarySpams-537"><span class="linenos">537</span></a><span class="sd">        threshold : float, optional</span>
</span><span id="DictionarySpams-538"><a href="#DictionarySpams-538"><span class="linenos">538</span></a><span class="sd">            Convergence threshold based on the relative change in residuals.</span>
</span><span id="DictionarySpams-539"><a href="#DictionarySpams-539"><span class="linenos">539</span></a><span class="sd">        normed : bool, optional</span>
</span><span id="DictionarySpams-540"><a href="#DictionarySpams-540"><span class="linenos">540</span></a><span class="sd">            If True, the reconstructed signals are normalized after convergence.</span>
</span><span id="DictionarySpams-541"><a href="#DictionarySpams-541"><span class="linenos">541</span></a><span class="sd">        full_output : bool, optional</span>
</span><span id="DictionarySpams-542"><a href="#DictionarySpams-542"><span class="linenos">542</span></a><span class="sd">            If True, returns additional output values (residuals and iteration counts).</span>
</span><span id="DictionarySpams-543"><a href="#DictionarySpams-543"><span class="linenos">543</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="DictionarySpams-544"><a href="#DictionarySpams-544"><span class="linenos">544</span></a><span class="sd">            If True, prints progress information at each iteration.</span>
</span><span id="DictionarySpams-545"><a href="#DictionarySpams-545"><span class="linenos">545</span></a><span class="sd">        kwargs_lasso : dict, optional</span>
</span><span id="DictionarySpams-546"><a href="#DictionarySpams-546"><span class="linenos">546</span></a><span class="sd">            Additional arguments for the Lasso reconstruction method.</span>
</span><span id="DictionarySpams-547"><a href="#DictionarySpams-547"><span class="linenos">547</span></a>
</span><span id="DictionarySpams-548"><a href="#DictionarySpams-548"><span class="linenos">548</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams-549"><a href="#DictionarySpams-549"><span class="linenos">549</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams-550"><a href="#DictionarySpams-550"><span class="linenos">550</span></a><span class="sd">        ndarray or tuple</span>
</span><span id="DictionarySpams-551"><a href="#DictionarySpams-551"><span class="linenos">551</span></a><span class="sd">            The final reconstructed signals. If `full_output` is True, also returns the residuals</span>
</span><span id="DictionarySpams-552"><a href="#DictionarySpams-552"><span class="linenos">552</span></a><span class="sd">            and the number of iterations per signal.</span>
</span><span id="DictionarySpams-553"><a href="#DictionarySpams-553"><span class="linenos">553</span></a>
</span><span id="DictionarySpams-554"><a href="#DictionarySpams-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-555"><a href="#DictionarySpams-555"><span class="linenos">555</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams-556"><a href="#DictionarySpams-556"><span class="linenos">556</span></a>
</span><span id="DictionarySpams-557"><a href="#DictionarySpams-557"><span class="linenos">557</span></a>        <span class="c1"># First iteration outside:</span>
</span><span id="DictionarySpams-558"><a href="#DictionarySpams-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams-559"><a href="#DictionarySpams-559"><span class="linenos">559</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration 0&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-560"><a href="#DictionarySpams-560"><span class="linenos">560</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="n">n_signals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-561"><a href="#DictionarySpams-561"><span class="linenos">561</span></a>        
</span><span id="DictionarySpams-562"><a href="#DictionarySpams-562"><span class="linenos">562</span></a>        <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="DictionarySpams-563"><a href="#DictionarySpams-563"><span class="linenos">563</span></a>            <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="DictionarySpams-564"><a href="#DictionarySpams-564"><span class="linenos">564</span></a>            <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="DictionarySpams-565"><a href="#DictionarySpams-565"><span class="linenos">565</span></a>            <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="DictionarySpams-566"><a href="#DictionarySpams-566"><span class="linenos">566</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="DictionarySpams-567"><a href="#DictionarySpams-567"><span class="linenos">567</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-568"><a href="#DictionarySpams-568"><span class="linenos">568</span></a>        <span class="n">final_reconstructions</span> <span class="o">=</span> <span class="n">step_reconstructions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams-569"><a href="#DictionarySpams-569"><span class="linenos">569</span></a>        <span class="n">residuals</span> <span class="o">=</span> <span class="n">signals</span> <span class="o">-</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams-570"><a href="#DictionarySpams-570"><span class="linenos">570</span></a>
</span><span id="DictionarySpams-571"><a href="#DictionarySpams-571"><span class="linenos">571</span></a>        <span class="c1"># Stop conditions</span>
</span><span id="DictionarySpams-572"><a href="#DictionarySpams-572"><span class="linenos">572</span></a>        <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_signals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="DictionarySpams-573"><a href="#DictionarySpams-573"><span class="linenos">573</span></a>        <span class="n">finished</span> <span class="o">=</span> <span class="o">~</span><span class="n">step_reconstructions</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># In case any reconstructions are 0 already.</span>
</span><span id="DictionarySpams-574"><a href="#DictionarySpams-574"><span class="linenos">574</span></a>        <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams-575"><a href="#DictionarySpams-575"><span class="linenos">575</span></a>
</span><span id="DictionarySpams-576"><a href="#DictionarySpams-576"><span class="linenos">576</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="ow">and</span> <span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">:</span>
</span><span id="DictionarySpams-577"><a href="#DictionarySpams-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams-578"><a href="#DictionarySpams-578"><span class="linenos">578</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration </span><span class="si">{</span><span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-579"><a href="#DictionarySpams-579"><span class="linenos">579</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="p">(</span><span class="o">~</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">^13d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-580"><a href="#DictionarySpams-580"><span class="linenos">580</span></a>
</span><span id="DictionarySpams-581"><a href="#DictionarySpams-581"><span class="linenos">581</span></a>            <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="DictionarySpams-582"><a href="#DictionarySpams-582"><span class="linenos">582</span></a>                <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span>
</span><span id="DictionarySpams-583"><a href="#DictionarySpams-583"><span class="linenos">583</span></a>                <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="DictionarySpams-584"><a href="#DictionarySpams-584"><span class="linenos">584</span></a>                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="DictionarySpams-585"><a href="#DictionarySpams-585"><span class="linenos">585</span></a>                <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="DictionarySpams-586"><a href="#DictionarySpams-586"><span class="linenos">586</span></a>                <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="DictionarySpams-587"><a href="#DictionarySpams-587"><span class="linenos">587</span></a>                <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="DictionarySpams-588"><a href="#DictionarySpams-588"><span class="linenos">588</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="DictionarySpams-589"><a href="#DictionarySpams-589"><span class="linenos">589</span></a>                <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="DictionarySpams-590"><a href="#DictionarySpams-590"><span class="linenos">590</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-591"><a href="#DictionarySpams-591"><span class="linenos">591</span></a>            <span class="n">final_reconstructions</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams-592"><a href="#DictionarySpams-592"><span class="linenos">592</span></a>            <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams-593"><a href="#DictionarySpams-593"><span class="linenos">593</span></a>
</span><span id="DictionarySpams-594"><a href="#DictionarySpams-594"><span class="linenos">594</span></a>            <span class="c1"># Stop conditions</span>
</span><span id="DictionarySpams-595"><a href="#DictionarySpams-595"><span class="linenos">595</span></a>            <span class="n">iters</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DictionarySpams-596"><a href="#DictionarySpams-596"><span class="linenos">596</span></a>            <span class="n">residual_decrease</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-</span> <span class="n">residuals_old</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DictionarySpams-597"><a href="#DictionarySpams-597"><span class="linenos">597</span></a>            <span class="n">finished</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual_decrease</span> <span class="o">&lt;</span> <span class="n">threshold</span>
</span><span id="DictionarySpams-598"><a href="#DictionarySpams-598"><span class="linenos">598</span></a>            <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams-599"><a href="#DictionarySpams-599"><span class="linenos">599</span></a>
</span><span id="DictionarySpams-600"><a href="#DictionarySpams-600"><span class="linenos">600</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams-601"><a href="#DictionarySpams-601"><span class="linenos">601</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams-602"><a href="#DictionarySpams-602"><span class="linenos">602</span></a>                    <span class="s2">&quot;CURRENT RESIDUAL DECREASE:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-603"><a href="#DictionarySpams-603"><span class="linenos">603</span></a>                    <span class="sa">f</span><span class="s2">&quot;Max: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-604"><a href="#DictionarySpams-604"><span class="linenos">604</span></a>                    <span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-605"><a href="#DictionarySpams-605"><span class="linenos">605</span></a>                    <span class="sa">f</span><span class="s2">&quot;Min: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-606"><a href="#DictionarySpams-606"><span class="linenos">606</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams-607"><a href="#DictionarySpams-607"><span class="linenos">607</span></a>
</span><span id="DictionarySpams-608"><a href="#DictionarySpams-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">):</span>
</span><span id="DictionarySpams-609"><a href="#DictionarySpams-609"><span class="linenos">609</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: reached max_iter before finishing all the reconstructions&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-610"><a href="#DictionarySpams-610"><span class="linenos">610</span></a>
</span><span id="DictionarySpams-611"><a href="#DictionarySpams-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
</span><span id="DictionarySpams-612"><a href="#DictionarySpams-612"><span class="linenos">612</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams-613"><a href="#DictionarySpams-613"><span class="linenos">613</span></a>                <span class="n">final_reconstructions</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams-614"><a href="#DictionarySpams-614"><span class="linenos">614</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams-615"><a href="#DictionarySpams-615"><span class="linenos">615</span></a>        
</span><span id="DictionarySpams-616"><a href="#DictionarySpams-616"><span class="linenos">616</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">final_reconstructions</span>
</span><span id="DictionarySpams-617"><a href="#DictionarySpams-617"><span class="linenos">617</span></a>
</span><span id="DictionarySpams-618"><a href="#DictionarySpams-618"><span class="linenos">618</span></a>
</span><span id="DictionarySpams-619"><a href="#DictionarySpams-619"><span class="linenos">619</span></a>    <span class="k">def</span> <span class="nf">optimum_reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strain</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">kwargs_minimize</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="p">,</span>
</span><span id="DictionarySpams-620"><a href="#DictionarySpams-620"><span class="linenos">620</span></a>                            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DictionarySpams-621"><a href="#DictionarySpams-621"><span class="linenos">621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the best reconstruction of a signal w.r.t. a reference.</span>
</span><span id="DictionarySpams-622"><a href="#DictionarySpams-622"><span class="linenos">622</span></a>
</span><span id="DictionarySpams-623"><a href="#DictionarySpams-623"><span class="linenos">623</span></a><span class="sd">        Find the lambda which produces a reconstruction of the</span>
</span><span id="DictionarySpams-624"><a href="#DictionarySpams-624"><span class="linenos">624</span></a><span class="sd">        input &#39;strain&#39; closest to the given &#39;reference&#39;, comparing them with</span>
</span><span id="DictionarySpams-625"><a href="#DictionarySpams-625"><span class="linenos">625</span></a><span class="sd">        the SSIM estimator. The search is performed by the SciPy&#39;s function</span>
</span><span id="DictionarySpams-626"><a href="#DictionarySpams-626"><span class="linenos">626</span></a><span class="sd">        &#39;minimize_scalar&#39; with bounds.</span>
</span><span id="DictionarySpams-627"><a href="#DictionarySpams-627"><span class="linenos">627</span></a>
</span><span id="DictionarySpams-628"><a href="#DictionarySpams-628"><span class="linenos">628</span></a><span class="sd">        PARAMETERS</span>
</span><span id="DictionarySpams-629"><a href="#DictionarySpams-629"><span class="linenos">629</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams-630"><a href="#DictionarySpams-630"><span class="linenos">630</span></a><span class="sd">        strain: ndarray</span>
</span><span id="DictionarySpams-631"><a href="#DictionarySpams-631"><span class="linenos">631</span></a><span class="sd">            Input strain to be reconstructed (and optimized).</span>
</span><span id="DictionarySpams-632"><a href="#DictionarySpams-632"><span class="linenos">632</span></a>
</span><span id="DictionarySpams-633"><a href="#DictionarySpams-633"><span class="linenos">633</span></a><span class="sd">        reference: ndarray</span>
</span><span id="DictionarySpams-634"><a href="#DictionarySpams-634"><span class="linenos">634</span></a><span class="sd">            Reference strain which to compare the reconstruction to.</span>
</span><span id="DictionarySpams-635"><a href="#DictionarySpams-635"><span class="linenos">635</span></a>
</span><span id="DictionarySpams-636"><a href="#DictionarySpams-636"><span class="linenos">636</span></a><span class="sd">        kwargs_minimize: dict</span>
</span><span id="DictionarySpams-637"><a href="#DictionarySpams-637"><span class="linenos">637</span></a><span class="sd">            Passed to SciPy&#39;s `minimize_scalar(**kwargs_minimize)`.</span>
</span><span id="DictionarySpams-638"><a href="#DictionarySpams-638"><span class="linenos">638</span></a>
</span><span id="DictionarySpams-639"><a href="#DictionarySpams-639"><span class="linenos">639</span></a><span class="sd">        kwargs_lasso: dict</span>
</span><span id="DictionarySpams-640"><a href="#DictionarySpams-640"><span class="linenos">640</span></a><span class="sd">            Passed to Python-Spams&#39; `lasso(**kwargs_lasso)`.</span>
</span><span id="DictionarySpams-641"><a href="#DictionarySpams-641"><span class="linenos">641</span></a>
</span><span id="DictionarySpams-642"><a href="#DictionarySpams-642"><span class="linenos">642</span></a><span class="sd">        step: int, optional</span>
</span><span id="DictionarySpams-643"><a href="#DictionarySpams-643"><span class="linenos">643</span></a><span class="sd">            Separation in samples between each window into which the input</span>
</span><span id="DictionarySpams-644"><a href="#DictionarySpams-644"><span class="linenos">644</span></a><span class="sd">            strain is split up to be reconstructed by the dictionary. Defaults</span>
</span><span id="DictionarySpams-645"><a href="#DictionarySpams-645"><span class="linenos">645</span></a><span class="sd">            to 1.</span>
</span><span id="DictionarySpams-646"><a href="#DictionarySpams-646"><span class="linenos">646</span></a>
</span><span id="DictionarySpams-647"><a href="#DictionarySpams-647"><span class="linenos">647</span></a><span class="sd">        limits: array-like, optional</span>
</span><span id="DictionarySpams-648"><a href="#DictionarySpams-648"><span class="linenos">648</span></a><span class="sd">            Indices of limits to where compute the loss between the</span>
</span><span id="DictionarySpams-649"><a href="#DictionarySpams-649"><span class="linenos">649</span></a><span class="sd">            reconstruction and the reference strain.</span>
</span><span id="DictionarySpams-650"><a href="#DictionarySpams-650"><span class="linenos">650</span></a>
</span><span id="DictionarySpams-651"><a href="#DictionarySpams-651"><span class="linenos">651</span></a><span class="sd">        normed: bool, optional</span>
</span><span id="DictionarySpams-652"><a href="#DictionarySpams-652"><span class="linenos">652</span></a><span class="sd">            If True, returns the signal normed to its maximum absolute amplitude.</span>
</span><span id="DictionarySpams-653"><a href="#DictionarySpams-653"><span class="linenos">653</span></a>
</span><span id="DictionarySpams-654"><a href="#DictionarySpams-654"><span class="linenos">654</span></a><span class="sd">        verbose: bool, optional</span>
</span><span id="DictionarySpams-655"><a href="#DictionarySpams-655"><span class="linenos">655</span></a><span class="sd">            Print info about the minimization results. False by default.</span>
</span><span id="DictionarySpams-656"><a href="#DictionarySpams-656"><span class="linenos">656</span></a>
</span><span id="DictionarySpams-657"><a href="#DictionarySpams-657"><span class="linenos">657</span></a><span class="sd">        RETURNS</span>
</span><span id="DictionarySpams-658"><a href="#DictionarySpams-658"><span class="linenos">658</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams-659"><a href="#DictionarySpams-659"><span class="linenos">659</span></a><span class="sd">        rec: ndarray</span>
</span><span id="DictionarySpams-660"><a href="#DictionarySpams-660"><span class="linenos">660</span></a><span class="sd">            Optimum reconstruction found.</span>
</span><span id="DictionarySpams-661"><a href="#DictionarySpams-661"><span class="linenos">661</span></a>
</span><span id="DictionarySpams-662"><a href="#DictionarySpams-662"><span class="linenos">662</span></a><span class="sd">        l_opt: float</span>
</span><span id="DictionarySpams-663"><a href="#DictionarySpams-663"><span class="linenos">663</span></a><span class="sd">            Optimum value for lambda.</span>
</span><span id="DictionarySpams-664"><a href="#DictionarySpams-664"><span class="linenos">664</span></a>
</span><span id="DictionarySpams-665"><a href="#DictionarySpams-665"><span class="linenos">665</span></a><span class="sd">        loss: float</span>
</span><span id="DictionarySpams-666"><a href="#DictionarySpams-666"><span class="linenos">666</span></a><span class="sd">            ISSIM (1 - SSIM) between the optimized reconstruction and the</span>
</span><span id="DictionarySpams-667"><a href="#DictionarySpams-667"><span class="linenos">667</span></a><span class="sd">            reference.</span>
</span><span id="DictionarySpams-668"><a href="#DictionarySpams-668"><span class="linenos">668</span></a>
</span><span id="DictionarySpams-669"><a href="#DictionarySpams-669"><span class="linenos">669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-670"><a href="#DictionarySpams-670"><span class="linenos">670</span></a>        <span class="n">aa</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="DictionarySpams-671"><a href="#DictionarySpams-671"><span class="linenos">671</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># max(issim) x bb as the minimu value for the auxiliar line function.</span>
</span><span id="DictionarySpams-672"><a href="#DictionarySpams-672"><span class="linenos">672</span></a>        <span class="n">rec</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams-673"><a href="#DictionarySpams-673"><span class="linenos">673</span></a>        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-674"><a href="#DictionarySpams-674"><span class="linenos">674</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="DictionarySpams-675"><a href="#DictionarySpams-675"><span class="linenos">675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-676"><a href="#DictionarySpams-676"><span class="linenos">676</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">limits</span><span class="p">)</span>
</span><span id="DictionarySpams-677"><a href="#DictionarySpams-677"><span class="linenos">677</span></a>        <span class="n">reference_</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>
</span><span id="DictionarySpams-678"><a href="#DictionarySpams-678"><span class="linenos">678</span></a>
</span><span id="DictionarySpams-679"><a href="#DictionarySpams-679"><span class="linenos">679</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">l_rec_log</span><span class="p">):</span>
</span><span id="DictionarySpams-680"><a href="#DictionarySpams-680"><span class="linenos">680</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Function to be minimized.&quot;&quot;&quot;</span>
</span><span id="DictionarySpams-681"><a href="#DictionarySpams-681"><span class="linenos">681</span></a>            <span class="k">nonlocal</span> <span class="n">rec</span>
</span><span id="DictionarySpams-682"><a href="#DictionarySpams-682"><span class="linenos">682</span></a>            <span class="n">l_rec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">l_rec_log</span>  <span class="c1"># Opitimizes lambda in log. space!</span>
</span><span id="DictionarySpams-683"><a href="#DictionarySpams-683"><span class="linenos">683</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">l_rec</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams-684"><a href="#DictionarySpams-684"><span class="linenos">684</span></a>            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams-685"><a href="#DictionarySpams-685"><span class="linenos">685</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">estimators</span><span class="o">.</span><span class="n">issim</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">sl</span><span class="p">],</span> <span class="n">reference_</span><span class="p">)</span>
</span><span id="DictionarySpams-686"><a href="#DictionarySpams-686"><span class="linenos">686</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-687"><a href="#DictionarySpams-687"><span class="linenos">687</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">aa</span> <span class="o">*</span> <span class="n">l_rec</span> <span class="o">+</span> <span class="n">bb</span>
</span><span id="DictionarySpams-688"><a href="#DictionarySpams-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="DictionarySpams-689"><a href="#DictionarySpams-689"><span class="linenos">689</span></a>
</span><span id="DictionarySpams-690"><a href="#DictionarySpams-690"><span class="linenos">690</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_minimize</span><span class="p">)</span>
</span><span id="DictionarySpams-691"><a href="#DictionarySpams-691"><span class="linenos">691</span></a>        <span class="n">l_opt</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-692"><a href="#DictionarySpams-692"><span class="linenos">692</span></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-693"><a href="#DictionarySpams-693"><span class="linenos">693</span></a>
</span><span id="DictionarySpams-694"><a href="#DictionarySpams-694"><span class="linenos">694</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams-695"><a href="#DictionarySpams-695"><span class="linenos">695</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-696"><a href="#DictionarySpams-696"><span class="linenos">696</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams-697"><a href="#DictionarySpams-697"><span class="linenos">697</span></a>                <span class="s2">&quot;Optimization results:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-698"><a href="#DictionarySpams-698"><span class="linenos">698</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Minimization success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-699"><a href="#DictionarySpams-699"><span class="linenos">699</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-700"><a href="#DictionarySpams-700"><span class="linenos">700</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span><span id="DictionarySpams-701"><a href="#DictionarySpams-701"><span class="linenos">701</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams-702"><a href="#DictionarySpams-702"><span class="linenos">702</span></a>                    <span class="s2">&quot;  Reason</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-703"><a href="#DictionarySpams-703"><span class="linenos">703</span></a>                    <span class="s2">&quot;  ------</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-704"><a href="#DictionarySpams-704"><span class="linenos">704</span></a>                    <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-705"><a href="#DictionarySpams-705"><span class="linenos">705</span></a>                    <span class="s2">&quot;  ------&quot;</span>
</span><span id="DictionarySpams-706"><a href="#DictionarySpams-706"><span class="linenos">706</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams-707"><a href="#DictionarySpams-707"><span class="linenos">707</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams-708"><a href="#DictionarySpams-708"><span class="linenos">708</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Lambda optimized: </span><span class="si">{</span><span class="n">l_opt</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-709"><a href="#DictionarySpams-709"><span class="linenos">709</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Iterations performed: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;nit&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-710"><a href="#DictionarySpams-710"><span class="linenos">710</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Final loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams-711"><a href="#DictionarySpams-711"><span class="linenos">711</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams-712"><a href="#DictionarySpams-712"><span class="linenos">712</span></a>
</span><span id="DictionarySpams-713"><a href="#DictionarySpams-713"><span class="linenos">713</span></a>        <span class="k">return</span> <span class="n">rec</span><span class="p">,</span> <span class="n">l_opt</span><span class="p">,</span> <span class="n">loss</span>
</span><span id="DictionarySpams-714"><a href="#DictionarySpams-714"><span class="linenos">714</span></a>
</span><span id="DictionarySpams-715"><a href="#DictionarySpams-715"><span class="linenos">715</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
</span><span id="DictionarySpams-716"><a href="#DictionarySpams-716"><span class="linenos">716</span></a>        <span class="n">vars_</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DictionarySpams-717"><a href="#DictionarySpams-717"><span class="linenos">717</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DictionarySpams-718"><a href="#DictionarySpams-718"><span class="linenos">718</span></a>
</span><span id="DictionarySpams-719"><a href="#DictionarySpams-719"><span class="linenos">719</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams-720"><a href="#DictionarySpams-720"><span class="linenos">720</span></a>            <span class="c1"># To avoid silent bugs in the future</span>
</span><span id="DictionarySpams-721"><a href="#DictionarySpams-721"><span class="linenos">721</span></a>            <span class="n">to_remove</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lambda1&#39;</span><span class="p">,</span> <span class="s1">&#39;n_train&#39;</span><span class="p">,</span> <span class="s1">&#39;t_train&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams-722"><a href="#DictionarySpams-722"><span class="linenos">722</span></a>
</span><span id="DictionarySpams-723"><a href="#DictionarySpams-723"><span class="linenos">723</span></a>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="DictionarySpams-724"><a href="#DictionarySpams-724"><span class="linenos">724</span></a>            <span class="n">vars_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="DictionarySpams-725"><a href="#DictionarySpams-725"><span class="linenos">725</span></a>
</span><span id="DictionarySpams-726"><a href="#DictionarySpams-726"><span class="linenos">726</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">vars_</span><span class="p">)</span>
</span><span id="DictionarySpams-727"><a href="#DictionarySpams-727"><span class="linenos">727</span></a>
</span><span id="DictionarySpams-728"><a href="#DictionarySpams-728"><span class="linenos">728</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DictionarySpams-729"><a href="#DictionarySpams-729"><span class="linenos">729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the dictionary.</span>
</span><span id="DictionarySpams-730"><a href="#DictionarySpams-730"><span class="linenos">730</span></a>
</span><span id="DictionarySpams-731"><a href="#DictionarySpams-731"><span class="linenos">731</span></a><span class="sd">        Returns a new instance of the same dictionary with the same values</span>
</span><span id="DictionarySpams-732"><a href="#DictionarySpams-732"><span class="linenos">732</span></a><span class="sd">        and state.</span>
</span><span id="DictionarySpams-733"><a href="#DictionarySpams-733"><span class="linenos">733</span></a>
</span><span id="DictionarySpams-734"><a href="#DictionarySpams-734"><span class="linenos">734</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams-735"><a href="#DictionarySpams-735"><span class="linenos">735</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams-736"><a href="#DictionarySpams-736"><span class="linenos">736</span></a><span class="sd">        dico_copy : DictionarySpams</span>
</span><span id="DictionarySpams-737"><a href="#DictionarySpams-737"><span class="linenos">737</span></a><span class="sd">            A copy of the current dictionary.</span>
</span><span id="DictionarySpams-738"><a href="#DictionarySpams-738"><span class="linenos">738</span></a><span class="sd">        </span>
</span><span id="DictionarySpams-739"><a href="#DictionarySpams-739"><span class="linenos">739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams-740"><a href="#DictionarySpams-740"><span class="linenos">740</span></a>        <span class="n">dico_copy</span> <span class="o">=</span> <span class="n">DictionarySpams</span><span class="p">(</span>
</span><span id="DictionarySpams-741"><a href="#DictionarySpams-741"><span class="linenos">741</span></a>            <span class="n">dict_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="DictionarySpams-742"><a href="#DictionarySpams-742"><span class="linenos">742</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="DictionarySpams-743"><a href="#DictionarySpams-743"><span class="linenos">743</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="DictionarySpams-744"><a href="#DictionarySpams-744"><span class="linenos">744</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DictionarySpams-745"><a href="#DictionarySpams-745"><span class="linenos">745</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="DictionarySpams-746"><a href="#DictionarySpams-746"><span class="linenos">746</span></a>            <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="DictionarySpams-747"><a href="#DictionarySpams-747"><span class="linenos">747</span></a>            <span class="n">n_train</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_train</span><span class="p">,</span>
</span><span id="DictionarySpams-748"><a href="#DictionarySpams-748"><span class="linenos">748</span></a>            <span class="n">trained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">,</span>
</span><span id="DictionarySpams-749"><a href="#DictionarySpams-749"><span class="linenos">749</span></a>            <span class="n">mode_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams-750"><a href="#DictionarySpams-750"><span class="linenos">750</span></a>            <span class="n">modeD_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams-751"><a href="#DictionarySpams-751"><span class="linenos">751</span></a>            <span class="n">mode_lasso</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span>
</span><span id="DictionarySpams-752"><a href="#DictionarySpams-752"><span class="linenos">752</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams-753"><a href="#DictionarySpams-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams-754"><a href="#DictionarySpams-754"><span class="linenos">754</span></a>            <span class="c1"># Retain the initial components of the dictionary.</span>
</span><span id="DictionarySpams-755"><a href="#DictionarySpams-755"><span class="linenos">755</span></a>            <span class="n">dico_copy</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="DictionarySpams-756"><a href="#DictionarySpams-756"><span class="linenos">756</span></a>
</span><span id="DictionarySpams-757"><a href="#DictionarySpams-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="n">dico_copy</span>
</span><span id="DictionarySpams-758"><a href="#DictionarySpams-758"><span class="linenos">758</span></a>    
</span><span id="DictionarySpams-759"><a href="#DictionarySpams-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DictionarySpams-760"><a href="#DictionarySpams-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the dictionary to its initial (untrained) state.&quot;&quot;&quot;</span>
</span><span id="DictionarySpams-761"><a href="#DictionarySpams-761"><span class="linenos">761</span></a>
</span><span id="DictionarySpams-762"><a href="#DictionarySpams-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="DictionarySpams-763"><a href="#DictionarySpams-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DictionarySpams-764"><a href="#DictionarySpams-764"><span class="linenos">764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams-765"><a href="#DictionarySpams-765"><span class="linenos">765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams-766"><a href="#DictionarySpams-766"><span class="linenos">766</span></a>
</span><span id="DictionarySpams-767"><a href="#DictionarySpams-767"><span class="linenos">767</span></a>    <span class="k">def</span> <span class="nf">_check_initial_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_pool</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="p">):</span>
</span><span id="DictionarySpams-768"><a href="#DictionarySpams-768"><span class="linenos">768</span></a>        <span class="c1"># Explicit initial dictionary.</span>
</span><span id="DictionarySpams-769"><a href="#DictionarySpams-769"><span class="linenos">769</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-770"><a href="#DictionarySpams-770"><span class="linenos">770</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="DictionarySpams-771"><a href="#DictionarySpams-771"><span class="linenos">771</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="DictionarySpams-772"><a href="#DictionarySpams-772"><span class="linenos">772</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not a valid &#39;dict_init&#39;&quot;</span>
</span><span id="DictionarySpams-773"><a href="#DictionarySpams-773"><span class="linenos">773</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams-774"><a href="#DictionarySpams-774"><span class="linenos">774</span></a>            
</span><span id="DictionarySpams-775"><a href="#DictionarySpams-775"><span class="linenos">775</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">:</span>
</span><span id="DictionarySpams-776"><a href="#DictionarySpams-776"><span class="linenos">776</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dict_init&#39; must be a C-contiguous array&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-777"><a href="#DictionarySpams-777"><span class="linenos">777</span></a>            
</span><span id="DictionarySpams-778"><a href="#DictionarySpams-778"><span class="linenos">778</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams-779"><a href="#DictionarySpams-779"><span class="linenos">779</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_completeness</span><span class="p">):</span>
</span><span id="DictionarySpams-780"><a href="#DictionarySpams-780"><span class="linenos">780</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary must be overcomplete (d_size &gt; a_length)&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-781"><a href="#DictionarySpams-781"><span class="linenos">781</span></a>        
</span><span id="DictionarySpams-782"><a href="#DictionarySpams-782"><span class="linenos">782</span></a>        <span class="c1"># Signal pool from where to extract the initial dictionary.</span>
</span><span id="DictionarySpams-783"><a href="#DictionarySpams-783"><span class="linenos">783</span></a>        <span class="k">elif</span> <span class="n">signal_pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams-784"><a href="#DictionarySpams-784"><span class="linenos">784</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="DictionarySpams-785"><a href="#DictionarySpams-785"><span class="linenos">785</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="DictionarySpams-786"><a href="#DictionarySpams-786"><span class="linenos">786</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; is not a valid &#39;signal_pool&#39;&quot;</span>
</span><span id="DictionarySpams-787"><a href="#DictionarySpams-787"><span class="linenos">787</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams-788"><a href="#DictionarySpams-788"><span class="linenos">788</span></a>            
</span><span id="DictionarySpams-789"><a href="#DictionarySpams-789"><span class="linenos">789</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">signal_pool</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">:</span>
</span><span id="DictionarySpams-790"><a href="#DictionarySpams-790"><span class="linenos">790</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;signal_pool&#39; must be a C-contiguous array&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-791"><a href="#DictionarySpams-791"><span class="linenos">791</span></a>            
</span><span id="DictionarySpams-792"><a href="#DictionarySpams-792"><span class="linenos">792</span></a>            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">):</span>
</span><span id="DictionarySpams-793"><a href="#DictionarySpams-793"><span class="linenos">793</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="DictionarySpams-794"><a href="#DictionarySpams-794"><span class="linenos">794</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;a_length&#39; and &#39;d_size&#39; must be explicitly provided along &#39;signal_pool&#39;&quot;</span>
</span><span id="DictionarySpams-795"><a href="#DictionarySpams-795"><span class="linenos">795</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams-796"><a href="#DictionarySpams-796"><span class="linenos">796</span></a>            
</span><span id="DictionarySpams-797"><a href="#DictionarySpams-797"><span class="linenos">797</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_completeness</span><span class="p">:</span>
</span><span id="DictionarySpams-798"><a href="#DictionarySpams-798"><span class="linenos">798</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary must be overcomplete (d_size &gt; a_length)&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams-799"><a href="#DictionarySpams-799"><span class="linenos">799</span></a>        
</span><span id="DictionarySpams-800"><a href="#DictionarySpams-800"><span class="linenos">800</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams-801"><a href="#DictionarySpams-801"><span class="linenos">801</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;either &#39;dict_init&#39; or &#39;signal_pool&#39; must be provided&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sparse Dictionary Learning (SDL) model for waveform denoising via SPAMS.</p>

<p>This class provides an object-oriented implementation of a Sparse
Dictionary Learning model, designed for the denoising and reconstruction
of waveforms. At its core, it utilizes the <code>trainDL</code> function for
dictionary learning and the <code>lasso</code> function for sparse coding from the
SPAMS-python library [1].</p>

<p>It extends these core functionalities to arbitrarily long signals and
minibatch processing for large datasets. Additionally, the class includes
various utilities for signal preprocessing, composite models of denoising
(such as iterative reconstruction), and the ability to easily save and
load the dictionary's state.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>dict_init</strong> (ndarray):
Atoms of the initial dictionary. Remains unaltered after training.</li>
<li><strong>components</strong> (ndarray):
Atoms of the current (trained) dictionary.</li>
<li><strong>model</strong> (tuple):
SPAMS' trainDL model components in the form (A, B, iter).</li>
<li><strong>d_size</strong> (int):
Number of atoms in the dictionary (dictionary size).</li>
<li><strong>a_length</strong> (int):
Length of each atom in the dictionary (patch size).</li>
<li><strong>lambda1</strong> (float):
Regularization parameter for training the dictionary.</li>
<li><strong>batch_size</strong> (int):
Batch size used in mini-batch training.</li>
<li><strong>n_iter</strong> (int):
Number of iterations performed during training.</li>
<li><strong>t_train</strong> (float):
Total training time in seconds.</li>
<li><strong>trained</strong> (bool):
Indicates whether the dictionary has been trained.</li>
<li><strong>n_train</strong> (int):
Number of patches used during training.</li>
<li><strong>mode_traindl</strong> (int):
Training mode for SPAMS' <code>trainDL</code> function.</li>
<li><strong>modeD_traindl</strong> (int):
Dictionary mode for SPAMS' <code>trainDL</code> function.</li>
<li><strong>mode_lasso</strong> (int):
Mode for SPAMS' <code>lasso</code> function.</li>
<li><strong>identifier</strong> (str):
Optional identifier or note for distinguishing the dictionary.</li>
</ul>

<h6 id="references">References</h6>

<p>[1] SPAMS (for python),
    (http://spams-devel.gforge.inria.fr/).
    Last accessed in October 2018.</p>
</div>


                            <div id="DictionarySpams.__init__" class="classattr">
                                        <input id="DictionarySpams.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DictionarySpams</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dict_init</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">signal_pool</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">a_length</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">d_size</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">wave_pos</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">patch_min</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">allow_allzeros</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">random_state</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ignore_completeness</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span>,</span><span class="param">	<span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">n_train</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">trained</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">mode_traindl</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">modeD_traindl</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">mode_lasso</span><span class="o">=</span><span class="mi">2</span>,</span><span class="param">	<span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="DictionarySpams.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.__init__-75"><a href="#DictionarySpams.__init__-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-76"><a href="#DictionarySpams.__init__-76"><span class="linenos"> 76</span></a>             <span class="n">dict_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-77"><a href="#DictionarySpams.__init__-77"><span class="linenos"> 77</span></a>             <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-78"><a href="#DictionarySpams.__init__-78"><span class="linenos"> 78</span></a>             <span class="n">signal_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-79"><a href="#DictionarySpams.__init__-79"><span class="linenos"> 79</span></a>             <span class="n">patch_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l2_normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_allzeros</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-80"><a href="#DictionarySpams.__init__-80"><span class="linenos"> 80</span></a>             <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-81"><a href="#DictionarySpams.__init__-81"><span class="linenos"> 81</span></a>             <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-82"><a href="#DictionarySpams.__init__-82"><span class="linenos"> 82</span></a>             <span class="n">trained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeD_traindl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode_lasso</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-83"><a href="#DictionarySpams.__init__-83"><span class="linenos"> 83</span></a>             <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams.__init__-84"><a href="#DictionarySpams.__init__-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the dictionary.</span>
</span><span id="DictionarySpams.__init__-85"><a href="#DictionarySpams.__init__-85"><span class="linenos"> 85</span></a>
</span><span id="DictionarySpams.__init__-86"><a href="#DictionarySpams.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        There are two ways to initialize the dictionary:</span>
</span><span id="DictionarySpams.__init__-87"><a href="#DictionarySpams.__init__-87"><span class="linenos"> 87</span></a><span class="sd">        </span>
</span><span id="DictionarySpams.__init__-88"><a href="#DictionarySpams.__init__-88"><span class="linenos"> 88</span></a><span class="sd">        1. By directly providing the initial dictionary with `dict_init`.</span>
</span><span id="DictionarySpams.__init__-89"><a href="#DictionarySpams.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        2. By providing a collection of signals (`signal_pool`) from which atoms</span>
</span><span id="DictionarySpams.__init__-90"><a href="#DictionarySpams.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        are randomly extracted to form the initial dictionary.</span>
</span><span id="DictionarySpams.__init__-91"><a href="#DictionarySpams.__init__-91"><span class="linenos"> 91</span></a>
</span><span id="DictionarySpams.__init__-92"><a href="#DictionarySpams.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        If the second option is used, `a_length` and `d_size` must be explicitly</span>
</span><span id="DictionarySpams.__init__-93"><a href="#DictionarySpams.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        specified to define the size of the dictionary. Additional optional</span>
</span><span id="DictionarySpams.__init__-94"><a href="#DictionarySpams.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        parameters provide more control over this process.</span>
</span><span id="DictionarySpams.__init__-95"><a href="#DictionarySpams.__init__-95"><span class="linenos"> 95</span></a>
</span><span id="DictionarySpams.__init__-96"><a href="#DictionarySpams.__init__-96"><span class="linenos"> 96</span></a><span class="sd">        Note</span>
</span><span id="DictionarySpams.__init__-97"><a href="#DictionarySpams.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        ----</span>
</span><span id="DictionarySpams.__init__-98"><a href="#DictionarySpams.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        This method initializes the dictionary but does not train it. Use the</span>
</span><span id="DictionarySpams.__init__-99"><a href="#DictionarySpams.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        `train` method for training.</span>
</span><span id="DictionarySpams.__init__-100"><a href="#DictionarySpams.__init__-100"><span class="linenos">100</span></a>
</span><span id="DictionarySpams.__init__-101"><a href="#DictionarySpams.__init__-101"><span class="linenos">101</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams.__init__-102"><a href="#DictionarySpams.__init__-102"><span class="linenos">102</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.__init__-103"><a href="#DictionarySpams.__init__-103"><span class="linenos">103</span></a><span class="sd">        dict_init : ndarray of shape (d_size, a_length), optional</span>
</span><span id="DictionarySpams.__init__-104"><a href="#DictionarySpams.__init__-104"><span class="linenos">104</span></a><span class="sd">            Atoms of the initial dictionary. If None, `signal_pool` must be provided.</span>
</span><span id="DictionarySpams.__init__-105"><a href="#DictionarySpams.__init__-105"><span class="linenos">105</span></a><span class="sd">        model : dict, optional</span>
</span><span id="DictionarySpams.__init__-106"><a href="#DictionarySpams.__init__-106"><span class="linenos">106</span></a><span class="sd">            SPAMS&#39; `trainDL` model components as a dictionary with elements</span>
</span><span id="DictionarySpams.__init__-107"><a href="#DictionarySpams.__init__-107"><span class="linenos">107</span></a><span class="sd">            {A, B, iter}. Must be provided if continuing training from a previous state.</span>
</span><span id="DictionarySpams.__init__-108"><a href="#DictionarySpams.__init__-108"><span class="linenos">108</span></a><span class="sd">        signal_pool : ndarray of shape (n_signals, n_samples), optional</span>
</span><span id="DictionarySpams.__init__-109"><a href="#DictionarySpams.__init__-109"><span class="linenos">109</span></a><span class="sd">            A collection of signals from which atoms are extracted to form the</span>
</span><span id="DictionarySpams.__init__-110"><a href="#DictionarySpams.__init__-110"><span class="linenos">110</span></a><span class="sd">            initial dictionary. Ignored if `dict_init` is provided.</span>
</span><span id="DictionarySpams.__init__-111"><a href="#DictionarySpams.__init__-111"><span class="linenos">111</span></a><span class="sd">        a_length : int, optional</span>
</span><span id="DictionarySpams.__init__-112"><a href="#DictionarySpams.__init__-112"><span class="linenos">112</span></a><span class="sd">            Length of each atom in the dictionary (patch size). Required if</span>
</span><span id="DictionarySpams.__init__-113"><a href="#DictionarySpams.__init__-113"><span class="linenos">113</span></a><span class="sd">            `signal_pool` is provided.</span>
</span><span id="DictionarySpams.__init__-114"><a href="#DictionarySpams.__init__-114"><span class="linenos">114</span></a><span class="sd">        d_size : int, optional</span>
</span><span id="DictionarySpams.__init__-115"><a href="#DictionarySpams.__init__-115"><span class="linenos">115</span></a><span class="sd">            Number of atoms in the dictionary. Required if `signal_pool` is provided.</span>
</span><span id="DictionarySpams.__init__-116"><a href="#DictionarySpams.__init__-116"><span class="linenos">116</span></a><span class="sd">        wave_pos : array-like of shape (n_signals, 2), optional</span>
</span><span id="DictionarySpams.__init__-117"><a href="#DictionarySpams.__init__-117"><span class="linenos">117</span></a><span class="sd">            Positions of waveforms within `signal_pool` to extract atoms from. If</span>
</span><span id="DictionarySpams.__init__-118"><a href="#DictionarySpams.__init__-118"><span class="linenos">118</span></a><span class="sd">            None, the entire array is used.</span>
</span><span id="DictionarySpams.__init__-119"><a href="#DictionarySpams.__init__-119"><span class="linenos">119</span></a><span class="sd">        patch_min : int, default=1</span>
</span><span id="DictionarySpams.__init__-120"><a href="#DictionarySpams.__init__-120"><span class="linenos">120</span></a><span class="sd">            Minimum number of samples for each extracted patch. Ignored if</span>
</span><span id="DictionarySpams.__init__-121"><a href="#DictionarySpams.__init__-121"><span class="linenos">121</span></a><span class="sd">            `wave_pos` is None.</span>
</span><span id="DictionarySpams.__init__-122"><a href="#DictionarySpams.__init__-122"><span class="linenos">122</span></a><span class="sd">        l2_normed : bool, default=True</span>
</span><span id="DictionarySpams.__init__-123"><a href="#DictionarySpams.__init__-123"><span class="linenos">123</span></a><span class="sd">            If True, normalize extracted atoms to their L2 norm.</span>
</span><span id="DictionarySpams.__init__-124"><a href="#DictionarySpams.__init__-124"><span class="linenos">124</span></a><span class="sd">        allow_allzeros : bool, default=True</span>
</span><span id="DictionarySpams.__init__-125"><a href="#DictionarySpams.__init__-125"><span class="linenos">125</span></a><span class="sd">            If False, random atoms with all zeros are not included in the initial</span>
</span><span id="DictionarySpams.__init__-126"><a href="#DictionarySpams.__init__-126"><span class="linenos">126</span></a><span class="sd">            dictionary.</span>
</span><span id="DictionarySpams.__init__-127"><a href="#DictionarySpams.__init__-127"><span class="linenos">127</span></a><span class="sd">        random_state : int, optional</span>
</span><span id="DictionarySpams.__init__-128"><a href="#DictionarySpams.__init__-128"><span class="linenos">128</span></a><span class="sd">            Seed for random sampling from `signal_pool`.</span>
</span><span id="DictionarySpams.__init__-129"><a href="#DictionarySpams.__init__-129"><span class="linenos">129</span></a><span class="sd">        ignore_completeness : bool, optional</span>
</span><span id="DictionarySpams.__init__-130"><a href="#DictionarySpams.__init__-130"><span class="linenos">130</span></a><span class="sd">            If False, the dictionary must be overcomplete (`d_size &gt; a_length`).</span>
</span><span id="DictionarySpams.__init__-131"><a href="#DictionarySpams.__init__-131"><span class="linenos">131</span></a><span class="sd">            Defaults to False.</span>
</span><span id="DictionarySpams.__init__-132"><a href="#DictionarySpams.__init__-132"><span class="linenos">132</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="DictionarySpams.__init__-133"><a href="#DictionarySpams.__init__-133"><span class="linenos">133</span></a><span class="sd">            Regularization parameter for training.</span>
</span><span id="DictionarySpams.__init__-134"><a href="#DictionarySpams.__init__-134"><span class="linenos">134</span></a><span class="sd">        batch_size : int, default=64</span>
</span><span id="DictionarySpams.__init__-135"><a href="#DictionarySpams.__init__-135"><span class="linenos">135</span></a><span class="sd">            Batch size used during training.</span>
</span><span id="DictionarySpams.__init__-136"><a href="#DictionarySpams.__init__-136"><span class="linenos">136</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="DictionarySpams.__init__-137"><a href="#DictionarySpams.__init__-137"><span class="linenos">137</span></a><span class="sd">            Total number of iterations for training. If None, this must be set when</span>
</span><span id="DictionarySpams.__init__-138"><a href="#DictionarySpams.__init__-138"><span class="linenos">138</span></a><span class="sd">            calling the `train` method.</span>
</span><span id="DictionarySpams.__init__-139"><a href="#DictionarySpams.__init__-139"><span class="linenos">139</span></a><span class="sd">        n_train : int, optional</span>
</span><span id="DictionarySpams.__init__-140"><a href="#DictionarySpams.__init__-140"><span class="linenos">140</span></a><span class="sd">            Number of patches used for training. Informational only.</span>
</span><span id="DictionarySpams.__init__-141"><a href="#DictionarySpams.__init__-141"><span class="linenos">141</span></a><span class="sd">        trained : bool, default=False</span>
</span><span id="DictionarySpams.__init__-142"><a href="#DictionarySpams.__init__-142"><span class="linenos">142</span></a><span class="sd">            Indicates whether the dictionary is already trained.</span>
</span><span id="DictionarySpams.__init__-143"><a href="#DictionarySpams.__init__-143"><span class="linenos">143</span></a><span class="sd">        mode_traindl : int, default=0</span>
</span><span id="DictionarySpams.__init__-144"><a href="#DictionarySpams.__init__-144"><span class="linenos">144</span></a><span class="sd">            Training mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams.__init__-145"><a href="#DictionarySpams.__init__-145"><span class="linenos">145</span></a><span class="sd">        modeD_traindl : int, default=0</span>
</span><span id="DictionarySpams.__init__-146"><a href="#DictionarySpams.__init__-146"><span class="linenos">146</span></a><span class="sd">            Dictionary mode for SPAMS&#39; `trainDL` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams.__init__-147"><a href="#DictionarySpams.__init__-147"><span class="linenos">147</span></a><span class="sd">        mode_lasso : int, default=2</span>
</span><span id="DictionarySpams.__init__-148"><a href="#DictionarySpams.__init__-148"><span class="linenos">148</span></a><span class="sd">            Mode for SPAMS&#39; `lasso` function. See SPAMS documentation.</span>
</span><span id="DictionarySpams.__init__-149"><a href="#DictionarySpams.__init__-149"><span class="linenos">149</span></a><span class="sd">        identifier : str, optional</span>
</span><span id="DictionarySpams.__init__-150"><a href="#DictionarySpams.__init__-150"><span class="linenos">150</span></a><span class="sd">            A note or label for identifying the dictionary.</span>
</span><span id="DictionarySpams.__init__-151"><a href="#DictionarySpams.__init__-151"><span class="linenos">151</span></a>
</span><span id="DictionarySpams.__init__-152"><a href="#DictionarySpams.__init__-152"><span class="linenos">152</span></a><span class="sd">        See Also</span>
</span><span id="DictionarySpams.__init__-153"><a href="#DictionarySpams.__init__-153"><span class="linenos">153</span></a><span class="sd">        --------</span>
</span><span id="DictionarySpams.__init__-154"><a href="#DictionarySpams.__init__-154"><span class="linenos">154</span></a><span class="sd">        train : Method to train the dictionary.</span>
</span><span id="DictionarySpams.__init__-155"><a href="#DictionarySpams.__init__-155"><span class="linenos">155</span></a><span class="sd">        reconstruct : Method to reconstruct signals using the dictionary.</span>
</span><span id="DictionarySpams.__init__-156"><a href="#DictionarySpams.__init__-156"><span class="linenos">156</span></a>
</span><span id="DictionarySpams.__init__-157"><a href="#DictionarySpams.__init__-157"><span class="linenos">157</span></a><span class="sd">        References</span>
</span><span id="DictionarySpams.__init__-158"><a href="#DictionarySpams.__init__-158"><span class="linenos">158</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.__init__-159"><a href="#DictionarySpams.__init__-159"><span class="linenos">159</span></a><span class="sd">        [1] SPAMS (for python), (http://spams-devel.gforge.inria.fr/).</span>
</span><span id="DictionarySpams.__init__-160"><a href="#DictionarySpams.__init__-160"><span class="linenos">160</span></a><span class="sd">            Last accessed in October 2018.</span>
</span><span id="DictionarySpams.__init__-161"><a href="#DictionarySpams.__init__-161"><span class="linenos">161</span></a>
</span><span id="DictionarySpams.__init__-162"><a href="#DictionarySpams.__init__-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.__init__-163"><a href="#DictionarySpams.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="DictionarySpams.__init__-164"><a href="#DictionarySpams.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="DictionarySpams.__init__-165"><a href="#DictionarySpams.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">dict_init</span>
</span><span id="DictionarySpams.__init__-166"><a href="#DictionarySpams.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="n">a_length</span>
</span><span id="DictionarySpams.__init__-167"><a href="#DictionarySpams.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span> <span class="o">=</span> <span class="n">d_size</span>
</span><span id="DictionarySpams.__init__-168"><a href="#DictionarySpams.__init__-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="DictionarySpams.__init__-169"><a href="#DictionarySpams.__init__-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="DictionarySpams.__init__-170"><a href="#DictionarySpams.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams.__init__-171"><a href="#DictionarySpams.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span> <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DictionarySpams.__init__-172"><a href="#DictionarySpams.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="n">trained</span>
</span><span id="DictionarySpams.__init__-173"><a href="#DictionarySpams.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">n_train</span>
</span><span id="DictionarySpams.__init__-174"><a href="#DictionarySpams.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span> <span class="o">=</span> <span class="n">mode_traindl</span>
</span><span id="DictionarySpams.__init__-175"><a href="#DictionarySpams.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span> <span class="o">=</span> <span class="n">modeD_traindl</span>
</span><span id="DictionarySpams.__init__-176"><a href="#DictionarySpams.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span> <span class="o">=</span> <span class="n">mode_lasso</span>
</span><span id="DictionarySpams.__init__-177"><a href="#DictionarySpams.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
</span><span id="DictionarySpams.__init__-178"><a href="#DictionarySpams.__init__-178"><span class="linenos">178</span></a>
</span><span id="DictionarySpams.__init__-179"><a href="#DictionarySpams.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_initial_parameters</span><span class="p">(</span><span class="n">signal_pool</span><span class="p">,</span> <span class="n">ignore_completeness</span><span class="p">)</span>
</span><span id="DictionarySpams.__init__-180"><a href="#DictionarySpams.__init__-180"><span class="linenos">180</span></a>
</span><span id="DictionarySpams.__init__-181"><a href="#DictionarySpams.__init__-181"><span class="linenos">181</span></a>        <span class="c1"># Explicit initial dictionary (trained or not).</span>
</span><span id="DictionarySpams.__init__-182"><a href="#DictionarySpams.__init__-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.__init__-183"><a href="#DictionarySpams.__init__-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span><span class="o">.</span><span class="n">shape</span>
</span><span id="DictionarySpams.__init__-184"><a href="#DictionarySpams.__init__-184"><span class="linenos">184</span></a>
</span><span id="DictionarySpams.__init__-185"><a href="#DictionarySpams.__init__-185"><span class="linenos">185</span></a>        <span class="c1"># Get the initial atoms from a set of signals.</span>
</span><span id="DictionarySpams.__init__-186"><a href="#DictionarySpams.__init__-186"><span class="linenos">186</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.__init__-187"><a href="#DictionarySpams.__init__-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">extract_patches</span><span class="p">(</span>
</span><span id="DictionarySpams.__init__-188"><a href="#DictionarySpams.__init__-188"><span class="linenos">188</span></a>                <span class="n">signal_pool</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-189"><a href="#DictionarySpams.__init__-189"><span class="linenos">189</span></a>                <span class="n">patch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-190"><a href="#DictionarySpams.__init__-190"><span class="linenos">190</span></a>                <span class="n">limits</span><span class="o">=</span><span class="n">wave_pos</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-191"><a href="#DictionarySpams.__init__-191"><span class="linenos">191</span></a>                <span class="n">n_patches</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-192"><a href="#DictionarySpams.__init__-192"><span class="linenos">192</span></a>                <span class="n">l2_normed</span><span class="o">=</span><span class="n">l2_normed</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-193"><a href="#DictionarySpams.__init__-193"><span class="linenos">193</span></a>                <span class="n">allow_allzeros</span><span class="o">=</span><span class="n">allow_allzeros</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-194"><a href="#DictionarySpams.__init__-194"><span class="linenos">194</span></a>                <span class="n">patch_min</span><span class="o">=</span><span class="n">patch_min</span><span class="p">,</span>
</span><span id="DictionarySpams.__init__-195"><a href="#DictionarySpams.__init__-195"><span class="linenos">195</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
</span><span id="DictionarySpams.__init__-196"><a href="#DictionarySpams.__init__-196"><span class="linenos">196</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.__init__-197"><a href="#DictionarySpams.__init__-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the dictionary.</p>

<p>There are two ways to initialize the dictionary:</p>

<ol>
<li>By directly providing the initial dictionary with <code><a href="#DictionarySpams.dict_init">dict_init</a></code>.</li>
<li>By providing a collection of signals (<code>signal_pool</code>) from which atoms
are randomly extracted to form the initial dictionary.</li>
</ol>

<p>If the second option is used, <code><a href="#DictionarySpams.a_length">a_length</a></code> and <code><a href="#DictionarySpams.d_size">d_size</a></code> must be explicitly
specified to define the size of the dictionary. Additional optional
parameters provide more control over this process.</p>

<h6 id="note">Note</h6>

<p>This method initializes the dictionary but does not train it. Use the
<code><a href="#DictionarySpams.train">train</a></code> method for training.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dict_init</strong> (ndarray of shape (d_size, a_length), optional):
Atoms of the initial dictionary. If None, <code>signal_pool</code> must be provided.</li>
<li><strong>model</strong> (dict, optional):
SPAMS' <code>trainDL</code> model components as a dictionary with elements
{A, B, iter}. Must be provided if continuing training from a previous state.</li>
<li><strong>signal_pool</strong> (ndarray of shape (n_signals, n_samples), optional):
A collection of signals from which atoms are extracted to form the
initial dictionary. Ignored if <code><a href="#DictionarySpams.dict_init">dict_init</a></code> is provided.</li>
<li><strong>a_length</strong> (int, optional):
Length of each atom in the dictionary (patch size). Required if
<code>signal_pool</code> is provided.</li>
<li><strong>d_size</strong> (int, optional):
Number of atoms in the dictionary. Required if <code>signal_pool</code> is provided.</li>
<li><strong>wave_pos</strong> (array-like of shape (n_signals, 2), optional):
Positions of waveforms within <code>signal_pool</code> to extract atoms from. If
None, the entire array is used.</li>
<li><strong>patch_min</strong> (int, default=1):
Minimum number of samples for each extracted patch. Ignored if
<code>wave_pos</code> is None.</li>
<li><strong>l2_normed</strong> (bool, default=True):
If True, normalize extracted atoms to their L2 norm.</li>
<li><strong>allow_allzeros</strong> (bool, default=True):
If False, random atoms with all zeros are not included in the initial
dictionary.</li>
<li><strong>random_state</strong> (int, optional):
Seed for random sampling from <code>signal_pool</code>.</li>
<li><strong>ignore_completeness</strong> (bool, optional):
If False, the dictionary must be overcomplete (<code>d_size &gt; a_length</code>).
Defaults to False.</li>
<li><strong>lambda1</strong> (float, optional):
Regularization parameter for training.</li>
<li><strong>batch_size</strong> (int, default=64):
Batch size used during training.</li>
<li><strong>n_iter</strong> (int, optional):
Total number of iterations for training. If None, this must be set when
calling the <code><a href="#DictionarySpams.train">train</a></code> method.</li>
<li><strong>n_train</strong> (int, optional):
Number of patches used for training. Informational only.</li>
<li><strong>trained</strong> (bool, default=False):
Indicates whether the dictionary is already trained.</li>
<li><strong>mode_traindl</strong> (int, default=0):
Training mode for SPAMS' <code>trainDL</code> function. See SPAMS documentation.</li>
<li><strong>modeD_traindl</strong> (int, default=0):
Dictionary mode for SPAMS' <code>trainDL</code> function. See SPAMS documentation.</li>
<li><strong>mode_lasso</strong> (int, default=2):
Mode for SPAMS' <code>lasso</code> function. See SPAMS documentation.</li>
<li><strong>identifier</strong> (str, optional):
A note or label for identifying the dictionary.</li>
</ul>

<h6 id="see-also">See Also</h6>

<p><code><a href="#DictionarySpams.train">train</a></code>:  Method to train the dictionary. <br />
<code><a href="#DictionarySpams.reconstruct">reconstruct</a></code>:  Method to reconstruct signals using the dictionary.  </p>

<h6 id="references">References</h6>

<p>[1] SPAMS (for python), (http://spams-devel.gforge.inria.fr/).
    Last accessed in October 2018.</p>
</div>


                            </div>
                            <div id="DictionarySpams.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.model"></a>
    
    

                            </div>
                            <div id="DictionarySpams.dict_init" class="classattr">
                                <div class="attr variable">
            <span class="name">dict_init</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.dict_init"></a>
    
    

                            </div>
                            <div id="DictionarySpams.components" class="classattr">
                                <div class="attr variable">
            <span class="name">components</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.components"></a>
    
    

                            </div>
                            <div id="DictionarySpams.a_length" class="classattr">
                                <div class="attr variable">
            <span class="name">a_length</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.a_length"></a>
    
    

                            </div>
                            <div id="DictionarySpams.d_size" class="classattr">
                                <div class="attr variable">
            <span class="name">d_size</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.d_size"></a>
    
    

                            </div>
                            <div id="DictionarySpams.lambda1" class="classattr">
                                <div class="attr variable">
            <span class="name">lambda1</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.lambda1"></a>
    
    

                            </div>
                            <div id="DictionarySpams.batch_size" class="classattr">
                                <div class="attr variable">
            <span class="name">batch_size</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.batch_size"></a>
    
    

                            </div>
                            <div id="DictionarySpams.n_iter" class="classattr">
                                <div class="attr variable">
            <span class="name">n_iter</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.n_iter"></a>
    
    

                            </div>
                            <div id="DictionarySpams.t_train" class="classattr">
                                <div class="attr variable">
            <span class="name">t_train</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.t_train"></a>
    
    

                            </div>
                            <div id="DictionarySpams.trained" class="classattr">
                                <div class="attr variable">
            <span class="name">trained</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.trained"></a>
    
    

                            </div>
                            <div id="DictionarySpams.n_train" class="classattr">
                                <div class="attr variable">
            <span class="name">n_train</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.n_train"></a>
    
    

                            </div>
                            <div id="DictionarySpams.mode_traindl" class="classattr">
                                <div class="attr variable">
            <span class="name">mode_traindl</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.mode_traindl"></a>
    
    

                            </div>
                            <div id="DictionarySpams.modeD_traindl" class="classattr">
                                <div class="attr variable">
            <span class="name">modeD_traindl</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.modeD_traindl"></a>
    
    

                            </div>
                            <div id="DictionarySpams.mode_lasso" class="classattr">
                                <div class="attr variable">
            <span class="name">mode_lasso</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.mode_lasso"></a>
    
    

                            </div>
                            <div id="DictionarySpams.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span>

        
    </div>
    <a class="headerlink" href="#DictionarySpams.identifier"></a>
    
    

                            </div>
                            <div id="DictionarySpams.train" class="classattr">
                                        <input id="DictionarySpams.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">patches</span>,</span><span class="param">	<span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">threads</span><span class="o">=-</span><span class="mi">1</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.train-199"><a href="#DictionarySpams.train-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">lambda1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="DictionarySpams.train-200"><a href="#DictionarySpams.train-200"><span class="linenos">200</span></a>              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams.train-201"><a href="#DictionarySpams.train-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Train the dictionary.</span>
</span><span id="DictionarySpams.train-202"><a href="#DictionarySpams.train-202"><span class="linenos">202</span></a>
</span><span id="DictionarySpams.train-203"><a href="#DictionarySpams.train-203"><span class="linenos">203</span></a><span class="sd">        Train the dictionary with the given patches.</span>
</span><span id="DictionarySpams.train-204"><a href="#DictionarySpams.train-204"><span class="linenos">204</span></a>
</span><span id="DictionarySpams.train-205"><a href="#DictionarySpams.train-205"><span class="linenos">205</span></a><span class="sd">        This also allows a warm start using the previous components as initial</span>
</span><span id="DictionarySpams.train-206"><a href="#DictionarySpams.train-206"><span class="linenos">206</span></a><span class="sd">        dictionary, but only if the lambda1 parameter is the same. It can be</span>
</span><span id="DictionarySpams.train-207"><a href="#DictionarySpams.train-207"><span class="linenos">207</span></a><span class="sd">        thought of as adding more iterations to the training. Hence, providing</span>
</span><span id="DictionarySpams.train-208"><a href="#DictionarySpams.train-208"><span class="linenos">208</span></a><span class="sd">        different patches is discouraged and untested.</span>
</span><span id="DictionarySpams.train-209"><a href="#DictionarySpams.train-209"><span class="linenos">209</span></a>
</span><span id="DictionarySpams.train-210"><a href="#DictionarySpams.train-210"><span class="linenos">210</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams.train-211"><a href="#DictionarySpams.train-211"><span class="linenos">211</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.train-212"><a href="#DictionarySpams.train-212"><span class="linenos">212</span></a><span class="sd">        patches : 2d-array(signals, samples)</span>
</span><span id="DictionarySpams.train-213"><a href="#DictionarySpams.train-213"><span class="linenos">213</span></a><span class="sd">            Training patches.</span>
</span><span id="DictionarySpams.train-214"><a href="#DictionarySpams.train-214"><span class="linenos">214</span></a>
</span><span id="DictionarySpams.train-215"><a href="#DictionarySpams.train-215"><span class="linenos">215</span></a><span class="sd">        lambda1 : float, optional</span>
</span><span id="DictionarySpams.train-216"><a href="#DictionarySpams.train-216"><span class="linenos">216</span></a><span class="sd">            Regularization parameter of the learning algorithm.</span>
</span><span id="DictionarySpams.train-217"><a href="#DictionarySpams.train-217"><span class="linenos">217</span></a><span class="sd">            It is not needed if already specified at initialization.</span>
</span><span id="DictionarySpams.train-218"><a href="#DictionarySpams.train-218"><span class="linenos">218</span></a>
</span><span id="DictionarySpams.train-219"><a href="#DictionarySpams.train-219"><span class="linenos">219</span></a><span class="sd">        n_iter : int, optional</span>
</span><span id="DictionarySpams.train-220"><a href="#DictionarySpams.train-220"><span class="linenos">220</span></a><span class="sd">            Total number of iterations to perform.</span>
</span><span id="DictionarySpams.train-221"><a href="#DictionarySpams.train-221"><span class="linenos">221</span></a><span class="sd">            If a negative number is provided it will perform the computation</span>
</span><span id="DictionarySpams.train-222"><a href="#DictionarySpams.train-222"><span class="linenos">222</span></a><span class="sd">            during the corresponding number of seconds.</span>
</span><span id="DictionarySpams.train-223"><a href="#DictionarySpams.train-223"><span class="linenos">223</span></a><span class="sd">            For instance `n_iter = -5` trains the dictionary during 5 seconds.</span>
</span><span id="DictionarySpams.train-224"><a href="#DictionarySpams.train-224"><span class="linenos">224</span></a>
</span><span id="DictionarySpams.train-225"><a href="#DictionarySpams.train-225"><span class="linenos">225</span></a><span class="sd">        warm_start : bool</span>
</span><span id="DictionarySpams.train-226"><a href="#DictionarySpams.train-226"><span class="linenos">226</span></a><span class="sd">            If True, use the previous components as initial dictionary.</span>
</span><span id="DictionarySpams.train-227"><a href="#DictionarySpams.train-227"><span class="linenos">227</span></a><span class="sd">            It can be thought of as adding more iterations to the training.</span>
</span><span id="DictionarySpams.train-228"><a href="#DictionarySpams.train-228"><span class="linenos">228</span></a><span class="sd">            Providing different patches is discouraged and untested.</span>
</span><span id="DictionarySpams.train-229"><a href="#DictionarySpams.train-229"><span class="linenos">229</span></a>
</span><span id="DictionarySpams.train-230"><a href="#DictionarySpams.train-230"><span class="linenos">230</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="DictionarySpams.train-231"><a href="#DictionarySpams.train-231"><span class="linenos">231</span></a><span class="sd">            If True print the iterations (might not be shown in real time).</span>
</span><span id="DictionarySpams.train-232"><a href="#DictionarySpams.train-232"><span class="linenos">232</span></a>
</span><span id="DictionarySpams.train-233"><a href="#DictionarySpams.train-233"><span class="linenos">233</span></a><span class="sd">        threads : int, optional</span>
</span><span id="DictionarySpams.train-234"><a href="#DictionarySpams.train-234"><span class="linenos">234</span></a><span class="sd">            Number of threads to use during training, see [1].</span>
</span><span id="DictionarySpams.train-235"><a href="#DictionarySpams.train-235"><span class="linenos">235</span></a>
</span><span id="DictionarySpams.train-236"><a href="#DictionarySpams.train-236"><span class="linenos">236</span></a><span class="sd">        **kwargs</span>
</span><span id="DictionarySpams.train-237"><a href="#DictionarySpams.train-237"><span class="linenos">237</span></a><span class="sd">            Passed directly to &#39;spams.trainDL&#39;, see [1].</span>
</span><span id="DictionarySpams.train-238"><a href="#DictionarySpams.train-238"><span class="linenos">238</span></a>
</span><span id="DictionarySpams.train-239"><a href="#DictionarySpams.train-239"><span class="linenos">239</span></a><span class="sd">        Additional parameters will be passed to the SPAMS training function.</span>
</span><span id="DictionarySpams.train-240"><a href="#DictionarySpams.train-240"><span class="linenos">240</span></a>
</span><span id="DictionarySpams.train-241"><a href="#DictionarySpams.train-241"><span class="linenos">241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.train-242"><a href="#DictionarySpams.train-242"><span class="linenos">242</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams.train-243"><a href="#DictionarySpams.train-243"><span class="linenos">243</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="DictionarySpams.train-244"><a href="#DictionarySpams.train-244"><span class="linenos">244</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the dictionary has already been trained&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.train-245"><a href="#DictionarySpams.train-245"><span class="linenos">245</span></a>            <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lambda1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">:</span>
</span><span id="DictionarySpams.train-246"><a href="#DictionarySpams.train-246"><span class="linenos">246</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the &#39;lambda1&#39; parameter must be the same &quot;</span>
</span><span id="DictionarySpams.train-247"><a href="#DictionarySpams.train-247"><span class="linenos">247</span></a>                                 <span class="s2">&quot;as the one used at the previous training&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.train-248"><a href="#DictionarySpams.train-248"><span class="linenos">248</span></a>
</span><span id="DictionarySpams.train-249"><a href="#DictionarySpams.train-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_length</span><span class="p">:</span>
</span><span id="DictionarySpams.train-250"><a href="#DictionarySpams.train-250"><span class="linenos">250</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the length of &#39;patches&#39; must be the same as the&quot;</span>
</span><span id="DictionarySpams.train-251"><a href="#DictionarySpams.train-251"><span class="linenos">251</span></a>                             <span class="s2">&quot; atoms of the dictionary&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.train-252"><a href="#DictionarySpams.train-252"><span class="linenos">252</span></a>        
</span><span id="DictionarySpams.train-253"><a href="#DictionarySpams.train-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.train-254"><a href="#DictionarySpams.train-254"><span class="linenos">254</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.train-255"><a href="#DictionarySpams.train-255"><span class="linenos">255</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;n_iter&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.train-256"><a href="#DictionarySpams.train-256"><span class="linenos">256</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.train-257"><a href="#DictionarySpams.train-257"><span class="linenos">257</span></a>                <span class="n">n_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span>
</span><span id="DictionarySpams.train-258"><a href="#DictionarySpams.train-258"><span class="linenos">258</span></a>            
</span><span id="DictionarySpams.train-259"><a href="#DictionarySpams.train-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.train-260"><a href="#DictionarySpams.train-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.train-261"><a href="#DictionarySpams.train-261"><span class="linenos">261</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;lambda1&#39; not specified&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.train-262"><a href="#DictionarySpams.train-262"><span class="linenos">262</span></a>            
</span><span id="DictionarySpams.train-263"><a href="#DictionarySpams.train-263"><span class="linenos">263</span></a>            <span class="n">lambda1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span>
</span><span id="DictionarySpams.train-264"><a href="#DictionarySpams.train-264"><span class="linenos">264</span></a>
</span><span id="DictionarySpams.train-265"><a href="#DictionarySpams.train-265"><span class="linenos">265</span></a>        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DictionarySpams.train-266"><a href="#DictionarySpams.train-266"><span class="linenos">266</span></a>        <span class="n">components</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">spams</span><span class="o">.</span><span class="n">trainDL</span><span class="p">(</span>
</span><span id="DictionarySpams.train-267"><a href="#DictionarySpams.train-267"><span class="linenos">267</span></a>            <span class="n">patches</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>            <span class="c1"># SPAMS works with Fortran order.</span>
</span><span id="DictionarySpams.train-268"><a href="#DictionarySpams.train-268"><span class="linenos">268</span></a>            <span class="n">D</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1">#</span>
</span><span id="DictionarySpams.train-269"><a href="#DictionarySpams.train-269"><span class="linenos">269</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="DictionarySpams.train-270"><a href="#DictionarySpams.train-270"><span class="linenos">270</span></a>            <span class="n">batchsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DictionarySpams.train-271"><a href="#DictionarySpams.train-271"><span class="linenos">271</span></a>            <span class="n">K</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_size</span><span class="p">,</span>  <span class="c1"># In SPAMS argo, the dictionary size is the number of atoms.</span>
</span><span id="DictionarySpams.train-272"><a href="#DictionarySpams.train-272"><span class="linenos">272</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="DictionarySpams.train-273"><a href="#DictionarySpams.train-273"><span class="linenos">273</span></a>            <span class="nb">iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="DictionarySpams.train-274"><a href="#DictionarySpams.train-274"><span class="linenos">274</span></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams.train-275"><a href="#DictionarySpams.train-275"><span class="linenos">275</span></a>            <span class="n">modeD</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams.train-276"><a href="#DictionarySpams.train-276"><span class="linenos">276</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="DictionarySpams.train-277"><a href="#DictionarySpams.train-277"><span class="linenos">277</span></a>            <span class="n">numThreads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
</span><span id="DictionarySpams.train-278"><a href="#DictionarySpams.train-278"><span class="linenos">278</span></a>            <span class="n">return_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.train-279"><a href="#DictionarySpams.train-279"><span class="linenos">279</span></a>            <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams.train-280"><a href="#DictionarySpams.train-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams.train-281"><a href="#DictionarySpams.train-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">T</span>
</span><span id="DictionarySpams.train-282"><a href="#DictionarySpams.train-282"><span class="linenos">282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="DictionarySpams.train-283"><a href="#DictionarySpams.train-283"><span class="linenos">283</span></a>        <span class="n">tac</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DictionarySpams.train-284"><a href="#DictionarySpams.train-284"><span class="linenos">284</span></a>
</span><span id="DictionarySpams.train-285"><a href="#DictionarySpams.train-285"><span class="linenos">285</span></a>        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
</span><span id="DictionarySpams.train-286"><a href="#DictionarySpams.train-286"><span class="linenos">286</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams.train-287"><a href="#DictionarySpams.train-287"><span class="linenos">287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.train-288"><a href="#DictionarySpams.train-288"><span class="linenos">288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="DictionarySpams.train-289"><a href="#DictionarySpams.train-289"><span class="linenos">289</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.train-290"><a href="#DictionarySpams.train-290"><span class="linenos">290</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">+=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams.train-291"><a href="#DictionarySpams.train-291"><span class="linenos">291</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">+=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span><span id="DictionarySpams.train-292"><a href="#DictionarySpams.train-292"><span class="linenos">292</span></a>
</span><span id="DictionarySpams.train-293"><a href="#DictionarySpams.train-293"><span class="linenos">293</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.train-294"><a href="#DictionarySpams.train-294"><span class="linenos">294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DictionarySpams.train-295"><a href="#DictionarySpams.train-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span> <span class="o">=</span> <span class="n">lambda1</span>
</span><span id="DictionarySpams.train-296"><a href="#DictionarySpams.train-296"><span class="linenos">296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams.train-297"><a href="#DictionarySpams.train-297"><span class="linenos">297</span></a>
</span><span id="DictionarySpams.train-298"><a href="#DictionarySpams.train-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="n">n_iter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams.train-299"><a href="#DictionarySpams.train-299"><span class="linenos">299</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;iter&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.train-300"><a href="#DictionarySpams.train-300"><span class="linenos">300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_iter</span>
</span><span id="DictionarySpams.train-301"><a href="#DictionarySpams.train-301"><span class="linenos">301</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.train-302"><a href="#DictionarySpams.train-302"><span class="linenos">302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
</span><span id="DictionarySpams.train-303"><a href="#DictionarySpams.train-303"><span class="linenos">303</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="n">tac</span> <span class="o">-</span> <span class="n">tic</span>
</span></pre></div>


            <div class="docstring"><p>Train the dictionary.</p>

<p>Train the dictionary with the given patches.</p>

<p>This also allows a warm start using the previous components as initial
dictionary, but only if the lambda1 parameter is the same. It can be
thought of as adding more iterations to the training. Hence, providing
different patches is discouraged and untested.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>patches</strong> (2d-array(signals, samples)):
Training patches.</li>
<li><strong>lambda1</strong> (float, optional):
Regularization parameter of the learning algorithm.
It is not needed if already specified at initialization.</li>
<li><strong>n_iter</strong> (int, optional):
Total number of iterations to perform.
If a negative number is provided it will perform the computation
during the corresponding number of seconds.
For instance <code>n_iter = -5</code> trains the dictionary during 5 seconds.</li>
<li><strong>warm_start</strong> (bool):
If True, use the previous components as initial dictionary.
It can be thought of as adding more iterations to the training.
Providing different patches is discouraged and untested.</li>
<li><strong>verbose</strong> (bool, optional):
If True print the iterations (might not be shown in real time).</li>
<li><strong>threads</strong> (int, optional):
Number of threads to use during training, see [1].</li>
<li><strong>**kwargs</strong>: Passed directly to 'spams.trainDL', see [1].</li>
<li><strong>Additional parameters will be passed to the SPAMS training function.</strong></li>
</ul>
</div>


                            </div>
                            <div id="DictionarySpams.reconstruct" class="classattr">
                                        <input id="DictionarySpams.reconstruct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">signal</span>,</span><span class="param">	<span class="n">sc_lambda</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">with_code</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reconstruct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reconstruct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reconstruct-329"><a href="#DictionarySpams.reconstruct-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_code</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct-330"><a href="#DictionarySpams.reconstruct-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct a signal as a sparse combination of dictionary atoms.</span>
</span><span id="DictionarySpams.reconstruct-331"><a href="#DictionarySpams.reconstruct-331"><span class="linenos">331</span></a>
</span><span id="DictionarySpams.reconstruct-332"><a href="#DictionarySpams.reconstruct-332"><span class="linenos">332</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams.reconstruct-333"><a href="#DictionarySpams.reconstruct-333"><span class="linenos">333</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.reconstruct-334"><a href="#DictionarySpams.reconstruct-334"><span class="linenos">334</span></a><span class="sd">        signal : ndarray</span>
</span><span id="DictionarySpams.reconstruct-335"><a href="#DictionarySpams.reconstruct-335"><span class="linenos">335</span></a><span class="sd">            Sample to be reconstructed.</span>
</span><span id="DictionarySpams.reconstruct-336"><a href="#DictionarySpams.reconstruct-336"><span class="linenos">336</span></a>
</span><span id="DictionarySpams.reconstruct-337"><a href="#DictionarySpams.reconstruct-337"><span class="linenos">337</span></a><span class="sd">        sc_lambda : float</span>
</span><span id="DictionarySpams.reconstruct-338"><a href="#DictionarySpams.reconstruct-338"><span class="linenos">338</span></a><span class="sd">            Regularization parameter of the sparse coding transformation.</span>
</span><span id="DictionarySpams.reconstruct-339"><a href="#DictionarySpams.reconstruct-339"><span class="linenos">339</span></a>
</span><span id="DictionarySpams.reconstruct-340"><a href="#DictionarySpams.reconstruct-340"><span class="linenos">340</span></a><span class="sd">        step : int, 1 by default</span>
</span><span id="DictionarySpams.reconstruct-341"><a href="#DictionarySpams.reconstruct-341"><span class="linenos">341</span></a><span class="sd">            Sample interval between each patch extracted from signal.</span>
</span><span id="DictionarySpams.reconstruct-342"><a href="#DictionarySpams.reconstruct-342"><span class="linenos">342</span></a><span class="sd">            Determines the number of patches to be extracted. 1 by default.</span>
</span><span id="DictionarySpams.reconstruct-343"><a href="#DictionarySpams.reconstruct-343"><span class="linenos">343</span></a>
</span><span id="DictionarySpams.reconstruct-344"><a href="#DictionarySpams.reconstruct-344"><span class="linenos">344</span></a><span class="sd">        normed : boolean, True by default</span>
</span><span id="DictionarySpams.reconstruct-345"><a href="#DictionarySpams.reconstruct-345"><span class="linenos">345</span></a><span class="sd">            Normalize the result to the maximum absolute value.</span>
</span><span id="DictionarySpams.reconstruct-346"><a href="#DictionarySpams.reconstruct-346"><span class="linenos">346</span></a>
</span><span id="DictionarySpams.reconstruct-347"><a href="#DictionarySpams.reconstruct-347"><span class="linenos">347</span></a><span class="sd">        with_code : boolean, False by default.</span>
</span><span id="DictionarySpams.reconstruct-348"><a href="#DictionarySpams.reconstruct-348"><span class="linenos">348</span></a><span class="sd">            If True, also returns the coefficients array.</span>
</span><span id="DictionarySpams.reconstruct-349"><a href="#DictionarySpams.reconstruct-349"><span class="linenos">349</span></a>
</span><span id="DictionarySpams.reconstruct-350"><a href="#DictionarySpams.reconstruct-350"><span class="linenos">350</span></a><span class="sd">        **kwargs</span>
</span><span id="DictionarySpams.reconstruct-351"><a href="#DictionarySpams.reconstruct-351"><span class="linenos">351</span></a><span class="sd">            Passed directly to the external learning function.</span>
</span><span id="DictionarySpams.reconstruct-352"><a href="#DictionarySpams.reconstruct-352"><span class="linenos">352</span></a>
</span><span id="DictionarySpams.reconstruct-353"><a href="#DictionarySpams.reconstruct-353"><span class="linenos">353</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams.reconstruct-354"><a href="#DictionarySpams.reconstruct-354"><span class="linenos">354</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams.reconstruct-355"><a href="#DictionarySpams.reconstruct-355"><span class="linenos">355</span></a><span class="sd">        signal_rec : array</span>
</span><span id="DictionarySpams.reconstruct-356"><a href="#DictionarySpams.reconstruct-356"><span class="linenos">356</span></a><span class="sd">            Reconstructed signal.</span>
</span><span id="DictionarySpams.reconstruct-357"><a href="#DictionarySpams.reconstruct-357"><span class="linenos">357</span></a>
</span><span id="DictionarySpams.reconstruct-358"><a href="#DictionarySpams.reconstruct-358"><span class="linenos">358</span></a><span class="sd">        code : array(a_length, d_size), optional</span>
</span><span id="DictionarySpams.reconstruct-359"><a href="#DictionarySpams.reconstruct-359"><span class="linenos">359</span></a><span class="sd">            Transformed data, encoded as a sparse combination of atoms.</span>
</span><span id="DictionarySpams.reconstruct-360"><a href="#DictionarySpams.reconstruct-360"><span class="linenos">360</span></a><span class="sd">            Returned when &#39;with_code&#39; is True.</span>
</span><span id="DictionarySpams.reconstruct-361"><a href="#DictionarySpams.reconstruct-361"><span class="linenos">361</span></a>
</span><span id="DictionarySpams.reconstruct-362"><a href="#DictionarySpams.reconstruct-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reconstruct-363"><a href="#DictionarySpams.reconstruct-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct-364"><a href="#DictionarySpams.reconstruct-364"><span class="linenos">364</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;signal&#39; must be a numpy array&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct-365"><a href="#DictionarySpams.reconstruct-365"><span class="linenos">365</span></a>
</span><span id="DictionarySpams.reconstruct-366"><a href="#DictionarySpams.reconstruct-366"><span class="linenos">366</span></a>        <span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct-367"><a href="#DictionarySpams.reconstruct-367"><span class="linenos">367</span></a>
</span><span id="DictionarySpams.reconstruct-368"><a href="#DictionarySpams.reconstruct-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">signal_rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams.reconstruct-369"><a href="#DictionarySpams.reconstruct-369"><span class="linenos">369</span></a>            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_rec</span><span class="p">))</span>
</span><span id="DictionarySpams.reconstruct-370"><a href="#DictionarySpams.reconstruct-370"><span class="linenos">370</span></a>            <span class="n">signal_rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams.reconstruct-371"><a href="#DictionarySpams.reconstruct-371"><span class="linenos">371</span></a>            <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams.reconstruct-372"><a href="#DictionarySpams.reconstruct-372"><span class="linenos">372</span></a>
</span><span id="DictionarySpams.reconstruct-373"><a href="#DictionarySpams.reconstruct-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">signal_rec</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_code</span> <span class="k">else</span> <span class="n">signal_rec</span>
</span></pre></div>


            <div class="docstring"><p>Reconstruct a signal as a sparse combination of dictionary atoms.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>signal</strong> (ndarray):
Sample to be reconstructed.</li>
<li><strong>sc_lambda</strong> (float):
Regularization parameter of the sparse coding transformation.</li>
<li><strong>step</strong> (int, 1 by default):
Sample interval between each patch extracted from signal.
Determines the number of patches to be extracted. 1 by default.</li>
<li><strong>normed</strong> (boolean, True by default):
Normalize the result to the maximum absolute value.</li>
<li><strong>with_code</strong> (boolean, False by default.):
If True, also returns the coefficients array.</li>
<li><strong>**kwargs</strong>: Passed directly to the external learning function.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>signal_rec</strong> (array):
Reconstructed signal.</li>
<li><strong>code</strong> (array(a_length, d_size), optional):
Transformed data, encoded as a sparse combination of atoms.
Returned when 'with_code' is True.</li>
</ul>
</div>


                            </div>
                            <div id="DictionarySpams.reconstruct_batch" class="classattr">
                                        <input id="DictionarySpams.reconstruct_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">signals</span>,</span><span class="param">	<span class="n">sc_lambda</span>,</span><span class="param">	<span class="n">out</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reconstruct_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reconstruct_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reconstruct_batch-401"><a href="#DictionarySpams.reconstruct_batch-401"><span class="linenos">401</span></a>    <span class="k">def</span> <span class="nf">reconstruct_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_batch-402"><a href="#DictionarySpams.reconstruct_batch-402"><span class="linenos">402</span></a>                          <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_batch-403"><a href="#DictionarySpams.reconstruct_batch-403"><span class="linenos">403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams.reconstruct_batch-404"><a href="#DictionarySpams.reconstruct_batch-404"><span class="linenos">404</span></a>
</span><span id="DictionarySpams.reconstruct_batch-405"><a href="#DictionarySpams.reconstruct_batch-405"><span class="linenos">405</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="DictionarySpams.reconstruct_batch-406"><a href="#DictionarySpams.reconstruct_batch-406"><span class="linenos">406</span></a><span class="sd">        dictionary atoms.</span>
</span><span id="DictionarySpams.reconstruct_batch-407"><a href="#DictionarySpams.reconstruct_batch-407"><span class="linenos">407</span></a>
</span><span id="DictionarySpams.reconstruct_batch-408"><a href="#DictionarySpams.reconstruct_batch-408"><span class="linenos">408</span></a><span class="sd">        WARNING: Only viable for small &#39;signals&#39; set, it is really memory</span>
</span><span id="DictionarySpams.reconstruct_batch-409"><a href="#DictionarySpams.reconstruct_batch-409"><span class="linenos">409</span></a><span class="sd">        expensive (all patches are stored in a single array in memory).</span>
</span><span id="DictionarySpams.reconstruct_batch-410"><a href="#DictionarySpams.reconstruct_batch-410"><span class="linenos">410</span></a>
</span><span id="DictionarySpams.reconstruct_batch-411"><a href="#DictionarySpams.reconstruct_batch-411"><span class="linenos">411</span></a><span class="sd">        WARNING: &#39;out&#39; deprecated, left for backwards compatibility but will</span>
</span><span id="DictionarySpams.reconstruct_batch-412"><a href="#DictionarySpams.reconstruct_batch-412"><span class="linenos">412</span></a><span class="sd">        be ignored if given.</span>
</span><span id="DictionarySpams.reconstruct_batch-413"><a href="#DictionarySpams.reconstruct_batch-413"><span class="linenos">413</span></a>
</span><span id="DictionarySpams.reconstruct_batch-414"><a href="#DictionarySpams.reconstruct_batch-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reconstruct_batch-415"><a href="#DictionarySpams.reconstruct_batch-415"><span class="linenos">415</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_batch-416"><a href="#DictionarySpams.reconstruct_batch-416"><span class="linenos">416</span></a>
</span><span id="DictionarySpams.reconstruct_batch-417"><a href="#DictionarySpams.reconstruct_batch-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams.reconstruct_batch-418"><a href="#DictionarySpams.reconstruct_batch-418"><span class="linenos">418</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_batch-419"><a href="#DictionarySpams.reconstruct_batch-419"><span class="linenos">419</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_batch-420"><a href="#DictionarySpams.reconstruct_batch-420"><span class="linenos">420</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_batch-421"><a href="#DictionarySpams.reconstruct_batch-421"><span class="linenos">421</span></a>
</span><span id="DictionarySpams.reconstruct_batch-422"><a href="#DictionarySpams.reconstruct_batch-422"><span class="linenos">422</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>TODO</p>

<p>Reconstruct multiple signals, each one as a sparse combination of
dictionary atoms.</p>

<p>WARNING: Only viable for small 'signals' set, it is really memory
expensive (all patches are stored in a single array in memory).</p>

<p>WARNING: 'out' deprecated, left for backwards compatibility but will
be ignored if given.</p>
</div>


                            </div>
                            <div id="DictionarySpams.reconstruct_minibatch" class="classattr">
                                        <input id="DictionarySpams.reconstruct_minibatch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct_minibatch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">signals</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">sc_lambda</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">batchsize</span><span class="o">=</span><span class="mi">4</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reconstruct_minibatch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reconstruct_minibatch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reconstruct_minibatch-424"><a href="#DictionarySpams.reconstruct_minibatch-424"><span class="linenos">424</span></a>    <span class="k">def</span> <span class="nf">reconstruct_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_minibatch-425"><a href="#DictionarySpams.reconstruct_minibatch-425"><span class="linenos">425</span></a>                              <span class="n">normed_windows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_minibatch-426"><a href="#DictionarySpams.reconstruct_minibatch-426"><span class="linenos">426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams.reconstruct_minibatch-427"><a href="#DictionarySpams.reconstruct_minibatch-427"><span class="linenos">427</span></a>
</span><span id="DictionarySpams.reconstruct_minibatch-428"><a href="#DictionarySpams.reconstruct_minibatch-428"><span class="linenos">428</span></a><span class="sd">        Reconstruct multiple signals, each one as a sparse combination of</span>
</span><span id="DictionarySpams.reconstruct_minibatch-429"><a href="#DictionarySpams.reconstruct_minibatch-429"><span class="linenos">429</span></a><span class="sd">        dictionary atoms. Minibatch version.</span>
</span><span id="DictionarySpams.reconstruct_minibatch-430"><a href="#DictionarySpams.reconstruct_minibatch-430"><span class="linenos">430</span></a>
</span><span id="DictionarySpams.reconstruct_minibatch-431"><a href="#DictionarySpams.reconstruct_minibatch-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reconstruct_minibatch-432"><a href="#DictionarySpams.reconstruct_minibatch-432"><span class="linenos">432</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams.reconstruct_minibatch-433"><a href="#DictionarySpams.reconstruct_minibatch-433"><span class="linenos">433</span></a>        <span class="n">n_minibatch</span> <span class="o">=</span> <span class="n">n_signals</span> <span class="o">//</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams.reconstruct_minibatch-434"><a href="#DictionarySpams.reconstruct_minibatch-434"><span class="linenos">434</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-435"><a href="#DictionarySpams.reconstruct_minibatch-435"><span class="linenos">435</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_minibatch</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-436"><a href="#DictionarySpams.reconstruct_minibatch-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-437"><a href="#DictionarySpams.reconstruct_minibatch-437"><span class="linenos">437</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-438"><a href="#DictionarySpams.reconstruct_minibatch-438"><span class="linenos">438</span></a>        
</span><span id="DictionarySpams.reconstruct_minibatch-439"><a href="#DictionarySpams.reconstruct_minibatch-439"><span class="linenos">439</span></a>        <span class="k">for</span> <span class="n">ibatch</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-440"><a href="#DictionarySpams.reconstruct_minibatch-440"><span class="linenos">440</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">ibatch</span> <span class="o">*</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams.reconstruct_minibatch-441"><a href="#DictionarySpams.reconstruct_minibatch-441"><span class="linenos">441</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">batchsize</span>
</span><span id="DictionarySpams.reconstruct_minibatch-442"><a href="#DictionarySpams.reconstruct_minibatch-442"><span class="linenos">442</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span>
</span><span id="DictionarySpams.reconstruct_minibatch-443"><a href="#DictionarySpams.reconstruct_minibatch-443"><span class="linenos">443</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="DictionarySpams.reconstruct_minibatch-444"><a href="#DictionarySpams.reconstruct_minibatch-444"><span class="linenos">444</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed_windows</span><span class="o">=</span><span class="n">normed_windows</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams.reconstruct_minibatch-445"><a href="#DictionarySpams.reconstruct_minibatch-445"><span class="linenos">445</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-446"><a href="#DictionarySpams.reconstruct_minibatch-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="n">n_minibatch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-447"><a href="#DictionarySpams.reconstruct_minibatch-447"><span class="linenos">447</span></a>            <span class="c1"># In case there was no point in using a minibatch:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-448"><a href="#DictionarySpams.reconstruct_minibatch-448"><span class="linenos">448</span></a>            <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DictionarySpams.reconstruct_minibatch-449"><a href="#DictionarySpams.reconstruct_minibatch-449"><span class="linenos">449</span></a>
</span><span id="DictionarySpams.reconstruct_minibatch-450"><a href="#DictionarySpams.reconstruct_minibatch-450"><span class="linenos">450</span></a>        <span class="c1"># If &#39;n_signals&#39; was not divisible by &#39;batchsize&#39; reconstruct the</span>
</span><span id="DictionarySpams.reconstruct_minibatch-451"><a href="#DictionarySpams.reconstruct_minibatch-451"><span class="linenos">451</span></a>        <span class="c1"># remaining signals:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-452"><a href="#DictionarySpams.reconstruct_minibatch-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">n_signals</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_minibatch-453"><a href="#DictionarySpams.reconstruct_minibatch-453"><span class="linenos">453</span></a>            <span class="n">i0</span> <span class="o">=</span> <span class="n">i1</span>
</span><span id="DictionarySpams.reconstruct_minibatch-454"><a href="#DictionarySpams.reconstruct_minibatch-454"><span class="linenos">454</span></a>            <span class="n">minibatch</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span>
</span><span id="DictionarySpams.reconstruct_minibatch-455"><a href="#DictionarySpams.reconstruct_minibatch-455"><span class="linenos">455</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_batch</span><span class="p">(</span>
</span><span id="DictionarySpams.reconstruct_minibatch-456"><a href="#DictionarySpams.reconstruct_minibatch-456"><span class="linenos">456</span></a>                <span class="n">minibatch</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="DictionarySpams.reconstruct_minibatch-457"><a href="#DictionarySpams.reconstruct_minibatch-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-458"><a href="#DictionarySpams.reconstruct_minibatch-458"><span class="linenos">458</span></a>
</span><span id="DictionarySpams.reconstruct_minibatch-459"><a href="#DictionarySpams.reconstruct_minibatch-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams.reconstruct_minibatch-460"><a href="#DictionarySpams.reconstruct_minibatch-460"><span class="linenos">460</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_minibatch-461"><a href="#DictionarySpams.reconstruct_minibatch-461"><span class="linenos">461</span></a>                <span class="n">out</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-462"><a href="#DictionarySpams.reconstruct_minibatch-462"><span class="linenos">462</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_minibatch-463"><a href="#DictionarySpams.reconstruct_minibatch-463"><span class="linenos">463</span></a>
</span><span id="DictionarySpams.reconstruct_minibatch-464"><a href="#DictionarySpams.reconstruct_minibatch-464"><span class="linenos">464</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>TODO</p>

<p>Reconstruct multiple signals, each one as a sparse combination of
dictionary atoms. Minibatch version.</p>
</div>


                            </div>
                            <div id="DictionarySpams.reconstruct_auto" class="classattr">
                                        <input id="DictionarySpams.reconstruct_auto-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct_auto</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">signal</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">zero_marg</span>,</span><span class="param">	<span class="n">lambda_lims</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">full_output</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">kwargs_bisect</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reconstruct_auto-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reconstruct_auto"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reconstruct_auto-466"><a href="#DictionarySpams.reconstruct_auto-466"><span class="linenos">466</span></a>    <span class="k">def</span> <span class="nf">reconstruct_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">zero_marg</span><span class="p">,</span> <span class="n">lambda_lims</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_auto-467"><a href="#DictionarySpams.reconstruct_auto-467"><span class="linenos">467</span></a>                         <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kwargs_bisect</span><span class="o">=</span><span class="p">{},</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DictionarySpams.reconstruct_auto-468"><a href="#DictionarySpams.reconstruct_auto-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO</span>
</span><span id="DictionarySpams.reconstruct_auto-469"><a href="#DictionarySpams.reconstruct_auto-469"><span class="linenos">469</span></a>
</span><span id="DictionarySpams.reconstruct_auto-470"><a href="#DictionarySpams.reconstruct_auto-470"><span class="linenos">470</span></a><span class="sd">        Reconstrueix un nic senyal buscant per bisecci la lambda que</span>
</span><span id="DictionarySpams.reconstruct_auto-471"><a href="#DictionarySpams.reconstruct_auto-471"><span class="linenos">471</span></a><span class="sd">        minimitza el senyal reconstruit al marge esquerre del senyal, la mida</span>
</span><span id="DictionarySpams.reconstruct_auto-472"><a href="#DictionarySpams.reconstruct_auto-472"><span class="linenos">472</span></a><span class="sd">        dels quals ve determinada per &#39;zero_marg&#39;.</span>
</span><span id="DictionarySpams.reconstruct_auto-473"><a href="#DictionarySpams.reconstruct_auto-473"><span class="linenos">473</span></a>
</span><span id="DictionarySpams.reconstruct_auto-474"><a href="#DictionarySpams.reconstruct_auto-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reconstruct_auto-475"><a href="#DictionarySpams.reconstruct_auto-475"><span class="linenos">475</span></a>        <span class="c1"># Margins of the signals to be zeroed</span>
</span><span id="DictionarySpams.reconstruct_auto-476"><a href="#DictionarySpams.reconstruct_auto-476"><span class="linenos">476</span></a>        <span class="n">margin</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[:</span><span class="n">zero_marg</span><span class="p">]</span>
</span><span id="DictionarySpams.reconstruct_auto-477"><a href="#DictionarySpams.reconstruct_auto-477"><span class="linenos">477</span></a>        <span class="c1"># Function to be bisected.</span>
</span><span id="DictionarySpams.reconstruct_auto-478"><a href="#DictionarySpams.reconstruct_auto-478"><span class="linenos">478</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">sc_lambda</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_auto-479"><a href="#DictionarySpams.reconstruct_auto-479"><span class="linenos">479</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_auto-480"><a href="#DictionarySpams.reconstruct_auto-480"><span class="linenos">480</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="DictionarySpams.reconstruct_auto-481"><a href="#DictionarySpams.reconstruct_auto-481"><span class="linenos">481</span></a>
</span><span id="DictionarySpams.reconstruct_auto-482"><a href="#DictionarySpams.reconstruct_auto-482"><span class="linenos">482</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_auto-483"><a href="#DictionarySpams.reconstruct_auto-483"><span class="linenos">483</span></a>            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="DictionarySpams.reconstruct_auto-484"><a href="#DictionarySpams.reconstruct_auto-484"><span class="linenos">484</span></a>                <span class="c1"># Ignore specific warning from extract_patches since here we do</span>
</span><span id="DictionarySpams.reconstruct_auto-485"><a href="#DictionarySpams.reconstruct_auto-485"><span class="linenos">485</span></a>                <span class="c1"># not care about reconstructing the entire strain (margin).</span>
</span><span id="DictionarySpams.reconstruct_auto-486"><a href="#DictionarySpams.reconstruct_auto-486"><span class="linenos">486</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;&#39;signals&#39; cannot be fully divided into patches.*&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_auto-487"><a href="#DictionarySpams.reconstruct_auto-487"><span class="linenos">487</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">semibool_bisect</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">*</span><span class="n">lambda_lims</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_bisect</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_auto-488"><a href="#DictionarySpams.reconstruct_auto-488"><span class="linenos">488</span></a>        
</span><span id="DictionarySpams.reconstruct_auto-489"><a href="#DictionarySpams.reconstruct_auto-489"><span class="linenos">489</span></a>        <span class="k">except</span> <span class="n">lib</span><span class="o">.</span><span class="n">BoundaryError</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_auto-490"><a href="#DictionarySpams.reconstruct_auto-490"><span class="linenos">490</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_auto-491"><a href="#DictionarySpams.reconstruct_auto-491"><span class="linenos">491</span></a>            <span class="n">code</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams.reconstruct_auto-492"><a href="#DictionarySpams.reconstruct_auto-492"><span class="linenos">492</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lambda_lims</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;converged&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;niters&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;funcalls&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span><span id="DictionarySpams.reconstruct_auto-493"><a href="#DictionarySpams.reconstruct_auto-493"><span class="linenos">493</span></a>        
</span><span id="DictionarySpams.reconstruct_auto-494"><a href="#DictionarySpams.reconstruct_auto-494"><span class="linenos">494</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_auto-495"><a href="#DictionarySpams.reconstruct_auto-495"><span class="linenos">495</span></a>            <span class="n">rec</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_single</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">step</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_auto-496"><a href="#DictionarySpams.reconstruct_auto-496"><span class="linenos">496</span></a>            <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams.reconstruct_auto-497"><a href="#DictionarySpams.reconstruct_auto-497"><span class="linenos">497</span></a>                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
</span><span id="DictionarySpams.reconstruct_auto-498"><a href="#DictionarySpams.reconstruct_auto-498"><span class="linenos">498</span></a>                <span class="n">rec</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams.reconstruct_auto-499"><a href="#DictionarySpams.reconstruct_auto-499"><span class="linenos">499</span></a>                <span class="n">code</span> <span class="o">/=</span> <span class="n">norm</span>
</span><span id="DictionarySpams.reconstruct_auto-500"><a href="#DictionarySpams.reconstruct_auto-500"><span class="linenos">500</span></a>
</span><span id="DictionarySpams.reconstruct_auto-501"><a href="#DictionarySpams.reconstruct_auto-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">rec</span>
</span></pre></div>


            <div class="docstring"><p>TODO</p>

<p>Reconstrueix un nic senyal buscant per bisecci la lambda que
minimitza el senyal reconstruit al marge esquerre del senyal, la mida
dels quals ve determinada per 'zero_marg'.</p>
</div>


                            </div>
                            <div id="DictionarySpams.reconstruct_iterative_minibatch" class="classattr">
                                        <input id="DictionarySpams.reconstruct_iterative_minibatch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reconstruct_iterative_minibatch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">signals</span>,</span><span class="param">	<span class="n">sc_lambda</span><span class="o">=</span><span class="mf">0.01</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">batchsize</span><span class="o">=</span><span class="mi">64</span>,</span><span class="param">	<span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span>,</span><span class="param">	<span class="n">threshold</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">full_output</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reconstruct_iterative_minibatch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reconstruct_iterative_minibatch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reconstruct_iterative_minibatch-503"><a href="#DictionarySpams.reconstruct_iterative_minibatch-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">reconstruct_iterative_minibatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-504"><a href="#DictionarySpams.reconstruct_iterative_minibatch-504"><span class="linenos">504</span></a>                                        <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-505"><a href="#DictionarySpams.reconstruct_iterative_minibatch-505"><span class="linenos">505</span></a>                                        <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-506"><a href="#DictionarySpams.reconstruct_iterative_minibatch-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct multiple signals using iterative residual subtraction.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-507"><a href="#DictionarySpams.reconstruct_iterative_minibatch-507"><span class="linenos">507</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-508"><a href="#DictionarySpams.reconstruct_iterative_minibatch-508"><span class="linenos">508</span></a><span class="sd">        This method reconstructs each signal by iteratively updating and</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-509"><a href="#DictionarySpams.reconstruct_iterative_minibatch-509"><span class="linenos">509</span></a><span class="sd">        accumulating reconstructions. In the first iteration, the original </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-510"><a href="#DictionarySpams.reconstruct_iterative_minibatch-510"><span class="linenos">510</span></a><span class="sd">        input signal is reconstructed and then subtracted from itself to </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-511"><a href="#DictionarySpams.reconstruct_iterative_minibatch-511"><span class="linenos">511</span></a><span class="sd">        obtain the initial residual. In each subsequent iteration, a new </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-512"><a href="#DictionarySpams.reconstruct_iterative_minibatch-512"><span class="linenos">512</span></a><span class="sd">        reconstruction is generated from the current residual and subtracted </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-513"><a href="#DictionarySpams.reconstruct_iterative_minibatch-513"><span class="linenos">513</span></a><span class="sd">        from it, producing an updated residual for the next iteration, while </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-514"><a href="#DictionarySpams.reconstruct_iterative_minibatch-514"><span class="linenos">514</span></a><span class="sd">        also being added to the cumulative reconstruction. The process </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-515"><a href="#DictionarySpams.reconstruct_iterative_minibatch-515"><span class="linenos">515</span></a><span class="sd">        repeats until the Euclidean norm of the difference between consecutive </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-516"><a href="#DictionarySpams.reconstruct_iterative_minibatch-516"><span class="linenos">516</span></a><span class="sd">        residuals falls below a specified threshold, which sets the convergence </span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-517"><a href="#DictionarySpams.reconstruct_iterative_minibatch-517"><span class="linenos">517</span></a><span class="sd">        criterion.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-518"><a href="#DictionarySpams.reconstruct_iterative_minibatch-518"><span class="linenos">518</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-519"><a href="#DictionarySpams.reconstruct_iterative_minibatch-519"><span class="linenos">519</span></a><span class="sd">        NOTE: In contrast with the usual procedure, the windows into which each</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-520"><a href="#DictionarySpams.reconstruct_iterative_minibatch-520"><span class="linenos">520</span></a><span class="sd">        signal is split are not normalized. This is needed to enhance the</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-521"><a href="#DictionarySpams.reconstruct_iterative_minibatch-521"><span class="linenos">521</span></a><span class="sd">        dictionary discrimination. Otherwise, the residuals are amplified at</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-522"><a href="#DictionarySpams.reconstruct_iterative_minibatch-522"><span class="linenos">522</span></a><span class="sd">        each iteration, the algorithm takes longer to converge, and some</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-523"><a href="#DictionarySpams.reconstruct_iterative_minibatch-523"><span class="linenos">523</span></a><span class="sd">        ad-hoc tests showed it also messes up with the resulting shape.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-524"><a href="#DictionarySpams.reconstruct_iterative_minibatch-524"><span class="linenos">524</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-525"><a href="#DictionarySpams.reconstruct_iterative_minibatch-525"><span class="linenos">525</span></a><span class="sd">        Parameters</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-526"><a href="#DictionarySpams.reconstruct_iterative_minibatch-526"><span class="linenos">526</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-527"><a href="#DictionarySpams.reconstruct_iterative_minibatch-527"><span class="linenos">527</span></a><span class="sd">        signals : ndarray</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-528"><a href="#DictionarySpams.reconstruct_iterative_minibatch-528"><span class="linenos">528</span></a><span class="sd">            Input signals to be reconstructed, with each signal along the first dimension.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-529"><a href="#DictionarySpams.reconstruct_iterative_minibatch-529"><span class="linenos">529</span></a><span class="sd">        sc_lambda : float, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-530"><a href="#DictionarySpams.reconstruct_iterative_minibatch-530"><span class="linenos">530</span></a><span class="sd">            Sparsity control parameter for reconstruction.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-531"><a href="#DictionarySpams.reconstruct_iterative_minibatch-531"><span class="linenos">531</span></a><span class="sd">        step : int, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-532"><a href="#DictionarySpams.reconstruct_iterative_minibatch-532"><span class="linenos">532</span></a><span class="sd">            Step size for the reconstruction.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-533"><a href="#DictionarySpams.reconstruct_iterative_minibatch-533"><span class="linenos">533</span></a><span class="sd">        batchsize : int, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-534"><a href="#DictionarySpams.reconstruct_iterative_minibatch-534"><span class="linenos">534</span></a><span class="sd">            Number of signals processed in each minibatch.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-535"><a href="#DictionarySpams.reconstruct_iterative_minibatch-535"><span class="linenos">535</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-536"><a href="#DictionarySpams.reconstruct_iterative_minibatch-536"><span class="linenos">536</span></a><span class="sd">            Maximum number of iterations before stopping.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-537"><a href="#DictionarySpams.reconstruct_iterative_minibatch-537"><span class="linenos">537</span></a><span class="sd">        threshold : float, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-538"><a href="#DictionarySpams.reconstruct_iterative_minibatch-538"><span class="linenos">538</span></a><span class="sd">            Convergence threshold based on the relative change in residuals.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-539"><a href="#DictionarySpams.reconstruct_iterative_minibatch-539"><span class="linenos">539</span></a><span class="sd">        normed : bool, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-540"><a href="#DictionarySpams.reconstruct_iterative_minibatch-540"><span class="linenos">540</span></a><span class="sd">            If True, the reconstructed signals are normalized after convergence.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-541"><a href="#DictionarySpams.reconstruct_iterative_minibatch-541"><span class="linenos">541</span></a><span class="sd">        full_output : bool, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-542"><a href="#DictionarySpams.reconstruct_iterative_minibatch-542"><span class="linenos">542</span></a><span class="sd">            If True, returns additional output values (residuals and iteration counts).</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-543"><a href="#DictionarySpams.reconstruct_iterative_minibatch-543"><span class="linenos">543</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-544"><a href="#DictionarySpams.reconstruct_iterative_minibatch-544"><span class="linenos">544</span></a><span class="sd">            If True, prints progress information at each iteration.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-545"><a href="#DictionarySpams.reconstruct_iterative_minibatch-545"><span class="linenos">545</span></a><span class="sd">        kwargs_lasso : dict, optional</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-546"><a href="#DictionarySpams.reconstruct_iterative_minibatch-546"><span class="linenos">546</span></a><span class="sd">            Additional arguments for the Lasso reconstruction method.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-547"><a href="#DictionarySpams.reconstruct_iterative_minibatch-547"><span class="linenos">547</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-548"><a href="#DictionarySpams.reconstruct_iterative_minibatch-548"><span class="linenos">548</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-549"><a href="#DictionarySpams.reconstruct_iterative_minibatch-549"><span class="linenos">549</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-550"><a href="#DictionarySpams.reconstruct_iterative_minibatch-550"><span class="linenos">550</span></a><span class="sd">        ndarray or tuple</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-551"><a href="#DictionarySpams.reconstruct_iterative_minibatch-551"><span class="linenos">551</span></a><span class="sd">            The final reconstructed signals. If `full_output` is True, also returns the residuals</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-552"><a href="#DictionarySpams.reconstruct_iterative_minibatch-552"><span class="linenos">552</span></a><span class="sd">            and the number of iterations per signal.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-553"><a href="#DictionarySpams.reconstruct_iterative_minibatch-553"><span class="linenos">553</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-554"><a href="#DictionarySpams.reconstruct_iterative_minibatch-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-555"><a href="#DictionarySpams.reconstruct_iterative_minibatch-555"><span class="linenos">555</span></a>        <span class="n">n_signals</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-556"><a href="#DictionarySpams.reconstruct_iterative_minibatch-556"><span class="linenos">556</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-557"><a href="#DictionarySpams.reconstruct_iterative_minibatch-557"><span class="linenos">557</span></a>        <span class="c1"># First iteration outside:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-558"><a href="#DictionarySpams.reconstruct_iterative_minibatch-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-559"><a href="#DictionarySpams.reconstruct_iterative_minibatch-559"><span class="linenos">559</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration 0&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-560"><a href="#DictionarySpams.reconstruct_iterative_minibatch-560"><span class="linenos">560</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="n">n_signals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-561"><a href="#DictionarySpams.reconstruct_iterative_minibatch-561"><span class="linenos">561</span></a>        
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-562"><a href="#DictionarySpams.reconstruct_iterative_minibatch-562"><span class="linenos">562</span></a>        <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-563"><a href="#DictionarySpams.reconstruct_iterative_minibatch-563"><span class="linenos">563</span></a>            <span class="n">signals</span><span class="p">,</span> <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-564"><a href="#DictionarySpams.reconstruct_iterative_minibatch-564"><span class="linenos">564</span></a>            <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-565"><a href="#DictionarySpams.reconstruct_iterative_minibatch-565"><span class="linenos">565</span></a>            <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-566"><a href="#DictionarySpams.reconstruct_iterative_minibatch-566"><span class="linenos">566</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-567"><a href="#DictionarySpams.reconstruct_iterative_minibatch-567"><span class="linenos">567</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-568"><a href="#DictionarySpams.reconstruct_iterative_minibatch-568"><span class="linenos">568</span></a>        <span class="n">final_reconstructions</span> <span class="o">=</span> <span class="n">step_reconstructions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-569"><a href="#DictionarySpams.reconstruct_iterative_minibatch-569"><span class="linenos">569</span></a>        <span class="n">residuals</span> <span class="o">=</span> <span class="n">signals</span> <span class="o">-</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-570"><a href="#DictionarySpams.reconstruct_iterative_minibatch-570"><span class="linenos">570</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-571"><a href="#DictionarySpams.reconstruct_iterative_minibatch-571"><span class="linenos">571</span></a>        <span class="c1"># Stop conditions</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-572"><a href="#DictionarySpams.reconstruct_iterative_minibatch-572"><span class="linenos">572</span></a>        <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_signals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-573"><a href="#DictionarySpams.reconstruct_iterative_minibatch-573"><span class="linenos">573</span></a>        <span class="n">finished</span> <span class="o">=</span> <span class="o">~</span><span class="n">step_reconstructions</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># In case any reconstructions are 0 already.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-574"><a href="#DictionarySpams.reconstruct_iterative_minibatch-574"><span class="linenos">574</span></a>        <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-575"><a href="#DictionarySpams.reconstruct_iterative_minibatch-575"><span class="linenos">575</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-576"><a href="#DictionarySpams.reconstruct_iterative_minibatch-576"><span class="linenos">576</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="ow">and</span> <span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-577"><a href="#DictionarySpams.reconstruct_iterative_minibatch-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-578"><a href="#DictionarySpams.reconstruct_iterative_minibatch-578"><span class="linenos">578</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteration </span><span class="si">{</span><span class="n">iters</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-579"><a href="#DictionarySpams.reconstruct_iterative_minibatch-579"><span class="linenos">579</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signals remaining: </span><span class="si">{</span><span class="p">(</span><span class="o">~</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">^13d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-580"><a href="#DictionarySpams.reconstruct_iterative_minibatch-580"><span class="linenos">580</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-581"><a href="#DictionarySpams.reconstruct_iterative_minibatch-581"><span class="linenos">581</span></a>            <span class="n">step_reconstructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_minibatch</span><span class="p">(</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-582"><a href="#DictionarySpams.reconstruct_iterative_minibatch-582"><span class="linenos">582</span></a>                <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-583"><a href="#DictionarySpams.reconstruct_iterative_minibatch-583"><span class="linenos">583</span></a>                <span class="n">sc_lambda</span><span class="o">=</span><span class="n">sc_lambda</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-584"><a href="#DictionarySpams.reconstruct_iterative_minibatch-584"><span class="linenos">584</span></a>                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-585"><a href="#DictionarySpams.reconstruct_iterative_minibatch-585"><span class="linenos">585</span></a>                <span class="n">batchsize</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-586"><a href="#DictionarySpams.reconstruct_iterative_minibatch-586"><span class="linenos">586</span></a>                <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Normalization is (optionally) applied at the END.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-587"><a href="#DictionarySpams.reconstruct_iterative_minibatch-587"><span class="linenos">587</span></a>                <span class="n">normed_windows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># See NOTE in the docstring.</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-588"><a href="#DictionarySpams.reconstruct_iterative_minibatch-588"><span class="linenos">588</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-589"><a href="#DictionarySpams.reconstruct_iterative_minibatch-589"><span class="linenos">589</span></a>                <span class="o">**</span><span class="n">kwargs_lasso</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-590"><a href="#DictionarySpams.reconstruct_iterative_minibatch-590"><span class="linenos">590</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-591"><a href="#DictionarySpams.reconstruct_iterative_minibatch-591"><span class="linenos">591</span></a>            <span class="n">final_reconstructions</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-592"><a href="#DictionarySpams.reconstruct_iterative_minibatch-592"><span class="linenos">592</span></a>            <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_reconstructions</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-593"><a href="#DictionarySpams.reconstruct_iterative_minibatch-593"><span class="linenos">593</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-594"><a href="#DictionarySpams.reconstruct_iterative_minibatch-594"><span class="linenos">594</span></a>            <span class="c1"># Stop conditions</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-595"><a href="#DictionarySpams.reconstruct_iterative_minibatch-595"><span class="linenos">595</span></a>            <span class="n">iters</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-596"><a href="#DictionarySpams.reconstruct_iterative_minibatch-596"><span class="linenos">596</span></a>            <span class="n">residual_decrease</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">-</span> <span class="n">residuals_old</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-597"><a href="#DictionarySpams.reconstruct_iterative_minibatch-597"><span class="linenos">597</span></a>            <span class="n">finished</span><span class="p">[</span><span class="o">~</span><span class="n">finished</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual_decrease</span> <span class="o">&lt;</span> <span class="n">threshold</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-598"><a href="#DictionarySpams.reconstruct_iterative_minibatch-598"><span class="linenos">598</span></a>            <span class="n">residuals_old</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-599"><a href="#DictionarySpams.reconstruct_iterative_minibatch-599"><span class="linenos">599</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-600"><a href="#DictionarySpams.reconstruct_iterative_minibatch-600"><span class="linenos">600</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-601"><a href="#DictionarySpams.reconstruct_iterative_minibatch-601"><span class="linenos">601</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-602"><a href="#DictionarySpams.reconstruct_iterative_minibatch-602"><span class="linenos">602</span></a>                    <span class="s2">&quot;CURRENT RESIDUAL DECREASE:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-603"><a href="#DictionarySpams.reconstruct_iterative_minibatch-603"><span class="linenos">603</span></a>                    <span class="sa">f</span><span class="s2">&quot;Max: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-604"><a href="#DictionarySpams.reconstruct_iterative_minibatch-604"><span class="linenos">604</span></a>                    <span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-605"><a href="#DictionarySpams.reconstruct_iterative_minibatch-605"><span class="linenos">605</span></a>                    <span class="sa">f</span><span class="s2">&quot;Min: </span><span class="si">{</span><span class="n">residual_decrease</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-606"><a href="#DictionarySpams.reconstruct_iterative_minibatch-606"><span class="linenos">606</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-607"><a href="#DictionarySpams.reconstruct_iterative_minibatch-607"><span class="linenos">607</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-608"><a href="#DictionarySpams.reconstruct_iterative_minibatch-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">finished</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-609"><a href="#DictionarySpams.reconstruct_iterative_minibatch-609"><span class="linenos">609</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: reached max_iter before finishing all the reconstructions&quot;</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-610"><a href="#DictionarySpams.reconstruct_iterative_minibatch-610"><span class="linenos">610</span></a>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-611"><a href="#DictionarySpams.reconstruct_iterative_minibatch-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-612"><a href="#DictionarySpams.reconstruct_iterative_minibatch-612"><span class="linenos">612</span></a>            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-613"><a href="#DictionarySpams.reconstruct_iterative_minibatch-613"><span class="linenos">613</span></a>                <span class="n">final_reconstructions</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-614"><a href="#DictionarySpams.reconstruct_iterative_minibatch-614"><span class="linenos">614</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-615"><a href="#DictionarySpams.reconstruct_iterative_minibatch-615"><span class="linenos">615</span></a>        
</span><span id="DictionarySpams.reconstruct_iterative_minibatch-616"><a href="#DictionarySpams.reconstruct_iterative_minibatch-616"><span class="linenos">616</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">final_reconstructions</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">iters</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_output</span> <span class="k">else</span> <span class="n">final_reconstructions</span>
</span></pre></div>


            <div class="docstring"><p>Reconstruct multiple signals using iterative residual subtraction.</p>

<p>This method reconstructs each signal by iteratively updating and
accumulating reconstructions. In the first iteration, the original 
input signal is reconstructed and then subtracted from itself to 
obtain the initial residual. In each subsequent iteration, a new 
reconstruction is generated from the current residual and subtracted 
from it, producing an updated residual for the next iteration, while 
also being added to the cumulative reconstruction. The process 
repeats until the Euclidean norm of the difference between consecutive 
residuals falls below a specified threshold, which sets the convergence 
criterion.</p>

<p>NOTE: In contrast with the usual procedure, the windows into which each
signal is split are not normalized. This is needed to enhance the
dictionary discrimination. Otherwise, the residuals are amplified at
each iteration, the algorithm takes longer to converge, and some
ad-hoc tests showed it also messes up with the resulting shape.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>signals</strong> (ndarray):
Input signals to be reconstructed, with each signal along the first dimension.</li>
<li><strong>sc_lambda</strong> (float, optional):
Sparsity control parameter for reconstruction.</li>
<li><strong>step</strong> (int, optional):
Step size for the reconstruction.</li>
<li><strong>batchsize</strong> (int, optional):
Number of signals processed in each minibatch.</li>
<li><strong>max_iter</strong> (int, optional):
Maximum number of iterations before stopping.</li>
<li><strong>threshold</strong> (float, optional):
Convergence threshold based on the relative change in residuals.</li>
<li><strong>normed</strong> (bool, optional):
If True, the reconstructed signals are normalized after convergence.</li>
<li><strong>full_output</strong> (bool, optional):
If True, returns additional output values (residuals and iteration counts).</li>
<li><strong>verbose</strong> (bool, optional):
If True, prints progress information at each iteration.</li>
<li><strong>kwargs_lasso</strong> (dict, optional):
Additional arguments for the Lasso reconstruction method.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ndarray or tuple</strong>: The final reconstructed signals. If <code>full_output</code> is True, also returns the residuals
and the number of iterations per signal.</li>
</ul>
</div>


                            </div>
                            <div id="DictionarySpams.optimum_reconstruct" class="classattr">
                                        <input id="DictionarySpams.optimum_reconstruct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">optimum_reconstruct</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">strain</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">reference</span>,</span><span class="param">	<span class="n">kwargs_minimize</span>,</span><span class="param">	<span class="n">kwargs_lasso</span>,</span><span class="param">	<span class="n">step</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">limits</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normed</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.optimum_reconstruct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.optimum_reconstruct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.optimum_reconstruct-619"><a href="#DictionarySpams.optimum_reconstruct-619"><span class="linenos">619</span></a>    <span class="k">def</span> <span class="nf">optimum_reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strain</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">kwargs_minimize</span><span class="p">,</span> <span class="n">kwargs_lasso</span><span class="p">,</span>
</span><span id="DictionarySpams.optimum_reconstruct-620"><a href="#DictionarySpams.optimum_reconstruct-620"><span class="linenos">620</span></a>                            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DictionarySpams.optimum_reconstruct-621"><a href="#DictionarySpams.optimum_reconstruct-621"><span class="linenos">621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the best reconstruction of a signal w.r.t. a reference.</span>
</span><span id="DictionarySpams.optimum_reconstruct-622"><a href="#DictionarySpams.optimum_reconstruct-622"><span class="linenos">622</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-623"><a href="#DictionarySpams.optimum_reconstruct-623"><span class="linenos">623</span></a><span class="sd">        Find the lambda which produces a reconstruction of the</span>
</span><span id="DictionarySpams.optimum_reconstruct-624"><a href="#DictionarySpams.optimum_reconstruct-624"><span class="linenos">624</span></a><span class="sd">        input &#39;strain&#39; closest to the given &#39;reference&#39;, comparing them with</span>
</span><span id="DictionarySpams.optimum_reconstruct-625"><a href="#DictionarySpams.optimum_reconstruct-625"><span class="linenos">625</span></a><span class="sd">        the SSIM estimator. The search is performed by the SciPy&#39;s function</span>
</span><span id="DictionarySpams.optimum_reconstruct-626"><a href="#DictionarySpams.optimum_reconstruct-626"><span class="linenos">626</span></a><span class="sd">        &#39;minimize_scalar&#39; with bounds.</span>
</span><span id="DictionarySpams.optimum_reconstruct-627"><a href="#DictionarySpams.optimum_reconstruct-627"><span class="linenos">627</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-628"><a href="#DictionarySpams.optimum_reconstruct-628"><span class="linenos">628</span></a><span class="sd">        PARAMETERS</span>
</span><span id="DictionarySpams.optimum_reconstruct-629"><a href="#DictionarySpams.optimum_reconstruct-629"><span class="linenos">629</span></a><span class="sd">        ----------</span>
</span><span id="DictionarySpams.optimum_reconstruct-630"><a href="#DictionarySpams.optimum_reconstruct-630"><span class="linenos">630</span></a><span class="sd">        strain: ndarray</span>
</span><span id="DictionarySpams.optimum_reconstruct-631"><a href="#DictionarySpams.optimum_reconstruct-631"><span class="linenos">631</span></a><span class="sd">            Input strain to be reconstructed (and optimized).</span>
</span><span id="DictionarySpams.optimum_reconstruct-632"><a href="#DictionarySpams.optimum_reconstruct-632"><span class="linenos">632</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-633"><a href="#DictionarySpams.optimum_reconstruct-633"><span class="linenos">633</span></a><span class="sd">        reference: ndarray</span>
</span><span id="DictionarySpams.optimum_reconstruct-634"><a href="#DictionarySpams.optimum_reconstruct-634"><span class="linenos">634</span></a><span class="sd">            Reference strain which to compare the reconstruction to.</span>
</span><span id="DictionarySpams.optimum_reconstruct-635"><a href="#DictionarySpams.optimum_reconstruct-635"><span class="linenos">635</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-636"><a href="#DictionarySpams.optimum_reconstruct-636"><span class="linenos">636</span></a><span class="sd">        kwargs_minimize: dict</span>
</span><span id="DictionarySpams.optimum_reconstruct-637"><a href="#DictionarySpams.optimum_reconstruct-637"><span class="linenos">637</span></a><span class="sd">            Passed to SciPy&#39;s `minimize_scalar(**kwargs_minimize)`.</span>
</span><span id="DictionarySpams.optimum_reconstruct-638"><a href="#DictionarySpams.optimum_reconstruct-638"><span class="linenos">638</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-639"><a href="#DictionarySpams.optimum_reconstruct-639"><span class="linenos">639</span></a><span class="sd">        kwargs_lasso: dict</span>
</span><span id="DictionarySpams.optimum_reconstruct-640"><a href="#DictionarySpams.optimum_reconstruct-640"><span class="linenos">640</span></a><span class="sd">            Passed to Python-Spams&#39; `lasso(**kwargs_lasso)`.</span>
</span><span id="DictionarySpams.optimum_reconstruct-641"><a href="#DictionarySpams.optimum_reconstruct-641"><span class="linenos">641</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-642"><a href="#DictionarySpams.optimum_reconstruct-642"><span class="linenos">642</span></a><span class="sd">        step: int, optional</span>
</span><span id="DictionarySpams.optimum_reconstruct-643"><a href="#DictionarySpams.optimum_reconstruct-643"><span class="linenos">643</span></a><span class="sd">            Separation in samples between each window into which the input</span>
</span><span id="DictionarySpams.optimum_reconstruct-644"><a href="#DictionarySpams.optimum_reconstruct-644"><span class="linenos">644</span></a><span class="sd">            strain is split up to be reconstructed by the dictionary. Defaults</span>
</span><span id="DictionarySpams.optimum_reconstruct-645"><a href="#DictionarySpams.optimum_reconstruct-645"><span class="linenos">645</span></a><span class="sd">            to 1.</span>
</span><span id="DictionarySpams.optimum_reconstruct-646"><a href="#DictionarySpams.optimum_reconstruct-646"><span class="linenos">646</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-647"><a href="#DictionarySpams.optimum_reconstruct-647"><span class="linenos">647</span></a><span class="sd">        limits: array-like, optional</span>
</span><span id="DictionarySpams.optimum_reconstruct-648"><a href="#DictionarySpams.optimum_reconstruct-648"><span class="linenos">648</span></a><span class="sd">            Indices of limits to where compute the loss between the</span>
</span><span id="DictionarySpams.optimum_reconstruct-649"><a href="#DictionarySpams.optimum_reconstruct-649"><span class="linenos">649</span></a><span class="sd">            reconstruction and the reference strain.</span>
</span><span id="DictionarySpams.optimum_reconstruct-650"><a href="#DictionarySpams.optimum_reconstruct-650"><span class="linenos">650</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-651"><a href="#DictionarySpams.optimum_reconstruct-651"><span class="linenos">651</span></a><span class="sd">        normed: bool, optional</span>
</span><span id="DictionarySpams.optimum_reconstruct-652"><a href="#DictionarySpams.optimum_reconstruct-652"><span class="linenos">652</span></a><span class="sd">            If True, returns the signal normed to its maximum absolute amplitude.</span>
</span><span id="DictionarySpams.optimum_reconstruct-653"><a href="#DictionarySpams.optimum_reconstruct-653"><span class="linenos">653</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-654"><a href="#DictionarySpams.optimum_reconstruct-654"><span class="linenos">654</span></a><span class="sd">        verbose: bool, optional</span>
</span><span id="DictionarySpams.optimum_reconstruct-655"><a href="#DictionarySpams.optimum_reconstruct-655"><span class="linenos">655</span></a><span class="sd">            Print info about the minimization results. False by default.</span>
</span><span id="DictionarySpams.optimum_reconstruct-656"><a href="#DictionarySpams.optimum_reconstruct-656"><span class="linenos">656</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-657"><a href="#DictionarySpams.optimum_reconstruct-657"><span class="linenos">657</span></a><span class="sd">        RETURNS</span>
</span><span id="DictionarySpams.optimum_reconstruct-658"><a href="#DictionarySpams.optimum_reconstruct-658"><span class="linenos">658</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams.optimum_reconstruct-659"><a href="#DictionarySpams.optimum_reconstruct-659"><span class="linenos">659</span></a><span class="sd">        rec: ndarray</span>
</span><span id="DictionarySpams.optimum_reconstruct-660"><a href="#DictionarySpams.optimum_reconstruct-660"><span class="linenos">660</span></a><span class="sd">            Optimum reconstruction found.</span>
</span><span id="DictionarySpams.optimum_reconstruct-661"><a href="#DictionarySpams.optimum_reconstruct-661"><span class="linenos">661</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-662"><a href="#DictionarySpams.optimum_reconstruct-662"><span class="linenos">662</span></a><span class="sd">        l_opt: float</span>
</span><span id="DictionarySpams.optimum_reconstruct-663"><a href="#DictionarySpams.optimum_reconstruct-663"><span class="linenos">663</span></a><span class="sd">            Optimum value for lambda.</span>
</span><span id="DictionarySpams.optimum_reconstruct-664"><a href="#DictionarySpams.optimum_reconstruct-664"><span class="linenos">664</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-665"><a href="#DictionarySpams.optimum_reconstruct-665"><span class="linenos">665</span></a><span class="sd">        loss: float</span>
</span><span id="DictionarySpams.optimum_reconstruct-666"><a href="#DictionarySpams.optimum_reconstruct-666"><span class="linenos">666</span></a><span class="sd">            ISSIM (1 - SSIM) between the optimized reconstruction and the</span>
</span><span id="DictionarySpams.optimum_reconstruct-667"><a href="#DictionarySpams.optimum_reconstruct-667"><span class="linenos">667</span></a><span class="sd">            reference.</span>
</span><span id="DictionarySpams.optimum_reconstruct-668"><a href="#DictionarySpams.optimum_reconstruct-668"><span class="linenos">668</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-669"><a href="#DictionarySpams.optimum_reconstruct-669"><span class="linenos">669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-670"><a href="#DictionarySpams.optimum_reconstruct-670"><span class="linenos">670</span></a>        <span class="n">aa</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="DictionarySpams.optimum_reconstruct-671"><a href="#DictionarySpams.optimum_reconstruct-671"><span class="linenos">671</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># max(issim) x bb as the minimu value for the auxiliar line function.</span>
</span><span id="DictionarySpams.optimum_reconstruct-672"><a href="#DictionarySpams.optimum_reconstruct-672"><span class="linenos">672</span></a>        <span class="n">rec</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams.optimum_reconstruct-673"><a href="#DictionarySpams.optimum_reconstruct-673"><span class="linenos">673</span></a>        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DictionarySpams.optimum_reconstruct-674"><a href="#DictionarySpams.optimum_reconstruct-674"><span class="linenos">674</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-675"><a href="#DictionarySpams.optimum_reconstruct-675"><span class="linenos">675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.optimum_reconstruct-676"><a href="#DictionarySpams.optimum_reconstruct-676"><span class="linenos">676</span></a>            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">limits</span><span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-677"><a href="#DictionarySpams.optimum_reconstruct-677"><span class="linenos">677</span></a>        <span class="n">reference_</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>
</span><span id="DictionarySpams.optimum_reconstruct-678"><a href="#DictionarySpams.optimum_reconstruct-678"><span class="linenos">678</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-679"><a href="#DictionarySpams.optimum_reconstruct-679"><span class="linenos">679</span></a>        <span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">l_rec_log</span><span class="p">):</span>
</span><span id="DictionarySpams.optimum_reconstruct-680"><a href="#DictionarySpams.optimum_reconstruct-680"><span class="linenos">680</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Function to be minimized.&quot;&quot;&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-681"><a href="#DictionarySpams.optimum_reconstruct-681"><span class="linenos">681</span></a>            <span class="k">nonlocal</span> <span class="n">rec</span>
</span><span id="DictionarySpams.optimum_reconstruct-682"><a href="#DictionarySpams.optimum_reconstruct-682"><span class="linenos">682</span></a>            <span class="n">l_rec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">l_rec_log</span>  <span class="c1"># Opitimizes lambda in log. space!</span>
</span><span id="DictionarySpams.optimum_reconstruct-683"><a href="#DictionarySpams.optimum_reconstruct-683"><span class="linenos">683</span></a>            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">l_rec</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_lasso</span><span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-684"><a href="#DictionarySpams.optimum_reconstruct-684"><span class="linenos">684</span></a>            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="DictionarySpams.optimum_reconstruct-685"><a href="#DictionarySpams.optimum_reconstruct-685"><span class="linenos">685</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">estimators</span><span class="o">.</span><span class="n">issim</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">sl</span><span class="p">],</span> <span class="n">reference_</span><span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-686"><a href="#DictionarySpams.optimum_reconstruct-686"><span class="linenos">686</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DictionarySpams.optimum_reconstruct-687"><a href="#DictionarySpams.optimum_reconstruct-687"><span class="linenos">687</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">aa</span> <span class="o">*</span> <span class="n">l_rec</span> <span class="o">+</span> <span class="n">bb</span>
</span><span id="DictionarySpams.optimum_reconstruct-688"><a href="#DictionarySpams.optimum_reconstruct-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="DictionarySpams.optimum_reconstruct-689"><a href="#DictionarySpams.optimum_reconstruct-689"><span class="linenos">689</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-690"><a href="#DictionarySpams.optimum_reconstruct-690"><span class="linenos">690</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_minimize</span><span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-691"><a href="#DictionarySpams.optimum_reconstruct-691"><span class="linenos">691</span></a>        <span class="n">l_opt</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.optimum_reconstruct-692"><a href="#DictionarySpams.optimum_reconstruct-692"><span class="linenos">692</span></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.optimum_reconstruct-693"><a href="#DictionarySpams.optimum_reconstruct-693"><span class="linenos">693</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-694"><a href="#DictionarySpams.optimum_reconstruct-694"><span class="linenos">694</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DictionarySpams.optimum_reconstruct-695"><a href="#DictionarySpams.optimum_reconstruct-695"><span class="linenos">695</span></a>            <span class="n">success</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.optimum_reconstruct-696"><a href="#DictionarySpams.optimum_reconstruct-696"><span class="linenos">696</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams.optimum_reconstruct-697"><a href="#DictionarySpams.optimum_reconstruct-697"><span class="linenos">697</span></a>                <span class="s2">&quot;Optimization results:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-698"><a href="#DictionarySpams.optimum_reconstruct-698"><span class="linenos">698</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Minimization success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-699"><a href="#DictionarySpams.optimum_reconstruct-699"><span class="linenos">699</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-700"><a href="#DictionarySpams.optimum_reconstruct-700"><span class="linenos">700</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span><span id="DictionarySpams.optimum_reconstruct-701"><a href="#DictionarySpams.optimum_reconstruct-701"><span class="linenos">701</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams.optimum_reconstruct-702"><a href="#DictionarySpams.optimum_reconstruct-702"><span class="linenos">702</span></a>                    <span class="s2">&quot;  Reason</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-703"><a href="#DictionarySpams.optimum_reconstruct-703"><span class="linenos">703</span></a>                    <span class="s2">&quot;  ------</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-704"><a href="#DictionarySpams.optimum_reconstruct-704"><span class="linenos">704</span></a>                    <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-705"><a href="#DictionarySpams.optimum_reconstruct-705"><span class="linenos">705</span></a>                    <span class="s2">&quot;  ------&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-706"><a href="#DictionarySpams.optimum_reconstruct-706"><span class="linenos">706</span></a>                <span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-707"><a href="#DictionarySpams.optimum_reconstruct-707"><span class="linenos">707</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="DictionarySpams.optimum_reconstruct-708"><a href="#DictionarySpams.optimum_reconstruct-708"><span class="linenos">708</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Lambda optimized: </span><span class="si">{</span><span class="n">l_opt</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-709"><a href="#DictionarySpams.optimum_reconstruct-709"><span class="linenos">709</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Iterations performed: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;nit&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-710"><a href="#DictionarySpams.optimum_reconstruct-710"><span class="linenos">710</span></a>                <span class="sa">f</span><span class="s2">&quot;&gt; Final loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DictionarySpams.optimum_reconstruct-711"><a href="#DictionarySpams.optimum_reconstruct-711"><span class="linenos">711</span></a>            <span class="p">)</span>
</span><span id="DictionarySpams.optimum_reconstruct-712"><a href="#DictionarySpams.optimum_reconstruct-712"><span class="linenos">712</span></a>
</span><span id="DictionarySpams.optimum_reconstruct-713"><a href="#DictionarySpams.optimum_reconstruct-713"><span class="linenos">713</span></a>        <span class="k">return</span> <span class="n">rec</span><span class="p">,</span> <span class="n">l_opt</span><span class="p">,</span> <span class="n">loss</span>
</span></pre></div>


            <div class="docstring"><p>Find the best reconstruction of a signal w.r.t. a reference.</p>

<p>Find the lambda which produces a reconstruction of the
input 'strain' closest to the given 'reference', comparing them with
the SSIM estimator. The search is performed by the SciPy's function
'minimize_scalar' with bounds.</p>

<h6 id="parameters">PARAMETERS</h6>

<p>strain: ndarray
    Input strain to be reconstructed (and optimized).</p>

<p>reference: ndarray
    Reference strain which to compare the reconstruction to.</p>

<p>kwargs_minimize: dict
    Passed to SciPy's <code>minimize_scalar(**kwargs_minimize)</code>.</p>

<p>kwargs_lasso: dict
    Passed to Python-Spams' <code>lasso(**kwargs_lasso)</code>.</p>

<p>step: int, optional
    Separation in samples between each window into which the input
    strain is split up to be reconstructed by the dictionary. Defaults
    to 1.</p>

<p>limits: array-like, optional
    Indices of limits to where compute the loss between the
    reconstruction and the reference strain.</p>

<p>normed: bool, optional
    If True, returns the signal normed to its maximum absolute amplitude.</p>

<p>verbose: bool, optional
    Print info about the minimization results. False by default.</p>

<h6 id="returns">RETURNS</h6>

<p>rec: ndarray
    Optimum reconstruction found.</p>

<p>l_opt: float
    Optimum value for lambda.</p>

<p>loss: float
    ISSIM (1 - SSIM) between the optimized reconstruction and the
    reference.</p>
</div>


                            </div>
                            <div id="DictionarySpams.save" class="classattr">
                                        <input id="DictionarySpams.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.save-715"><a href="#DictionarySpams.save-715"><span class="linenos">715</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
</span><span id="DictionarySpams.save-716"><a href="#DictionarySpams.save-716"><span class="linenos">716</span></a>        <span class="n">vars_</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DictionarySpams.save-717"><a href="#DictionarySpams.save-717"><span class="linenos">717</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DictionarySpams.save-718"><a href="#DictionarySpams.save-718"><span class="linenos">718</span></a>
</span><span id="DictionarySpams.save-719"><a href="#DictionarySpams.save-719"><span class="linenos">719</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams.save-720"><a href="#DictionarySpams.save-720"><span class="linenos">720</span></a>            <span class="c1"># To avoid silent bugs in the future</span>
</span><span id="DictionarySpams.save-721"><a href="#DictionarySpams.save-721"><span class="linenos">721</span></a>            <span class="n">to_remove</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lambda1&#39;</span><span class="p">,</span> <span class="s1">&#39;n_train&#39;</span><span class="p">,</span> <span class="s1">&#39;t_train&#39;</span><span class="p">]</span>
</span><span id="DictionarySpams.save-722"><a href="#DictionarySpams.save-722"><span class="linenos">722</span></a>
</span><span id="DictionarySpams.save-723"><a href="#DictionarySpams.save-723"><span class="linenos">723</span></a>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="DictionarySpams.save-724"><a href="#DictionarySpams.save-724"><span class="linenos">724</span></a>            <span class="n">vars_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="DictionarySpams.save-725"><a href="#DictionarySpams.save-725"><span class="linenos">725</span></a>
</span><span id="DictionarySpams.save-726"><a href="#DictionarySpams.save-726"><span class="linenos">726</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">vars_</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DictionarySpams.copy" class="classattr">
                                        <input id="DictionarySpams.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.copy-728"><a href="#DictionarySpams.copy-728"><span class="linenos">728</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DictionarySpams.copy-729"><a href="#DictionarySpams.copy-729"><span class="linenos">729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the dictionary.</span>
</span><span id="DictionarySpams.copy-730"><a href="#DictionarySpams.copy-730"><span class="linenos">730</span></a>
</span><span id="DictionarySpams.copy-731"><a href="#DictionarySpams.copy-731"><span class="linenos">731</span></a><span class="sd">        Returns a new instance of the same dictionary with the same values</span>
</span><span id="DictionarySpams.copy-732"><a href="#DictionarySpams.copy-732"><span class="linenos">732</span></a><span class="sd">        and state.</span>
</span><span id="DictionarySpams.copy-733"><a href="#DictionarySpams.copy-733"><span class="linenos">733</span></a>
</span><span id="DictionarySpams.copy-734"><a href="#DictionarySpams.copy-734"><span class="linenos">734</span></a><span class="sd">        Returns</span>
</span><span id="DictionarySpams.copy-735"><a href="#DictionarySpams.copy-735"><span class="linenos">735</span></a><span class="sd">        -------</span>
</span><span id="DictionarySpams.copy-736"><a href="#DictionarySpams.copy-736"><span class="linenos">736</span></a><span class="sd">        dico_copy : DictionarySpams</span>
</span><span id="DictionarySpams.copy-737"><a href="#DictionarySpams.copy-737"><span class="linenos">737</span></a><span class="sd">            A copy of the current dictionary.</span>
</span><span id="DictionarySpams.copy-738"><a href="#DictionarySpams.copy-738"><span class="linenos">738</span></a><span class="sd">        </span>
</span><span id="DictionarySpams.copy-739"><a href="#DictionarySpams.copy-739"><span class="linenos">739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DictionarySpams.copy-740"><a href="#DictionarySpams.copy-740"><span class="linenos">740</span></a>        <span class="n">dico_copy</span> <span class="o">=</span> <span class="n">DictionarySpams</span><span class="p">(</span>
</span><span id="DictionarySpams.copy-741"><a href="#DictionarySpams.copy-741"><span class="linenos">741</span></a>            <span class="n">dict_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="DictionarySpams.copy-742"><a href="#DictionarySpams.copy-742"><span class="linenos">742</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-743"><a href="#DictionarySpams.copy-743"><span class="linenos">743</span></a>            <span class="n">lambda1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda1</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-744"><a href="#DictionarySpams.copy-744"><span class="linenos">744</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-745"><a href="#DictionarySpams.copy-745"><span class="linenos">745</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-746"><a href="#DictionarySpams.copy-746"><span class="linenos">746</span></a>            <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-747"><a href="#DictionarySpams.copy-747"><span class="linenos">747</span></a>            <span class="n">n_train</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_train</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-748"><a href="#DictionarySpams.copy-748"><span class="linenos">748</span></a>            <span class="n">trained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-749"><a href="#DictionarySpams.copy-749"><span class="linenos">749</span></a>            <span class="n">mode_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-750"><a href="#DictionarySpams.copy-750"><span class="linenos">750</span></a>            <span class="n">modeD_traindl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modeD_traindl</span><span class="p">,</span>
</span><span id="DictionarySpams.copy-751"><a href="#DictionarySpams.copy-751"><span class="linenos">751</span></a>            <span class="n">mode_lasso</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_lasso</span>
</span><span id="DictionarySpams.copy-752"><a href="#DictionarySpams.copy-752"><span class="linenos">752</span></a>        <span class="p">)</span>
</span><span id="DictionarySpams.copy-753"><a href="#DictionarySpams.copy-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained</span><span class="p">:</span>
</span><span id="DictionarySpams.copy-754"><a href="#DictionarySpams.copy-754"><span class="linenos">754</span></a>            <span class="c1"># Retain the initial components of the dictionary.</span>
</span><span id="DictionarySpams.copy-755"><a href="#DictionarySpams.copy-755"><span class="linenos">755</span></a>            <span class="n">dico_copy</span><span class="o">.</span><span class="n">dict_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="DictionarySpams.copy-756"><a href="#DictionarySpams.copy-756"><span class="linenos">756</span></a>
</span><span id="DictionarySpams.copy-757"><a href="#DictionarySpams.copy-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="n">dico_copy</span>
</span></pre></div>


            <div class="docstring"><p>Return a copy of the dictionary.</p>

<p>Returns a new instance of the same dictionary with the same values
and state.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dico_copy</strong> (DictionarySpams):
A copy of the current dictionary.</li>
</ul>
</div>


                            </div>
                            <div id="DictionarySpams.reset" class="classattr">
                                        <input id="DictionarySpams.reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DictionarySpams.reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictionarySpams.reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictionarySpams.reset-759"><a href="#DictionarySpams.reset-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DictionarySpams.reset-760"><a href="#DictionarySpams.reset-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the dictionary to its initial (untrained) state.&quot;&quot;&quot;</span>
</span><span id="DictionarySpams.reset-761"><a href="#DictionarySpams.reset-761"><span class="linenos">761</span></a>
</span><span id="DictionarySpams.reset-762"><a href="#DictionarySpams.reset-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_init</span>
</span><span id="DictionarySpams.reset-763"><a href="#DictionarySpams.reset-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trained</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DictionarySpams.reset-764"><a href="#DictionarySpams.reset-764"><span class="linenos">764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_train</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DictionarySpams.reset-765"><a href="#DictionarySpams.reset-765"><span class="linenos">765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_train</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Reset the dictionary to its initial (untrained) state.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>